# Auto-Build softwares from source: basic dependants

# Prerequist:
# 1. basic compiler
#  1) RedHat/CentOS:
#     yum -y groupinstall "Development Tools"
#     yum -y install gcc-c++ rpm-build rpmdevtools binutils-devel bison flex gdb make cvs subversion git mercurial patch gawk
#  2) Debian/Ubuntu
#     sudo apt-get install -y build-essential g++ bison flex gdb make cvs subversion subversion-tools git mercurial patch gawk

# TODO:
#  use system lib when possible, also supports lib version detection

######################################################################
# define the directory stores all of the source code packages
# should be defined befor including this file!!
#DN_SRC=$(PWD)/sources
#DN_TOP=$(PWD)
#DN_PATCH=$(PWD)/sources
#PREFIX=$(PWD)/target
#STRLOGO=yhfudev

# setup the prefix for configure and make's DESTDIR
#PREFIX_CONF=/usr
#PREFIX_DEST=$(PREFIX)
PREFIX_CONF=$(PREFIX)/usr
PREFIX_DEST=
# always to be the prefix
PREFIX_CMAKE=$(PREFIX)

empty:=
space:= $(empty) $(empty)
LD_PATH_SYS=$(subst $(space),,$(shell ldconfig -v | grep ^/ | awk '{print $$1}'))

#MAKE_ARG=-j $(shell cat /proc/cpuinfo | grep processor | wc -l )
MAKE_ARG=-j $(shell cat /proc/cpuinfo | grep processor | wc -l | awk '{print $$0 / 1 + 1;}')

CFLAGS=-I$(PREFIX_DEST)/$(PREFIX_CONF)/include/
CPPFLAGS=-I$(PREFIX_DEST)/$(PREFIX_CONF)/include/
LDFLAGS=-L$(PREFIX_DEST)/$(PREFIX_CONF)/lib/
LD_LIBRARY_PATH=$(CUDA_LDLIB_PATH):$(PREFIX_DEST)/$(PREFIX_CONF)/lib

ENV_COMPILE= PATH=$(PREFIX_DEST)/$(PREFIX_CONF)/bin:$(PATH) \
		PKG_CONFIG_PATH=$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig:$(PKG_CONFIG_PATH) \
		LD_LIBRARY_PATH=$(LD_LIBRARY_PATH) \
		CFLAGS="$(CFLAGS)" \
		CPPFLAGS="$(CPPFLAGS)" \
		LDFLAGS="$(LDFLAGS)" \
		$(NULL)

ENV_COMPILE1=export PATH=$(PREFIX_DEST)/$(PREFIX_CONF)/bin:$(PATH); \
		export PKG_CONFIG_PATH=$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig:$(PKG_CONFIG_PATH); \
		export LD_LIBRARY_PATH=$(PREFIX_DEST)/$(PREFIX_CONF)/lib:$(LD_LIBRARY_PATH); \
		export CFLAGS="$(CFLAGS)"; \
		export CPPFLAGS="$(CPPFLAGS)"; \
		export LDFLAGS="$(LDFLAGS)"; \
		$(NULL)

OSTYP:=$(shell uname -m)
ifeq ($(OSTYP),x86_64)
CMAKE_ARCH_FLAGS = -DENABLE_SSE=ON -DENABLE_SSE2=ON -DENABLE_SSSE3=OFF
else
CMAKE_ARCH_FLAGS = -DENABLE_SSE=OFF -DENABLE_SSE2=OFF -DENABLE_SSSE3=OFF -DENABLE_PRECOMPILED_HEADERS=OFF
endif

ARCHBITS=$(shell getconf LONG_BIT)

######################################################################
#CURL=curl -s -L -O
WGET=wget --no-check-certificate -P $(DN_SRC)

FL_SOURCES=
FL_SOURCES_OTHERS=

########################################
.PHONY: get-sources

$(DN_SRC)/created:
	make -p $(DN_SRC)
	touch $@

######################################################################
ZLIB=zlib
ZLIB_VERSION=1.2.8
ZLIB_SRC=$(ZLIB)-$(ZLIB_VERSION).tar.gz
ZLIB_URL=http://zlib.net/$(ZLIB_SRC)

$(DN_SRC)/$(ZLIB_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(ZLIB_URL)
	touch $@
$(ZLIB)-$(ZLIB_VERSION)/gzlib.c: $(DN_SRC)/$(ZLIB_SRC)
	tar -xf $(DN_SRC)/$(ZLIB_SRC)
	touch $@
$(ZLIB)-$(ZLIB_VERSION)/zconf.h: $(ZLIB)-$(ZLIB_VERSION)/gzlib.c
	cd $(ZLIB)-$(ZLIB_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(ZLIB)-$(ZLIB_VERSION)/libz.a: $(ZLIB)-$(ZLIB_VERSION)/zconf.h
	cd $(ZLIB)-$(ZLIB_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libz.a: $(ZLIB)-$(ZLIB_VERSION)/libz.a
	cd $(ZLIB)-$(ZLIB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(ZLIB)-uninstall: $(ZLIB)-$(ZLIB_VERSION)/libz.a
	cd $(ZLIB)-$(ZLIB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(ZLIB)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libz.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(ZLIB_SRC)
FL_UNINSTALL+=$(ZLIB)-uninstall


########################################
BZIP2=bzip2
BZIP2_VERSION=1.0.6
BZIP2_SRC=$(BZIP2)-$(BZIP2_VERSION).tar.gz
BZIP2_URL=http://www.bzip.org/$(BZIP2_VERSION)/$(BZIP2_SRC)

$(DN_SRC)/$(BZIP2_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(BZIP2_URL)
	touch $@
$(BZIP2)-$(BZIP2_VERSION)/Makefile: $(DN_SRC)/$(BZIP2_SRC)
	tar -xf $(DN_SRC)/$(BZIP2_SRC)
	sed -i -e 's|ln -s -f $$(PREFIX)/bin/|ln -s -f |' $@
	touch $@
$(BZIP2)-$(BZIP2_VERSION)/libbz2.a: $(BZIP2)-$(BZIP2_VERSION)/Makefile
	cd $(BZIP2)-$(BZIP2_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG) CC="gcc -fPIC"
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libbz2.a: $(BZIP2)-$(BZIP2_VERSION)/libbz2.a
	cd $(BZIP2)-$(BZIP2_VERSION)/ && make -j1 PREFIX=$(PREFIX_DEST)/$(PREFIX_CONF)/ install

$(BZIP2)-uninstall: $(BZIP2)-$(BZIP2_VERSION)/libbz2.a
	cd $(BZIP2)-$(BZIP2_VERSION)/ && make -j1 PREFIX=$(PREFIX_DEST)/$(PREFIX_CONF)/ uninstall
$(BZIP2)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libbz2.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(BZIP2_SRC)
FL_UNINSTALL+=$(BZIP2)-uninstall

########################################
EXPAT=expat
EXPAT_VERSION=2.1.0
EXPAT_SRC=$(EXPAT)-$(EXPAT_VERSION).tar.gz
EXPAT_URL=http://sourceforge.net/projects/expat/files/expat/$(EXPAT_VERSION)/$(EXPAT_SRC)

$(DN_SRC)/$(EXPAT_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(EXPAT_URL)
	touch $@
$(EXPAT)-$(EXPAT_VERSION)/README: $(DN_SRC)/$(EXPAT_SRC)
	tar -xf $(DN_SRC)/$(EXPAT_SRC)
	touch $@
$(EXPAT)-$(EXPAT_VERSION)/Makefile: $(EXPAT)-$(EXPAT_VERSION)/README
	cd $(EXPAT)-$(EXPAT_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shared
$(EXPAT)-$(EXPAT_VERSION)/libexpat.la: $(EXPAT)-$(EXPAT_VERSION)/Makefile
	cd $(EXPAT)-$(EXPAT_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libexpat.a: $(EXPAT)-$(EXPAT_VERSION)/libexpat.la
	cd $(EXPAT)-$(EXPAT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(EXPAT)-uninstall: $(EXPAT)-$(EXPAT_VERSION)/libexpat.la
	cd $(EXPAT)-$(EXPAT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(EXPAT)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libexpat.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(EXPAT_SRC)
FL_UNINSTALL+=$(EXPAT)-uninstall

########################################
CMAKE=cmake

CMAKE_VERSION=2.8.12.2
CMAKE_VERSION_CONN=v2.8

CMAKE_VERSION=3.2.3
CMAKE_VERSION_CONN=v3.2

CMAKE_SRC=$(CMAKE)-$(CMAKE_VERSION).tar.gz
CMAKE_URL=http://www.cmake.org/files/$(CMAKE_VERSION_CONN)/$(CMAKE_SRC)

FL_DEP_CMAKE= \
	$(ZLIB)-install \
	$(BZIP2)-install \
	$(EXPAT)-install \
	#$(JSONCPP)-install \
	$(NULL)

$(DN_SRC)/$(CMAKE_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(CMAKE_URL)
	touch $@
$(CMAKE)-$(CMAKE_VERSION)/configure: $(DN_SRC)/$(CMAKE_SRC)
	tar -xf $(DN_SRC)/$(CMAKE_SRC)
	touch $@
$(CMAKE)-$(CMAKE_VERSION)/Makefile: $(CMAKE)-$(CMAKE_VERSION)/configure $(FL_DEP_CMAKE)
	cd $(CMAKE)-$(CMAKE_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
            --system-bzip2 --system-expat --system-zlib --no-system-jsoncpp --no-qt-gui

$(CMAKE)-$(CMAKE_VERSION)/bin/cmake: $(CMAKE)-$(CMAKE_VERSION)/Makefile
	cd $(CMAKE)-$(CMAKE_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/cmake: $(CMAKE)-$(CMAKE_VERSION)/bin/cmake
	cd $(CMAKE)-$(CMAKE_VERSION)/ && $(ENV_COMPILE) make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(CMAKE)-uninstall: $(CMAKE)-$(CMAKE_VERSION)/cmake
	cd $(CMAKE)-$(CMAKE_VERSION)/ && $(ENV_COMPILE) make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(CMAKE)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/cmake
	touch $@

FL_SOURCES+=$(DN_SRC)/$(CMAKE_SRC)
FL_UNINSTALL+=$(CMAKE)-uninstall

########################################
YASM=yasm
YASM_VERSION=1.3.0
YASM_SRC=$(YASM)-$(YASM_VERSION).tar.gz
YASM_URL=http://www.tortall.net/projects/yasm/releases/$(YASM_SRC)

$(DN_SRC)/$(YASM_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(YASM_URL)
	touch $@
$(YASM)-$(YASM_VERSION)/configure: $(DN_SRC)/$(YASM_SRC)
	tar -xf $(DN_SRC)/$(YASM_SRC)
	touch $@
$(YASM)-$(YASM_VERSION)/Makefile: $(YASM)-$(YASM_VERSION)/configure
	cd $(YASM)-$(YASM_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(YASM)-$(YASM_VERSION)/yasm: $(YASM)-$(YASM_VERSION)/Makefile
	cd $(YASM)-$(YASM_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/yasm: $(YASM)-$(YASM_VERSION)/yasm
	cd $(YASM)-$(YASM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(YASM)-uninstall: $(YASM)-$(YASM_VERSION)/yasm
	cd $(YASM)-$(YASM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(YASM)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/yasm
	touch $@

FL_SOURCES+=$(DN_SRC)/$(YASM_SRC)
FL_UNINSTALL+=$(YASM)-uninstall

########################################
# An 80x86 assembler designed for portability and modularity
# http://www.nasm.us
NASM=nasm
NASM_VERSION=2.11.08
NASM_SRC=$(NASM)-$(NASM_VERSION).tar.gz
NASM_URL=http://www.nasm.us/pub/nasm/releasebuilds/$(NASM_VERSION)/$(NASM_SRC)

$(DN_SRC)/$(NASM_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(NASM_URL)
	touch $@
$(NASM)-$(NASM_VERSION)/configure: $(DN_SRC)/$(NASM_SRC)
	tar -xf $(DN_SRC)/$(NASM_SRC)
	touch $@
$(NASM)-$(NASM_VERSION)/Makefile: $(NASM)-$(NASM_VERSION)/configure
	cd $(NASM)-$(NASM_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(NASM)-$(NASM_VERSION)/nasm: $(NASM)-$(NASM_VERSION)/Makefile
	cd $(NASM)-$(NASM_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/nasm: $(NASM)-$(NASM_VERSION)/nasm
	cd $(NASM)-$(NASM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) INSTALLROOT=$(PREFIX_DEST) install install_rdf

$(NASM)-uninstall: $(NASM)-$(NASM_VERSION)/nasm
	cd $(NASM)-$(NASM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) INSTALLROOT=$(PREFIX_DEST) uninstall
$(NASM)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/nasm
	touch $@

FL_SOURCES+=$(DN_SRC)/$(NASM_SRC)
FL_UNINSTALL+=$(NASM)-uninstall

########################################
# A generic library support script
# http://www.gnu.org/software/libtool
LIBTOOL=libtool

FL_DEP_LIBTOOL= \
	#$(aaaaa)-install \
	$(NULL)

LIBTOOL_VERSION=2.4.6
LIBTOOL_SRC=$(LIBTOOL)-$(LIBTOOL_VERSION).tar.xz
LIBTOOL_URL=ftp://ftp.gnu.org/pub/gnu/$(LIBTOOL)/$(LIBTOOL_SRC)

$(DN_SRC)/$(LIBTOOL_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBTOOL_URL)
	touch $@

$(LIBTOOL)-$(LIBTOOL_VERSION)/configure: $(DN_SRC)/$(LIBTOOL_SRC)
	tar -xf $(DN_SRC)/$(LIBTOOL_SRC)
	touch $@

$(LIBTOOL)-$(LIBTOOL_VERSION)/Makefile: $(LIBTOOL)-$(LIBTOOL_VERSION)/configure $(FL_DEP_LIBTOOL)
	cd $(LIBTOOL)-$(LIBTOOL_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) lt_cv_sys_lib_dlsearch_path_spec="$(PREFIX_CONF)/lib $(PREFIX_CONF)/lib32"
	touch $@
$(LIBTOOL)-$(LIBTOOL_VERSION)/libtoolize: $(LIBTOOL)-$(LIBTOOL_VERSION)/Makefile
	cd $(LIBTOOL)-$(LIBTOOL_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/libtoolize: $(LIBTOOL)-$(LIBTOOL_VERSION)/libtoolize
	cd $(LIBTOOL)-$(LIBTOOL_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(LIBTOOL)-uninstall: $(LIBTOOL)-$(LIBTOOL_VERSION)/libtoolize
	cd $(LIBTOOL)-$(LIBTOOL_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBTOOL)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/libtoolize
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBTOOL_SRC)
FL_UNINSTALL+=$(LIBTOOL)-uninstall

########################################
# A system for managing library compile/link flags
# http://pkgconfig.freedesktop.org/wiki/
PKGCONFIG=pkg-config

FL_DEP_PKGCONFIG= \
	#$(aaaa)-install \
	$(NULL)

PKGCONFIG_VERSION=0.29
PKGCONFIG_SRC=$(PKGCONFIG)-$(PKGCONFIG_VERSION).tar.gz
PKGCONFIG_URL=http://pkgconfig.freedesktop.org/releases/$(PKGCONFIG_SRC)

$(DN_SRC)/$(PKGCONFIG_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(PKGCONFIG_URL)
	touch $@

$(PKGCONFIG)-$(PKGCONFIG_VERSION)/configure: $(DN_SRC)/$(PKGCONFIG_SRC)
	tar -xf $(DN_SRC)/$(PKGCONFIG_SRC)
	touch $@

$(PKGCONFIG)-$(PKGCONFIG_VERSION)/Makefile: $(PKGCONFIG)-$(PKGCONFIG_VERSION)/configure $(FL_DEP_PKGCONFIG)
	cd $(PKGCONFIG)-$(PKGCONFIG_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --with-internal-glib
	touch $@
$(PKGCONFIG)-$(PKGCONFIG_VERSION)/$(PKGCONFIG): $(PKGCONFIG)-$(PKGCONFIG_VERSION)/Makefile
	cd $(PKGCONFIG)-$(PKGCONFIG_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/$(PKGCONFIG): $(PKGCONFIG)-$(PKGCONFIG_VERSION)/$(PKGCONFIG)
	cd $(PKGCONFIG)-$(PKGCONFIG_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(PKGCONFIG)-uninstall: $(PKGCONFIG)-$(PKGCONFIG_VERSION)/$(PKGCONFIG)
	cd $(PKGCONFIG)-$(PKGCONFIG_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(PKGCONFIG)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/$(PKGCONFIG)
	touch $@

FL_SOURCES+=$(DN_SRC)/$(PKGCONFIG_SRC)
FL_UNINSTALL+=$(PKGCONFIG)-uninstall

########################################
# The GNU macro processor
# http://www.gnu.org/software/m4
M4=m4

FL_DEP_M4= \
	#$(M4)-install \
	$(NULL)

M4_VERSION=1.4.17
M4_SRC=$(M4)-$(M4_VERSION).tar.xz
M4_URL=ftp://ftp.gnu.org/gnu/$(M4)/$(M4_SRC)

$(DN_SRC)/$(M4_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(M4_URL)
	touch $@

$(M4)-$(M4_VERSION)/configure: $(DN_SRC)/$(M4_SRC)
	tar -xf $(DN_SRC)/$(M4_SRC)
	#$(ENV_COMPILE) autoreconf -if
	touch $@

$(M4)-$(M4_VERSION)/Makefile: $(M4)-$(M4_VERSION)/configure $(FL_DEP_M4)
	cd $(M4)-$(M4_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@
$(M4)-$(M4_VERSION)/src/m4: $(M4)-$(M4_VERSION)/Makefile
	cd $(M4)-$(M4_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/m4: $(M4)-$(M4_VERSION)/src/m4
	cd $(M4)-$(M4_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(M4)-uninstall: $(M4)-$(M4_VERSION)/src/m4
	cd $(M4)-$(M4_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(M4)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/m4
	touch $@

FL_SOURCES+=$(DN_SRC)/$(M4_SRC)
FL_UNINSTALL+=$(M4)-uninstall

########################################
# A GNU tool for automatically configuring source code
# http://www.gnu.org/software/autoconf
AUTOCONF=autoconf

FL_DEP_AUTOCONF= \
	$(M4)-install \
	$(LIBTOOL)-install \
	$(NULL)

AUTOCONF_VERSION=2.69
AUTOCONF_SRC=$(AUTOCONF)-$(AUTOCONF_VERSION).tar.xz
AUTOCONF_URL=ftp://ftp.gnu.org/gnu/$(AUTOCONF)/$(AUTOCONF_SRC)

$(DN_SRC)/$(AUTOCONF_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(AUTOCONF_URL)
	touch $@

$(AUTOCONF)-$(AUTOCONF_VERSION)/configure: $(DN_SRC)/$(AUTOCONF_SRC)
	tar -xf $(DN_SRC)/$(AUTOCONF_SRC)
	#$(ENV_COMPILE) autoreconf -if
	touch $@

$(AUTOCONF)-$(AUTOCONF_VERSION)/Makefile: $(AUTOCONF)-$(AUTOCONF_VERSION)/configure $(FL_DEP_AUTOCONF)
	cd $(AUTOCONF)-$(AUTOCONF_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@
$(AUTOCONF)-$(AUTOCONF_VERSION)/bin/autoconf: $(AUTOCONF)-$(AUTOCONF_VERSION)/Makefile
	cd $(AUTOCONF)-$(AUTOCONF_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/autoconf: $(AUTOCONF)-$(AUTOCONF_VERSION)/bin/autoconf
	cd $(AUTOCONF)-$(AUTOCONF_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(AUTOCONF)-uninstall: $(AUTOCONF)-$(AUTOCONF_VERSION)/bin/autoconf
	cd $(AUTOCONF)-$(AUTOCONF_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(AUTOCONF)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/autoconf
	touch $@

FL_SOURCES+=$(DN_SRC)/$(AUTOCONF_SRC)
FL_UNINSTALL+=$(AUTOCONF)-uninstall

########################################
# The internationalization tool collection
# https://edge.launchpad.net/intltool
INTLTOOL=intltool

FL_DEP_INTLTOOL= \
	#$(aaaa)-install \
	$(NULL)

INTLTOOL_VERSION=0.51.0
INTLTOOL_SRC=$(INTLTOOL)-$(INTLTOOL_VERSION).tar.gz
INTLTOOL_URL=http://launchpad.net/intltool/trunk/$(INTLTOOL_VERSION)/+download/$(INTLTOOL_SRC)

$(DN_SRC)/$(INTLTOOL_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(INTLTOOL_URL)
	touch $@

$(INTLTOOL)-$(INTLTOOL_VERSION)/configure: $(DN_SRC)/$(INTLTOOL_SRC)
	tar -xf $(DN_SRC)/$(INTLTOOL_SRC)
	#$(ENV_COMPILE) autoreconf -if
	touch $@

$(INTLTOOL)-$(INTLTOOL_VERSION)/Makefile: $(INTLTOOL)-$(INTLTOOL_VERSION)/configure $(FL_DEP_INTLTOOL)
	cd $(INTLTOOL)-$(INTLTOOL_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@
$(INTLTOOL)-$(INTLTOOL_VERSION)/bin/intltool-extract: $(INTLTOOL)-$(INTLTOOL_VERSION)/Makefile
	cd $(INTLTOOL)-$(INTLTOOL_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/intltool-extract: $(INTLTOOL)-$(INTLTOOL_VERSION)/bin/intltool-extract
	cd $(INTLTOOL)-$(INTLTOOL_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(INTLTOOL)-uninstall: $(INTLTOOL)-$(INTLTOOL_VERSION)/bin/intltool-extract
	cd $(INTLTOOL)-$(INTLTOOL_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(INTLTOOL)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/intltool-extract
	touch $@

FL_SOURCES+=$(DN_SRC)/$(INTLTOOL_SRC)
FL_UNINSTALL+=$(INTLTOOL)-uninstall

########################################
# A GNU tool for automatically creating Makefiles
# http://www.gnu.org/software/automake
AUTOMAKE=automake

# autoconf automake libtool autogen intltool
FL_DEP_AUTOMAKE= \
	$(AUTOCONF)-install  \
	$(PKGCONFIG)-install \
	#$(AUTOGEN)-install   \
	$(INTLTOOL)-install  \
	$(NULL)

AUTOMAKE_VERSION=1.15
AUTOMAKE_SRC=$(AUTOMAKE)-$(AUTOMAKE_VERSION).tar.xz
AUTOMAKE_URL=ftp://ftp.gnu.org/gnu/$(AUTOMAKE)/$(AUTOMAKE_SRC)

$(DN_SRC)/$(AUTOMAKE_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(AUTOMAKE_URL)
	touch $@

$(AUTOMAKE)-$(AUTOMAKE_VERSION)/configure: $(DN_SRC)/$(AUTOMAKE_SRC)
	tar -xf $(DN_SRC)/$(AUTOMAKE_SRC)
	#$(ENV_COMPILE) autoreconf -if
	touch $@

$(AUTOMAKE)-$(AUTOMAKE_VERSION)/Makefile: $(AUTOMAKE)-$(AUTOMAKE_VERSION)/configure $(FL_DEP_AUTOMAKE)
	cd $(AUTOMAKE)-$(AUTOMAKE_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-avresample --enable-shared --disable-static
	touch $@
$(AUTOMAKE)-$(AUTOMAKE_VERSION)/bin/automake: $(AUTOMAKE)-$(AUTOMAKE_VERSION)/Makefile
	cd $(AUTOMAKE)-$(AUTOMAKE_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/automake: $(AUTOMAKE)-$(AUTOMAKE_VERSION)/bin/automake
	cd $(AUTOMAKE)-$(AUTOMAKE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(AUTOMAKE)-uninstall: $(AUTOMAKE)-$(AUTOMAKE_VERSION)/bin/automake
	cd $(AUTOMAKE)-$(AUTOMAKE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(AUTOMAKE)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/automake
	touch $@

FL_SOURCES+=$(DN_SRC)/$(AUTOMAKE_SRC)
FL_UNINSTALL+=$(AUTOMAKE)-uninstall


########################################
GNUAWK=gawk
GNUAWK_VERSION=4.1.3
GNUAWK_SRC=$(GNUAWK)-$(GNUAWK_VERSION).tar.gz
GNUAWK_URL=http://ftp.gnu.org/gnu/gawk/$(GNUAWK_SRC)

$(DN_SRC)/$(GNUAWK_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GNUAWK_URL)
	touch $@
$(GNUAWK)-$(GNUAWK_VERSION)/configure: $(DN_SRC)/$(GNUAWK_SRC)
	tar -xf $(DN_SRC)/$(GNUAWK_SRC)
	touch $@

#$(GNUAWK)-$(GNUAWK_VERSION)/mypatched: $(DN_PATCH)/pbs-GNUAWK-lua.patch $(GNUAWK)-$(GNUAWK_VERSION)/configure
#	cd $(GNUAWK)-$(GNUAWK_VERSION)/ && patch -p1 < $(DN_PATCH)/pbs-GNUAWK-lua.patch
#	touch $@

$(GNUAWK)-$(GNUAWK_VERSION)/Makefile: $(GNUAWK)-$(GNUAWK_VERSION)/configure $(FL_DEP_GNUAWK)
	cd $(GNUAWK)-$(GNUAWK_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --libexecdir=$(PREFIX_CONF)/lib  --enable-switch --disable-libsigsegv --with-libsigsegv-prefix=no
$(GNUAWK)-$(GNUAWK_VERSION)/gawk: $(GNUAWK)-$(GNUAWK_VERSION)/Makefile
	cd $(GNUAWK)-$(GNUAWK_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/gawk: $(GNUAWK)-$(GNUAWK_VERSION)/gawk
	cd $(GNUAWK)-$(GNUAWK_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(GNUAWK)-uninstall: $(GNUAWK)-$(GNUAWK_VERSION)/gawk
	cd $(GNUAWK)-$(GNUAWK_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GNUAWK)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/gawk
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GNUAWK_SRC)
FL_UNINSTALL+=$(GNUAWK)-uninstall

########################################
# The Open Source toolkit for Secure Sockets Layer and Transport Layer Security
# https://wiki.openssl.org/index.php/Compilation_and_Installation
OPENSSL=openssl

FL_DEP_OPENSSL= \
	$(ZLIB)-install \
	$(NULL)

ifeq ($(OSTYP),x86_64)
openssltarget=linux-x86_64
optflags=enable-ec_nistp_64_gcc_128
else
openssltarget=linux-elf
optflags=
endif


USE_GIT_OPENSSL=0

ifeq ($(USE_GIT_OPENSSL),1) # use git instead

OPENSSL_VERSION=git
OPENSSL_SRC=$(OPENSSL)-$(OPENSSL_VERSION)/.git
OPENSSL_URL=https://github.com/openssl/openssl.git

$(DN_SRC)/$(OPENSSL_SRC): $(DN_SRC)/created
	if [ ! -d "$(DN_SRC)/$(OPENSSL_SRC)" ]; then \
        git clone $(OPENSSL_URL) $(DN_SRC)/$(OPENSSL)-$(OPENSSL_VERSION); \
    fi
	cd $(DN_SRC)/$(OPENSSL)-$(OPENSSL_VERSION) && git pull #&& git submodule update --init --recursive
	touch $@

$(OPENSSL)-$(OPENSSL_VERSION)/Configure: $(DN_SRC)/$(OPENSSL_SRC)
	if [ ! -d "$(OPENSSL)-$(OPENSSL_VERSION)" ]; then \
        cp -r $(DN_SRC)/$(OPENSSL)-$(OPENSSL_VERSION)/ $(OPENSSL)-$(OPENSSL_VERSION); \
    fi
	cd $(OPENSSL)-$(OPENSSL_VERSION) && git pull #&& git submodule update --init --recursive
	touch $@

else

OPENSSL_VERSION=1.0.2d
OPENSSL_SRC=$(OPENSSL)-$(OPENSSL_VERSION).tar.gz
OPENSSL_URL=https://www.openssl.org/source/$(OPENSSL_SRC)

$(DN_SRC)/$(OPENSSL_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(OPENSSL_URL)
	touch $@

$(OPENSSL)-$(OPENSSL_VERSION)/Configure: $(DN_SRC)/$(OPENSSL_SRC)
	tar -xf $(DN_SRC)/$(OPENSSL_SRC)
	touch $@
endif

$(OPENSSL)-$(OPENSSL_VERSION)/mypatched: $(OPENSSL)-$(OPENSSL_VERSION)/Configure
	if [ -d $(OPENSSL)-$(OPENSSL_VERSION)/.svn ]; then cd $(OPENSSL)-$(OPENSSL_VERSION)/ && svn revert -R . ; fi
	if [ -d $(OPENSSL)-$(OPENSSL_VERSION)/.hg ];  then cd $(OPENSSL)-$(OPENSSL_VERSION)/ && hg update -C . ; fi
	if [ -d $(OPENSSL)-$(OPENSSL_VERSION)/.git ]; then cd $(OPENSSL)-$(OPENSSL_VERSION)/ && git status | grep modified | awk '{print $$2}' | xargs git checkout ; fi
	cd $(OPENSSL)-$(OPENSSL_VERSION)/ && find . -name "Makefile*" | while read a ; do \
            sed -e 's|^INCLUDES=|INCLUDES=-I$(PREFIX_DEST)/$(PREFIX_CONF)/include |g'   -i $$a; \
            sed -e 's|^CFLAG=.*$$|CFLAG= -Os -I$(PREFIX_DEST)/$(PREFIX_CONF)/include|g' -i $$a; \
        done
	touch $@

$(OPENSSL)-$(OPENSSL_VERSION)/Makefile: $(OPENSSL)-$(OPENSSL_VERSION)/mypatched $(FL_DEP_OPENSSL)
	cd $(OPENSSL)-$(OPENSSL_VERSION)/ && $(ENV_COMPILE) ./Configure \
	        -L$(PREFIX_DEST)/$(PREFIX_CONF)/lib -lz \
	        shared zlib \
	        --prefix=$(PREFIX_CONF) --openssldir=$(PREFIX_CONF)/etc/ssl --libdir=lib \
	        $(optflags) $(openssltarget)
	touch $@

$(OPENSSL)-$(OPENSSL_VERSION)/libcrypto.pc: $(OPENSSL)-$(OPENSSL_VERSION)/Makefile
	cd $(OPENSSL)-$(OPENSSL_VERSION)/ && $(ENV_COMPILE) make -j1 depend
	cd $(OPENSSL)-$(OPENSSL_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)

$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libcrypto.pc: $(OPENSSL)-$(OPENSSL_VERSION)/libcrypto.pc
	cd $(OPENSSL)-$(OPENSSL_VERSION)/ && make -j1 INSTALL_PREFIX=$(PREFIX_DEST) MANDIR=$(PREFIX_CONF)/share/man MANSUFFIX=ssl install

$(OPENSSL)-uninstall: $(OPENSSL)-$(OPENSSL_VERSION)/libcrypto.pc
	cd $(OPENSSL)-$(OPENSSL_VERSION)/ && make uninstall
$(OPENSSL)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libcrypto.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(OPENSSL_SRC)
FL_UNINSTALL+=$(OPENSSL)-uninstall

########################################
# System V Release 4.0 curses emulation library
NCURSES=ncurses

FL_DEP_AUTOMAKE= \
	$(AUTOMAKE)-install \
	$(GAWK)-install \
	$(NULL)

NCURSES_VERSION=6.0
NCURSES_SRC=$(NCURSES)-$(NCURSES_VERSION).tar.gz
NCURSES_URL=ftp://invisible-island.net/ncurses/$(NCURSES_SRC)

$(DN_SRC)/$(NCURSES_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(NCURSES_URL)
	touch $@

$(NCURSES)-$(NCURSES_VERSION)/configure: $(DN_SRC)/$(NCURSES_SRC)
	tar -xf $(DN_SRC)/$(NCURSES_SRC)
	#cd $(NCURSES)-$(NCURSES_VERSION)/ && sed -e 's|DESTDIR="$$(DESTDIR)"|DESTDIR="$$(DESTDIR)/@prefix@"|' -i Makefile.in
	#cd $(NCURSES)-$(NCURSES_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

#$(NCURSES)-$(NCURSES_VERSION)/mypatched: $(DN_PATCH)/pbs-NCURSES-newapi.patch $(NCURSES)-$(NCURSES_VERSION)/configure
	#cd $(NCURSES)-$(NCURSES_VERSION)/ && patch -p1 < $(DN_PATCH)/pbs-NCURSES-newapi.patch
	#touch $@

$(NCURSES)-$(NCURSES_VERSION)/Makefile: $(NCURSES)-$(NCURSES_VERSION)/configure $(FL_DEP_NCURSES)
	cd $(NCURSES)-$(NCURSES_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --mandir=$(PREFIX_CONF)/share/man --with-shared --with-normal --without-debug --without-ada --enable-widec --enable-pc-files --with-cxx-binding --with-cxx-shared --enable-ext-colors --enable-ext-mouse
	touch $@
$(NCURSES)-$(NCURSES_VERSION)/misc/ncursesw.pc: $(NCURSES)-$(NCURSES_VERSION)/Makefile
	cd $(NCURSES)-$(NCURSES_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/ncursesw.pc: $(NCURSES)-$(NCURSES_VERSION)/misc/ncursesw.pc
	cd $(NCURSES)-$(NCURSES_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) PKG_CONFIG_LIBDIR=$(PREFIX_CONF)/lib/pkgconfig install
	touch $@

$(NCURSES)-uninstall: $(NCURSES)-$(NCURSES_VERSION)/misc/ncursesw.pc
	cd $(NCURSES)-$(NCURSES_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) PKG_CONFIG_LIBDIR=$(PREFIX_CONF)/lib/pkgconfig uninstall
$(NCURSES)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/ncursesw.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(NCURSES_SRC)
FL_UNINSTALL+=$(NCURSES)-uninstall

########################################
# OpenPGM: implementation of the Pragmatic General Multicast (PGM, RFC3208)
# http://code.google.com/p/openpgm
LIBPGM=libpgm

LIBPGM_VERSION=5.2.122
LIBPGM_SRC=$(LIBPGM)-$(LIBPGM_VERSION).tar.gz
LIBPGM_URL=http://openpgm.googlecode.com/files/$(LIBPGM_SRC)

$(DN_SRC)/$(LIBPGM_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBPGM_URL)
	touch $@

$(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm/configure: $(DN_SRC)/$(LIBPGM_SRC)
	tar -xf $(DN_SRC)/$(LIBPGM_SRC)
	cd $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm && find . -type f -exec sed -i 's/python/python2/g' {} \+
	#cd $(LIBPGM)-$(LIBPGM_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm/Makefile: $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm/configure $(FL_DEP_LIBPGM)
	cd $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@
$(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm/$(LIBPGM).la: $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm/Makefile
	cd $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBPGM).la: $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm/$(LIBPGM).la
	cd $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(LIBPGM)-uninstall: $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm/$(LIBPGM).la
	cd $(LIBPGM)-$(LIBPGM_VERSION)/openpgm/pgm && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBPGM)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBPGM).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBPGM_SRC)
FL_UNINSTALL+=$(LIBPGM)-uninstall

########################################
LIBPNG=libpng

FL_DEP_LIBPNG= \
	$(ZLIB)-install \
	$(NULL)

#LIBPNG_VERSION=1.5.14
#LIBPNG_SRC=$(LIBPNG)-$(LIBPNG_VERSION).tar.gz
#LIBPNG_URL=http://downloads.sf.net/project/libpng/libpng15/older-releases/$(LIBPNG_VERSION)/$(LIBPNG_SRC)
LIBPNG_VERSION=1.6.19
LIBPNG_SRC=$(LIBPNG)-$(LIBPNG_VERSION).tar.gz
LIBPNG_URL=http://downloads.sourceforge.net/project/libpng/libpng16/$(LIBPNG_VERSION)/$(LIBPNG_SRC)

$(DN_SRC)/$(LIBPNG_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBPNG_URL)
	touch $@
$(LIBPNG)-$(LIBPNG_VERSION)/configure: $(DN_SRC)/$(LIBPNG_SRC)
	tar -xf $(DN_SRC)/$(LIBPNG_SRC)
	touch $@
#$(LIBPNG)-$(LIBPNG_VERSION)/configure: $(LIBPNG)-$(LIBPNG_VERSION)/configure.ac
#	cd $(LIBPNG)-$(LIBPNG_VERSION)/ && ./autogen.sh
$(LIBPNG)-$(LIBPNG_VERSION)/Makefile: $(LIBPNG)-$(LIBPNG_VERSION)/configure $(FL_DEP_LIBPNG)
	cd $(LIBPNG)-$(LIBPNG_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shared
$(LIBPNG)-$(LIBPNG_VERSION)/$(LIBPNG).pc: $(LIBPNG)-$(LIBPNG_VERSION)/Makefile
	cd $(LIBPNG)-$(LIBPNG_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBPNG).pc: $(LIBPNG)-$(LIBPNG_VERSION)/$(LIBPNG).pc
	cd $(LIBPNG)-$(LIBPNG_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBPNG)-uninstall: $(LIBPNG)-$(LIBPNG_VERSION)/$(LIBPNG).pc
	cd $(LIBPNG)-$(LIBPNG_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBPNG)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBPNG).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBPNG_SRC)
FL_UNINSTALL+=$(LIBPNG)-uninstall

########################################
LIBTIFF=tiff
LIBTIFF_VERSION=4.0.6
LIBTIFF_SRC=$(LIBTIFF)-$(LIBTIFF_VERSION).tar.gz
LIBTIFF_URL="ftp://ftp.remotesensing.org/pub/libtiff/$(LIBTIFF_SRC)"

$(DN_SRC)/$(LIBTIFF_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBTIFF_URL)
	touch $@
$(LIBTIFF)-$(LIBTIFF_VERSION)/configure: $(DN_SRC)/$(LIBTIFF_SRC)
	tar -xf $(DN_SRC)/$(LIBTIFF_SRC)
	rm -f $(LIBTIFF)-install
	#mv tiff-$(LIBTIFF_VERSION) $(LIBTIFF)-$(LIBTIFF_VERSION)/
	touch $@
$(LIBTIFF)-$(LIBTIFF_VERSION)/Makefile: $(LIBTIFF)-$(LIBTIFF_VERSION)/configure $(FL_DEP_LIBTIFF)
	cd $(LIBTIFF)-$(LIBTIFF_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shared
$(LIBTIFF)-$(LIBTIFF_VERSION)/libtiff-4.pc: $(LIBTIFF)-$(LIBTIFF_VERSION)/Makefile
	cd $(LIBTIFF)-$(LIBTIFF_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libtiff-4.pc: $(LIBTIFF)-$(LIBTIFF_VERSION)/libtiff-4.pc
	cd $(LIBTIFF)-$(LIBTIFF_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBTIFF)-uninstall: $(LIBTIFF)-$(LIBTIFF_VERSION)/libtiff-4.pc
	cd $(LIBTIFF)-$(LIBTIFF_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBTIFF)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libtiff-4.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBTIFF_SRC)
FL_UNINSTALL+=$(LIBTIFF)-uninstall

########################################
# JPEG image codec with accelerated baseline compression and decompression
LIBJPEG=libjpeg-turbo

FL_DEP_LIBJPEG= \
	$(NASM)-install \
	$(NULL)

LIBJPEG_VERSION=1.4.2
LIBJPEG_SRC=$(LIBJPEG)-$(LIBJPEG_VERSION).tar.gz
LIBJPEG_URL=http://sourceforge.net/projects/$(LIBJPEG)/files/$(LIBJPEG_VERSION)/$(LIBJPEG_SRC)

$(DN_SRC)/$(LIBJPEG_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBJPEG_URL)
	touch $@
$(LIBJPEG)-$(LIBJPEG_VERSION)/configure: $(DN_SRC)/$(LIBJPEG_SRC)
	tar -xf $(DN_SRC)/$(LIBJPEG_SRC)
	touch $@
#$(LIBJPEG)-$(LIBJPEG_VERSION)/configure: $(LIBJPEG)-$(LIBJPEG_VERSION)/configure.ac
#	cd $(LIBJPEG)-$(LIBJPEG_VERSION)/ && ./autogen.sh
$(LIBJPEG)-$(LIBJPEG_VERSION)/Makefile: $(LIBJPEG)-$(LIBJPEG_VERSION)/configure $(FL_DEP_LIBJPEG)
	cd $(LIBJPEG)-$(LIBJPEG_VERSION)/ \
	    && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --with-jpeg8 #--enable-static --enable-shared
$(LIBJPEG)-$(LIBJPEG_VERSION)/libjpeg.la: $(LIBJPEG)-$(LIBJPEG_VERSION)/Makefile
	cd $(LIBJPEG)-$(LIBJPEG_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libjpeg.a: $(LIBJPEG)-$(LIBJPEG_VERSION)/libjpeg.la
	cd $(LIBJPEG)-$(LIBJPEG_VERSION)/ \
	    && $(ENV_COMPILE) make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m644 jpegint.h "$(PREFIX_DEST)/$(PREFIX_CONF)/include"

$(LIBJPEG)-uninstall: $(LIBJPEG)-$(LIBJPEG_VERSION)/libjpeg.a
	cd $(LIBJPEG)-$(LIBJPEG_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBJPEG)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libjpeg.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBJPEG_SRC)
FL_UNINSTALL+=$(LIBJPEG)-uninstall

########################################
# An open source JPEG 2000 codec
# http://www.openjpeg.org
LIBOPENJPEG=openjpeg

FL_DEP_LIBOPENJPEG= \
	$(CMAKE)-install \
	$(LIBTIFF)-install \
	$(LIBPNG)-install \
	$(NULL)

USE_GIT_LIBOPENJPEG=1

ifeq ($(USE_GIT_LIBOPENJPEG),1) # use git instead

LIBOPENJPEG_VERSION=git
LIBOPENJPEG_SRC=$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/CMakeLists.txt
LIBOPENJPEG_URL=https://github.com/uclouvain/openjpeg.git

$(DN_SRC)/$(LIBOPENJPEG_SRC): $(DN_SRC)/created
	if [ ! -d "$(DN_SRC)/$(LIBOPENJPEG_SRC)" ]; then \
        git clone $(LIBOPENJPEG_URL) $(DN_SRC)/$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION); \
    fi
	cd $(DN_SRC)/$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION) && git pull #&& git submodule update --init --recursive
	touch $@

$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/CMakeLists.txt: $(DN_SRC)/$(LIBOPENJPEG_SRC)
	cd $(DN_SRC)/$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/ && git pull
	if [ ! -d "$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)" ]; then \
        cp -r $(DN_SRC)/$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/ $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION); \
    fi
	cd $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION) && git pull #&& git submodule update --init --recursive
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/CMakeLists.txt
else

LIBOPENJPEG_VERSION=2.1
LIBOPENJPEG_SRC=$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION).tar.gz
LIBOPENJPEG_URL=https://github.com/uclouvain/openjpeg/archive/version.$(LIBOPENJPEG_VERSION).tar.gz

$(DN_SRC)/$(LIBOPENJPEG_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBOPENJPEG_URL)
	touch $@

$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/CMakeLists.txt: $(DN_SRC)/$(LIBOPENJPEG_SRC)
	tar -xf $(DN_SRC)/$(LIBOPENJPEG_SRC)
	rm -f $(LIBOPENJPEG)-install
	mv $(LIBOPENJPEG)* $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)
	#cd $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/
	touch $@
endif

$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/build/Makefile: $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/CMakeLists.txt $(FL_DEP_LIBOPENJPEG)
	cd $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/ && mkdir -p build && cd build \
		&& $(ENV_COMPILE) cmake \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_INSTALL_PREFIX=$(PREFIX_DEST)/$(PREFIX_CONF)/ \
            ..
$(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/build/libopenjp2.pc: $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/build/Makefile
	cd $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/build && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libopenjp2.pc: $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/build/libopenjp2.pc
	cd $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/build && make install
	touch $@

$(LIBOPENJPEG)-uninstall: $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/build/libopenjp2.pc
	cd $(LIBOPENJPEG)-$(LIBOPENJPEG_VERSION)/build && make uninstall
$(LIBOPENJPEG)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libopenjp2.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBOPENJPEG_SRC)
FL_UNINSTALL+=$(LIBOPENJPEG)-uninstall

# openjpeg 1.5.2 for ffmpeg
LIBOPENJPEG15=openjpeg1
LIBOPENJPEG15P=openjpeg

FL_DEP_LIBOPENJPEG15= \
	$(CMAKE)-install \
	$(LIBTIFF)-install \
	$(LIBPNG)-install \
	$(NULL)

LIBOPENJPEG15_VERSION=1.5.2
LIBOPENJPEG15_SRC=$(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION).tar.gz
LIBOPENJPEG15_URL=https://github.com/uclouvain/openjpeg/archive/version.$(LIBOPENJPEG15_VERSION).tar.gz

$(DN_SRC)/$(LIBOPENJPEG15_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBOPENJPEG15_URL)
	touch $@

$(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/CMakeLists.txt: $(DN_SRC)/$(LIBOPENJPEG15_SRC)
	tar -xf $(DN_SRC)/$(LIBOPENJPEG15_SRC)
	rm -f $(LIBOPENJPEG15)-install
	mv $(LIBOPENJPEG15P)*$(LIBOPENJPEG15_VERSION) $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)
	#cd $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/
	touch $@

$(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/build/Makefile: $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/CMakeLists.txt $(FL_DEP_LIBOPENJPEG15)
	cd $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/ && mkdir -p build && cd build \
		&& $(ENV_COMPILE) cmake \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_INSTALL_PREFIX=$(PREFIX_DEST)/$(PREFIX_CONF)/ \
            ..
$(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/build/libopenjpeg1.pc: $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/build/Makefile
	cd $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/build && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libopenjpeg1.pc: $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/build/libopenjpeg1.pc
	cd $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/build && make install
	touch $@

$(LIBOPENJPEG15)-uninstall: $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/build/libopenjpeg1.pc
	cd $(LIBOPENJPEG15P)-$(LIBOPENJPEG15_VERSION)/build && make uninstall
$(LIBOPENJPEG15)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libopenjpeg1.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBOPENJPEG15_SRC)
FL_UNINSTALL+=$(LIBOPENJPEG15)-uninstall


########################################
# A library for reading and writing gif images
GIFLIB=giflib

GIFLIB_VERSION=5.1.1
GIFLIB_SRC=$(GIFLIB)-$(GIFLIB_VERSION).tar.gz
GIFLIB_URL=http://sourceforge.net/projects/giflib/files/$(GIFLIB_SRC)

$(DN_SRC)/$(GIFLIB_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GIFLIB_URL)
	touch $@

$(GIFLIB)-$(GIFLIB_VERSION)/configure: $(DN_SRC)/$(GIFLIB_SRC)
	tar -xf $(DN_SRC)/$(GIFLIB_SRC)
	#cd $(GIFLIB)-$(GIFLIB_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(GIFLIB)-$(GIFLIB_VERSION)/Makefile: $(GIFLIB)-$(GIFLIB_VERSION)/configure $(FL_DEP_GIFLIB)
	cd $(GIFLIB)-$(GIFLIB_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@
$(GIFLIB)-$(GIFLIB_VERSION)/$(GIFLIB).la: $(GIFLIB)-$(GIFLIB_VERSION)/Makefile
	cd $(GIFLIB)-$(GIFLIB_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(GIFLIB).la: $(GIFLIB)-$(GIFLIB_VERSION)/$(GIFLIB).la
	cd $(GIFLIB)-$(GIFLIB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(GIFLIB)-uninstall: $(GIFLIB)-$(GIFLIB_VERSION)/$(GIFLIB).la
	cd $(GIFLIB)-$(GIFLIB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GIFLIB)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(GIFLIB).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GIFLIB_SRC)
FL_UNINSTALL+=$(GIFLIB)-uninstall

########################################
LIBWEBP=libwebp

FL_DEP_LIBWEBP= \
	$(AUTOMAKE)-install \
	$(LIBPNG)-install \
	$(LIBJPEG)-install \
	$(LIBTIFF)-install \
	$(GIFLIB)-install \
	$(NULL)

LIBWEBP_VERSION=0.4.4
LIBWEBP_SRC=$(LIBWEBP)-$(LIBWEBP_VERSION).tar.gz
LIBWEBP_URL=http://downloads.webmproject.org/releases/webp/$(LIBWEBP_SRC)

$(DN_SRC)/$(LIBWEBP_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBWEBP_URL)
	touch $@

$(LIBWEBP)-$(LIBWEBP_VERSION)/configure: $(DN_SRC)/$(LIBWEBP_SRC)
	tar -xf $(DN_SRC)/$(LIBWEBP_SRC)
	cd $(LIBWEBP)-$(LIBWEBP_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(LIBWEBP)-$(LIBWEBP_VERSION)/Makefile: $(LIBWEBP)-$(LIBWEBP_VERSION)/configure $(FL_DEP_LIBWEBP)
	cd $(LIBWEBP)-$(LIBWEBP_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
            --enable-swap-16bit-csp \
            --enable-experimental \
            --enable-libwebpmux \
            --enable-libwebpdemux \
            --enable-libwebpdecoder \
            --disable-static
	touch $@
$(LIBWEBP)-$(LIBWEBP_VERSION)/$(LIBWEBP).pc: $(LIBWEBP)-$(LIBWEBP_VERSION)/Makefile
	cd $(LIBWEBP)-$(LIBWEBP_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBWEBP).pc: $(LIBWEBP)-$(LIBWEBP_VERSION)/$(LIBWEBP).pc
	cd $(LIBWEBP)-$(LIBWEBP_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(LIBWEBP)-uninstall: $(LIBWEBP)-$(LIBWEBP_VERSION)/$(LIBWEBP).pc
	cd $(LIBWEBP)-$(LIBWEBP_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBWEBP)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBWEBP).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBWEBP_SRC)
FL_UNINSTALL+=$(LIBWEBP)-uninstall

########################################
FREETYPE=freetype
FREETYPE_VERSION=2.5.3
FREETYPE_VERSION=2.5.5
FREETYPE_SRC=$(FREETYPE)-$(FREETYPE_VERSION).tar.bz2
FREETYPE_URL=http://sourceforge.net/projects/freetype/files/freetype2/$(FREETYPE_VERSION)/$(FREETYPE_SRC)

# support libbz2 or not?
FREETYPE_SUPPORT_BZ2_CONF="--with-bzip2=no"
FREETYPE_SUPPORT_BZ2_PCLIB=""
#FREETYPE_SUPPORT_BZ2_CONF="--with-bzip2=yes"
#FREETYPE_SUPPORT_BZ2_PCLIB="-lbz2"

$(DN_SRC)/$(FREETYPE_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(FREETYPE_URL)
	touch $@
$(FREETYPE)-$(FREETYPE_VERSION)/CMakeLists.txt: $(DN_SRC)/$(FREETYPE_SRC)
	tar -xf $(DN_SRC)/$(FREETYPE_SRC)
	touch $@
$(FREETYPE)-$(FREETYPE_VERSION)/config.mk: $(FREETYPE)-$(FREETYPE_VERSION)/CMakeLists.txt
	cd $(FREETYPE)-$(FREETYPE_VERSION)/ \
	&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
		--with-sysroot=$(PREFIX_CONF) \
		--enable-static=yes \
		--enable-shared=yes \
		--with-harfbuzz=no \
		$(FREETYPE_SUPPORT_BZ2_CONF)
$(FREETYPE)-$(FREETYPE_VERSION)/objs/libfreetype.la: $(FREETYPE)-$(FREETYPE_VERSION)/config.mk
	cd $(FREETYPE)-$(FREETYPE_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libfreetype.a: $(FREETYPE)-$(FREETYPE_VERSION)/objs/libfreetype.la
	cd $(FREETYPE)-$(FREETYPE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	sed -i 's/-L$${libdir} -lfreetype[^l]*$$/-L$${libdir} -lfreetype -lxml2 -lexpat -lpng $(FREETYPE_SUPPORT_BZ2_PCLIB)/' "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/freetype2.pc"

$(FREETYPE)-uninstall: $(FREETYPE)-$(FREETYPE_VERSION)/objs/libfreetype.la
	cd $(FREETYPE)-$(FREETYPE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(FREETYPE)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libfreetype.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(FREETYPE_SRC)
FL_UNINSTALL+=$(FREETYPE)-uninstall


########################################
LIBXML2=libxml2

FL_DEP_LIBXML2= \
	$(ZLIB)-install \
	$(NULL)

LIBXML2_VERSION=2.9.3
LIBXML2_SRC=$(LIBXML2)-$(LIBXML2_VERSION).tar.gz
LIBXML2_URL=http://xmlsoft.org/sources/$(LIBXML2_SRC)

$(DN_SRC)/$(LIBXML2_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXML2_URL)
	touch $@
$(LIBXML2)-$(LIBXML2_VERSION)/configure: $(DN_SRC)/$(LIBXML2_SRC)
	tar -xf $(DN_SRC)/$(LIBXML2_SRC)
	touch $@
$(LIBXML2)-$(LIBXML2_VERSION)/Makefile: $(LIBXML2)-$(LIBXML2_VERSION)/configure $(FL_DEP_LIBXML2)
	cd $(LIBXML2)-$(LIBXML2_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --exec-prefix=$(PREFIX_CONF) --oldincludedir=$(PREFIX_CONF)/include --datadir=$(PREFIX_CONF) --with-zlib=$(PREFIX_CONF)/lib --with-python=no --enable-static --enable-shared
$(LIBXML2)-$(LIBXML2_VERSION)/libxml2.la: $(LIBXML2)-$(LIBXML2_VERSION)/Makefile
	cd $(LIBXML2)-$(LIBXML2_VERSION)/ && $(ENV_COMPILE) make LIBS=-lz $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libxml2.a: $(LIBXML2)-$(LIBXML2_VERSION)/libxml2.la
	cd $(LIBXML2)-$(LIBXML2_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXML2)-uninstall: $(LIBXML2)-$(LIBXML2_VERSION)/libxml2.la
	cd $(LIBXML2)-$(LIBXML2_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXML2)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libxml2.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXML2_SRC)
FL_UNINSTALL+=$(LIBXML2)-uninstall

########################################
LIBXSLT=libxslt

FL_DEP_LIBXSLT= \
	$(LIBXML2)-install \
	$(NULL)

LIBXSLT_VERSION=1.1.28
LIBXSLT_SRC=$(LIBXSLT)-$(LIBXSLT_VERSION).tar.gz
LIBXSLT_URL=http://xmlsoft.org/sources/$(LIBXSLT_SRC)

$(DN_SRC)/$(LIBXSLT_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXSLT_URL)
	touch $@
$(LIBXSLT)-$(LIBXSLT_VERSION)/configure: $(DN_SRC)/$(LIBXSLT_SRC)
	tar -xf $(DN_SRC)/$(LIBXSLT_SRC)
	touch $@
$(LIBXSLT)-$(LIBXSLT_VERSION)/Makefile: $(LIBXSLT)-$(LIBXSLT_VERSION)/configure $(FL_DEP_LIBXSLT)
	cd $(LIBXSLT)-$(LIBXSLT_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --exec-prefix=$(PREFIX_CONF) --with-libxml-prefix=$(PREFIX_CONF) --with-python=no --enable-static --enable-shared
$(LIBXSLT)-$(LIBXSLT_VERSION)/$(LIBXSLT).pc: $(LIBXSLT)-$(LIBXSLT_VERSION)/Makefile
	cd $(LIBXSLT)-$(LIBXSLT_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBXSLT).pc: $(LIBXSLT)-$(LIBXSLT_VERSION)/$(LIBXSLT).pc
	cd $(LIBXSLT)-$(LIBXSLT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXSLT)-uninstall: $(LIBXSLT)-$(LIBXSLT_VERSION)/$(LIBXSLT).pc
	cd $(LIBXSLT)-$(LIBXSLT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXSLT)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBXSLT).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXSLT_SRC)
FL_UNINSTALL+=$(LIBXSLT)-uninstall

########################################
FONTCONF=fontconfig
FONTCONF_VERSION=2.11.94
FONTCONF_SRC=$(FONTCONF)-$(FONTCONF_VERSION).tar.bz2
FONTCONF_URL=http://www.freedesktop.org/software/fontconfig/release/$(FONTCONF_SRC)

FL_DEP_FONTCONF= \
	$(LIBPNG)-install \
	$(LIBXML2)-install \
	$(EXPAT)-install \
	$(FREETYPE)-install \
	$(NULL)

$(DN_SRC)/$(FONTCONF_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(FONTCONF_URL)
	touch $@
$(FONTCONF)-$(FONTCONF_VERSION)/configure: $(DN_SRC)/$(FONTCONF_SRC)
	tar -xf $(DN_SRC)/$(FONTCONF_SRC)
	touch $@
$(FONTCONF)-$(FONTCONF_VERSION)/Makefile: $(FONTCONF)-$(FONTCONF_VERSION)/configure $(FL_DEP_FONTCONF)
	cd $(FONTCONF)-$(FONTCONF_VERSION)/ && $(ENV_COMPILE) CPPFLAGS+="-I$(PREFIX_DEST)/$(PREFIX_CONF)/include/freetype2/" FREETYPE_CFLAGS="`$(ENV_COMPILE) pkg-config --cflags freetype`" FREETYPE_LIBS="`$(ENV_COMPILE) pkg-config --libs freetype`" $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shared --disable-docs
$(FONTCONF)-$(FONTCONF_VERSION)/src/libfontconfig.la: $(FONTCONF)-$(FONTCONF_VERSION)/Makefile
	cd $(FONTCONF)-$(FONTCONF_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libfontconfig.a: $(FONTCONF)-$(FONTCONF_VERSION)/src/libfontconfig.la
	cd $(FONTCONF)-$(FONTCONF_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	sed -i 's/-L$${libdir} -lfontconfig[^l]*$$/-L$${libdir} -lfontconfig -lfreetype -lxml2 -lexpat -lpng/' "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/fontconfig.pc"

$(FONTCONF)-uninstall: $(FONTCONF)-$(FONTCONF_VERSION)/src/libfontconfig.la
	cd $(FONTCONF)-$(FONTCONF_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(FONTCONF)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libfontconfig.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(FONTCONF_SRC)
FL_UNINSTALL+=$(FONTCONF)-uninstall


########################################
#http://ftp.gnu.org/pub/gnu/gperf/gperf-3.0.4.tar.gz
GPERF=gperf
GPERF_VERSION=3.0.4
GPERF_SRC=$(GPERF)-$(GPERF_VERSION).tar.gz
GPERF_URL=http://ftp.gnu.org/pub/gnu/gperf/$(GPERF_SRC)

$(DN_SRC)/$(GPERF_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GPERF_URL)
	touch $@
$(GPERF)-$(GPERF_VERSION)/configure: $(DN_SRC)/$(GPERF_SRC)
	tar -xf $(DN_SRC)/$(GPERF_SRC)
	touch $@
$(GPERF)-$(GPERF_VERSION)/Makefile: $(GPERF)-$(GPERF_VERSION)/configure $(FL_DEP_GPERF)
	cd $(GPERF)-$(GPERF_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shared
$(GPERF)-$(GPERF_VERSION)/src/gperf: $(GPERF)-$(GPERF_VERSION)/Makefile
	cd $(GPERF)-$(GPERF_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/gperf: $(GPERF)-$(GPERF_VERSION)/src/gperf
	cd $(GPERF)-$(GPERF_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(GPERF)-uninstall: $(GPERF)-$(GPERF_VERSION)/src/gperf
	cd $(GPERF)-$(GPERF_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GPERF)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/gperf
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GPERF_SRC)
FL_UNINSTALL+=$(GPERF)-uninstall

########################################

LIBICONV=libiconv

LIBICONV_VERSION=1.14
LIBICONV_SRC=$(LIBICONV)-$(LIBICONV_VERSION).tar.gz
LIBICONV_URL=http://ftp.gnu.org/pub/gnu/$(LIBICONV)/$(LIBICONV_SRC)

$(DN_SRC)/$(LIBICONV_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBICONV_URL)
	touch $@

$(LIBICONV)-$(LIBICONV_VERSION)/configure.ac: $(DN_SRC)/$(LIBICONV_SRC)
	tar -xf $(DN_SRC)/$(LIBICONV_SRC)
	touch $@
$(LIBICONV)-$(LIBICONV_VERSION)/mypatched: $(DN_PATCH)/pbs-libiconv-stdio.patch $(LIBICONV)-$(LIBICONV_VERSION)/configure.ac $(FL_DEP_LIBICONV)
	if [ -d $(LIBICONV)-$(LIBICONV_VERSION)/.svn ]; then cd $(LIBICONV)-$(LIBICONV_VERSION)/ && svn revert -R . ; fi
	if [ -d $(LIBICONV)-$(LIBICONV_VERSION)/.hg ];  then cd $(LIBICONV)-$(LIBICONV_VERSION)/ && hg update -C . ; fi
	if [ -d $(LIBICONV)-$(LIBICONV_VERSION)/.git ]; then cd $(LIBICONV)-$(LIBICONV_VERSION)/ && git status | grep modified | awk '{print $$2}' | xargs git checkout ; fi
	cd $(LIBICONV)-$(LIBICONV_VERSION)/ && patch -p1 -i $(DN_PATCH)/pbs-libiconv-stdio.patch
	touch $@

$(LIBICONV)-$(LIBICONV_VERSION)/configure: $(LIBICONV)-$(LIBICONV_VERSION)/mypatched
	#cd $(LIBICONV)-$(LIBICONV_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(LIBICONV)-$(LIBICONV_VERSION)/Makefile: $(LIBICONV)-$(LIBICONV_VERSION)/configure
	cd $(LIBICONV)-$(LIBICONV_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --disable-nls
	touch $@
$(LIBICONV)-$(LIBICONV_VERSION)/$(LIBICONV).pc: $(LIBICONV)-$(LIBICONV_VERSION)/Makefile
	cd $(LIBICONV)-$(LIBICONV_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBICONV).pc: $(LIBICONV)-$(LIBICONV_VERSION)/$(LIBICONV).pc
	cd $(LIBICONV)-$(LIBICONV_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(LIBICONV)-uninstall: $(LIBICONV)-$(LIBICONV_VERSION)/$(LIBICONV).pc
	cd $(LIBICONV)-$(LIBICONV_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBICONV)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBICONV).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBICONV_SRC)
FL_UNINSTALL+=$(LIBICONV)-uninstall


########################################
GETTEXT=gettext

GETTEXT_VERSION=0.19.6
GETTEXT_SRC=$(GETTEXT)-$(GETTEXT_VERSION).tar.gz
GETTEXT_URL=ftp://ftp.gnu.org/pub/gnu/gettext/$(GETTEXT_SRC)

FL_DEP_GETTEXT= \
	$(AUTOMAKE)-install \
    $(NULL)

$(DN_SRC)/$(GETTEXT_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GETTEXT_URL)
	touch $@

$(GETTEXT)-$(GETTEXT_VERSION)/configure.ac: $(DN_SRC)/$(GETTEXT_SRC)
	tar -xf $(DN_SRC)/$(GETTEXT_SRC)
	touch $@

$(GETTEXT)-$(GETTEXT_VERSION)/configure: $(GETTEXT)-$(GETTEXT_VERSION)/configure.ac $(FL_DEP_GETTEXT)
	cd $(GETTEXT)-$(GETTEXT_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(GETTEXT)-$(GETTEXT_VERSION)/Makefile: $(GETTEXT)-$(GETTEXT_VERSION)/configure
	cd $(GETTEXT)-$(GETTEXT_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@

$(GETTEXT)-$(GETTEXT_VERSION)/gettext-tools/src/msgen: $(GETTEXT)-$(GETTEXT_VERSION)/Makefile
	cd $(GETTEXT)-$(GETTEXT_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/msgen: $(GETTEXT)-$(GETTEXT_VERSION)/gettext-tools/src/msgen
	cd $(GETTEXT)-$(GETTEXT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(GETTEXT)-uninstall: $(GETTEXT)-$(GETTEXT_VERSION)/gettext-tools/src/msgen
	cd $(GETTEXT)-$(GETTEXT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GETTEXT)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/msgen
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GETTEXT_SRC)
FL_UNINSTALL+=$(GETTEXT)-uninstall


########################################
# Miscellaneous system utilities for Linux
UTILLINUX=util-linux

FL_DEP_UTILLINUX= \
    $(GETTEXT)-install \
    $(AUTOMAKE)-install \
    $(NULL)

UTILLINUX_VERSION=2.27.1
UTILLINUX_SRC=$(UTILLINUX)-$(UTILLINUX_VERSION).tar.gz
UTILLINUX_URL=https://www.kernel.org/pub/linux/utils/util-linux/v2.27/$(UTILLINUX_SRC)

$(DN_SRC)/$(UTILLINUX_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(UTILLINUX_URL)
	touch $@

$(UTILLINUX)-$(UTILLINUX_VERSION)/configure.ac: $(DN_SRC)/$(UTILLINUX_SRC)
	tar -xf $(DN_SRC)/$(UTILLINUX_SRC)
	touch $@

$(UTILLINUX)-$(UTILLINUX_VERSION)/configure: $(UTILLINUX)-$(UTILLINUX_VERSION)/configure.ac $(FL_DEP_UTILLINUX)
	cd $(UTILLINUX)-$(UTILLINUX_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(UTILLINUX)-$(UTILLINUX_VERSION)/Makefile: $(UTILLINUX)-$(UTILLINUX_VERSION)/configure
	cd $(UTILLINUX)-$(UTILLINUX_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
              --libdir=$(PREFIX_CONF)/lib \
              --bindir=$(PREFIX_CONF)/bin \
              --localstatedir=/run \
              --enable-fs-paths-extra=$(PREFIX_CONF)/bin \
              --enable-raw \
              --enable-vipw \
              --enable-newgrp \
              --enable-chfn-chsh \
              --enable-write \
              --enable-mesg \
              --enable-libmount-force-mountinfo \
              --disable-makeinstall-chown --disable-makeinstall-setuid --disable-use-tty-group \
		$(NULL)
	touch $@

$(UTILLINUX)-$(UTILLINUX_VERSION)/fsck: $(UTILLINUX)-$(UTILLINUX_VERSION)/Makefile
	cd $(UTILLINUX)-$(UTILLINUX_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/fsck: $(UTILLINUX)-$(UTILLINUX_VERSION)/fsck
	cd $(UTILLINUX)-$(UTILLINUX_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install install-usrlib_execLTLIBRARIES
	touch $@

$(UTILLINUX)-uninstall: $(UTILLINUX)-$(UTILLINUX_VERSION)/fsck
	cd $(UTILLINUX)-$(UTILLINUX_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(UTILLINUX)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/fsck
	touch $@

FL_SOURCES+=$(DN_SRC)/$(UTILLINUX_SRC)
FL_UNINSTALL+=$(UTILLINUX)-uninstall

########################################
# Linux kernel module management tools and library
LIBKMOD=kmod

FL_DEP_LIBKMOD= \
    $(ZLIB)-install \
    $(AUTOMAKE)-install \
    $(NULL)

LIBKMOD_VERSION=22
LIBKMOD_SRC=$(LIBKMOD)-$(LIBKMOD_VERSION).tar.gz
LIBKMOD_URL=ftp://ftp.kernel.org/pub/linux/utils/kernel/$(LIBKMOD)/$(LIBKMOD_SRC)

$(DN_SRC)/$(LIBKMOD_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBKMOD_URL)
	touch $@

$(LIBKMOD)-$(LIBKMOD_VERSION)/configure.ac: $(DN_SRC)/$(LIBKMOD_SRC)
	tar -xf $(DN_SRC)/$(LIBKMOD_SRC)
	touch $@

$(LIBKMOD)-$(LIBKMOD_VERSION)/configure: $(LIBKMOD)-$(LIBKMOD_VERSION)/configure.ac $(FL_DEP_LIBKMOD)
	cd $(LIBKMOD)-$(LIBKMOD_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(LIBKMOD)-$(LIBKMOD_VERSION)/Makefile: $(LIBKMOD)-$(LIBKMOD_VERSION)/configure
	cd $(LIBKMOD)-$(LIBKMOD_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
        --sysconfdir=$(PREFIX_CONF)/etc \
        --disable-gtk-doc \
        --without-xz \
        --with-zlib \
		$(NULL)
	touch $@

$(LIBKMOD)-$(LIBKMOD_VERSION)/libkmod/libkmod.la: $(LIBKMOD)-$(LIBKMOD_VERSION)/Makefile
	cd $(LIBKMOD)-$(LIBKMOD_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libkmod.la: $(LIBKMOD)-$(LIBKMOD_VERSION)/libkmod/libkmod.la
	cd $(LIBKMOD)-$(LIBKMOD_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBKMOD)-uninstall: $(LIBKMOD)-$(LIBKMOD_VERSION)/libkmod/libkmod.la
	cd $(LIBKMOD)-$(LIBKMOD_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBKMOD)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libkmod.la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBKMOD_SRC)
FL_UNINSTALL+=$(LIBKMOD)-uninstall

########################################
# hardware identification databases
HWIDS=hwids

HWIDS_VERSION=20150717
HWIDS_SRC=$(HWIDS)-$(HWIDS_VERSION).tar.gz
HWIDS_URL=https://github.com/gentoo/hwids/archive/$(HWIDS_SRC)

$(DN_SRC)/$(HWIDS_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(HWIDS_URL)
	touch $@

$(HWIDS)-$(HWIDS_VERSION)/pci.ids: $(DN_SRC)/$(HWIDS_SRC)
	tar -xf $(DN_SRC)/$(HWIDS_SRC)
	rm -f $(HWIDS)-install
	mv $(HWIDS)-* $(HWIDS)-$(HWIDS_VERSION)
	touch $@

$(PREFIX_DEST)/$(PREFIX_CONF)/share/hwdata/pci.ids: $(HWIDS)-$(HWIDS_VERSION)/pci.ids
	cd $(HWIDS)-$(HWIDS_VERSION)/ \
		&& for ids in pci.ids usb.ids; do \
			install -Dm644 "$$ids" "$(PREFIX_DEST)/$(PREFIX_CONF)/share/hwdata/$${ids}" ; \
		done
	touch $@

$(HWIDS)-uninstall: $(HWIDS)-$(HWIDS_VERSION)/pci.ids
	cd $(HWIDS)-$(HWIDS_VERSION)/ \
		&& for ids in pci.ids usb.ids; do \
			rm -f "$(PREFIX_DEST)/$(PREFIX_CONF)/share/hwdata/$${ids}" \
		done
$(HWIDS)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/share/hwdata/pci.ids
	touch $@

FL_SOURCES+=$(DN_SRC)/$(HWIDS_SRC)
FL_UNINSTALL+=$(HWIDS)-uninstall

########################################
# PAM (Pluggable Authentication Modules) library
PAM=pam

########################################
# A unit testing framework for C
CHECK=check

CHECK_VERSION=0.10.0
CHECK_SRC=$(CHECK)-$(CHECK_VERSION).tar.gz
CHECK_URL=http://downloads.sourceforge.net/sourceforge/$(CHECK)/$(CHECK_SRC)

$(DN_SRC)/$(CHECK_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(CHECK_URL)
	touch $@

$(CHECK)-$(CHECK_VERSION)/configure: $(DN_SRC)/$(CHECK_SRC)
	tar -xf $(DN_SRC)/$(CHECK_SRC)
	touch $@

$(CHECK)-$(CHECK_VERSION)/Makefile: $(CHECK)-$(CHECK_VERSION)/configure
	cd $(CHECK)-$(CHECK_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --disable-static
$(CHECK)-$(CHECK_VERSION)/check.pc: $(CHECK)-$(CHECK_VERSION)/Makefile
	cd $(CHECK)-$(CHECK_VERSION)/ && $(ENV_COMPILE) make KEYCODES_PROGS=yes RESIZECONS_PROGS=yes $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/check.pc: $(CHECK)-$(CHECK_VERSION)/check.pc
	cd $(CHECK)-$(CHECK_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) KEYCODES_PROGS=yes RESIZECONS_PROGS=yes install

$(CHECK)-uninstall: $(CHECK)-$(CHECK_VERSION)/check.pc
	cd $(CHECK)-$(CHECK_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(CHECK)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/check.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(CHECK_SRC)
FL_UNINSTALL+=$(CHECK)-uninstall

########################################
# Keytable files and keyboard utilities
KBD=kbd

FL_DEP_KBD= \
    $(CHECK)-install \
    #$(PAM)-install \
    $(NULL)

KBD_VERSION=2.0.3
KBD_SRC=$(KBD)-$(KBD_VERSION).tar.gz
KBD_URL=ftp://ftp.altlinux.org/pub/people/legion/kbd/$(KBD_SRC)

$(DN_SRC)/$(KBD_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(KBD_URL)
	touch $@
$(DN_SRC)/kbd-fix-euro2.patch: $(DN_SRC)/created
	$(WGET) -O $@ https://projects.archlinux.org/svntogit/packages.git/plain/trunk/fix-euro2.patch?h=packages/kbd
	touch $@
FL_SOURCES+=$(DN_SRC)/kbd-fix-euro2.patch

$(KBD)-$(KBD_VERSION)/configure: $(DN_SRC)/$(KBD_SRC)
	tar -xf $(DN_SRC)/$(KBD_SRC)
	touch $@
$(KBD)-$(KBD_VERSION)/mypatched: $(DN_SRC)/kbd-fix-euro2.patch $(KBD)-$(KBD_VERSION)/configure $(FL_DEP_KBD)
	cd $(KBD)-$(KBD_VERSION)/ && patch -Np1 -i $(DN_SRC)/kbd-fix-euro2.patch
	touch $@

$(KBD)-$(KBD_VERSION)/Makefile: $(KBD)-$(KBD_VERSION)/mypatched
	cd $(KBD)-$(KBD_VERSION)/ && make distclean; $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --datadir=$(PREFIX_CONF)/share/kbd --mandir=$(PREFIX_CONF)/share/man
$(KBD)-$(KBD_VERSION)/src/libfont.a: $(KBD)-$(KBD_VERSION)/Makefile
	cd $(KBD)-$(KBD_VERSION)/ && $(ENV_COMPILE) make KEYCODES_PROGS=yes RESIZECONS_PROGS=yes $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libfont.a: $(KBD)-$(KBD_VERSION)/src/libfont.a
	cd $(KBD)-$(KBD_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) KEYCODES_PROGS=yes RESIZECONS_PROGS=yes install
	touch $@

$(KBD)-uninstall: $(KBD)-$(KBD_VERSION)/src/libfont.a
	cd $(KBD)-$(KBD_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(KBD)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libfont.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(KBD_SRC)
FL_UNINSTALL+=$(KBD)-uninstall


########################################
# Portable foreign function interface library
LIBFFI=libffi

LIBFFI_VERSION=3.2.1
LIBFFI_SRC=$(LIBFFI)-$(LIBFFI_VERSION).tar.gz
LIBFFI_URL=ftp://sourceware.org/pub/libffi/$(LIBFFI_SRC)

$(DN_SRC)/$(LIBFFI_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBFFI_URL)
	touch $@

$(DN_SRC)/libffi-fix-path-pc.patch: $(DN_SRC)/created
	$(WGET) -O $@ https://projects.archlinux.org/svntogit/packages.git/plain/trunk/0001-Fix-paths-in-libffi.pc.in.patch?h=packages/libffi
	touch $@
FL_SOURCES+=$(DN_SRC)/libffi-fix-path-pc.patch

$(LIBFFI)-$(LIBFFI_VERSION)/configure.ac: $(DN_SRC)/$(LIBFFI_SRC)
	tar -xf $(DN_SRC)/$(LIBFFI_SRC)
	touch $@
$(LIBFFI)-$(LIBFFI_VERSION)/mypatched: $(DN_SRC)/libffi-fix-path-pc.patch $(LIBFFI)-$(LIBFFI_VERSION)/configure.ac $(FL_DEP_LIBFFI)
	cd $(LIBFFI)-$(LIBFFI_VERSION)/ && sed -e 's|^AX_ENABLE_BUILDDIR|\#AX_ENABLE_BUILDDIR|' -i configure.ac
	#cd $(LIBFFI)-$(LIBFFI_VERSION)/ && patch -p1 -i $(DN_SRC)/libffi-fix-path-pc.patch
	touch $@
$(LIBFFI)-$(LIBFFI_VERSION)/configure: $(LIBFFI)-$(LIBFFI_VERSION)/mypatched
	cd $(LIBFFI)-$(LIBFFI_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@
$(LIBFFI)-$(LIBFFI_VERSION)/Makefile: $(LIBFFI)-$(LIBFFI_VERSION)/configure
	cd $(LIBFFI)-$(LIBFFI_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --disable-static --enable-pax_emutramp
	touch $@
$(LIBFFI)-$(LIBFFI_VERSION)/$(LIBFFI).la: $(LIBFFI)-$(LIBFFI_VERSION)/Makefile
	cd $(LIBFFI)-$(LIBFFI_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBFFI).la: $(LIBFFI)-$(LIBFFI_VERSION)/$(LIBFFI).la
	cd $(LIBFFI)-$(LIBFFI_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBFFI)-uninstall: $(LIBFFI)-$(LIBFFI_VERSION)/$(LIBFFI).la
	cd $(LIBFFI)-$(LIBFFI_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBFFI)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBFFI).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBFFI_SRC)
FL_UNINSTALL+=$(LIBFFI)-uninstall

########################################
# Utilities to handle ELF object files and DWARF debugging information
ELFUTILS=elfutils

FL_DEP_ELFUTILS= \
	$(ZLIB)-install \
	$(BZIP2)-install \
	$(NULL)

ELFUTILS_VERSION=0.164
ELFUTILS_SRC=$(ELFUTILS)-$(ELFUTILS_VERSION).tar.bz2
ELFUTILS_URL=https://fedorahosted.org/releases/e/l/elfutils/$(ELFUTILS_VERSION)/$(ELFUTILS_SRC)

$(DN_SRC)/$(ELFUTILS_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(ELFUTILS_URL)
	touch $@
$(ELFUTILS)-$(ELFUTILS_VERSION)/configure: $(DN_SRC)/$(ELFUTILS_SRC)
	tar -xf $(DN_SRC)/$(ELFUTILS_SRC)
	touch $@
$(ELFUTILS)-$(ELFUTILS_VERSION)/Makefile: $(ELFUTILS)-$(ELFUTILS_VERSION)/configure $(FL_DEP_ELFUTILS)
	cd $(ELFUTILS)-$(ELFUTILS_VERSION)/ && CFLAGS+=" -g" && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --program-prefix="eu-" --enable-deterministic-archives
	touch $@
$(ELFUTILS)-$(ELFUTILS_VERSION)/libelf/libelf.a: $(ELFUTILS)-$(ELFUTILS_VERSION)/Makefile
	cd $(ELFUTILS)-$(ELFUTILS_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libelf.a: $(ELFUTILS)-$(ELFUTILS_VERSION)/libelf/libelf.a
	cd $(ELFUTILS)-$(ELFUTILS_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(ELFUTILS)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(ELFUTILS)"

$(ELFUTILS)-uninstall: $(ELFUTILS)-$(ELFUTILS_VERSION)/libelf/libelf.a
	cd $(ELFUTILS)-$(ELFUTILS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(ELFUTILS)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libelf.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(ELFUTILS_SRC)
FL_UNINSTALL+=$(ELFUTILS)-uninstall

########################################
GLIB2=glib

FL_DEP_GLIB2= \
	$(AUTOMAKE)-install \
	$(LIBXSLT)-install \
	$(LIBFFI)-install \
	$(ELFUTILS)-install \
    $(NULL)

GLIB2_VERSION=2.47.3
GLIB2_SRC=$(GLIB2)-$(GLIB2_VERSION).tar.xz
GLIB2_URL=http://ftp.gnome.org/pub/GNOME/sources/glib/2.47/$(GLIB2_SRC)

$(DN_SRC)/$(GLIB2_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GLIB2_URL)
	touch $@

$(DN_SRC)/glib2-memleak.patch: $(DN_SRC)/created
	$(WGET) -O $@ https://projects.archlinux.org/svntogit/packages.git/plain/trunk/memleak.patch?h=packages/glib2
	touch $@
FL_SOURCES+=$(DN_SRC)/glib2-memleak.patch

$(DN_SRC)/glib2-revert-warn-glib-compile-schemas.patch: $(DN_SRC)/created
	$(WGET) -O $@ https://projects.archlinux.org/svntogit/packages.git/plain/trunk/revert-warn-glib-compile-schemas.patch?h=packages/glib2
	touch $@
FL_SOURCES+=$(DN_SRC)/glib2-revert-warn-glib-compile-schemas.patch

$(GLIB2)-$(GLIB2_VERSION)/configure.ac: $(DN_SRC)/$(GLIB2_SRC)
	tar -xf $(DN_SRC)/$(GLIB2_SRC)
	touch $@

$(GLIB2)-$(GLIB2_VERSION)/mypatched: $(DN_SRC)/glib2-memleak.patch $(DN_SRC)/glib2-revert-warn-glib-compile-schemas.patch $(GLIB2)-$(GLIB2_VERSION)/configure.ac $(FL_DEP_GLIB2)
	cd $(GLIB2)-$(GLIB2_VERSION)/ \
		&& patch -Rp1 -i $(DN_SRC)/glib2-revert-warn-glib-compile-schemas.patch \
        && patch -Np1 -i $(DN_SRC)/glib2-memleak.patch
	touch $@

$(GLIB2)-$(GLIB2_VERSION)/configure: $(GLIB2)-$(GLIB2_VERSION)/configure.ac $(FL_DEP_GLIB2)
	cd $(GLIB2)-$(GLIB2_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(GLIB2)-$(GLIB2_VERSION)/Makefile: $(GLIB2)-$(GLIB2_VERSION)/configure
	cd $(GLIB2)-$(GLIB2_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
			--libdir=$(PREFIX_CONF)/lib
			--sysconfdir=$(PREFIX_CONF)/etc \
			--with-pcre=system \
			--disable-fam \
		$(NULL)
	touch $@

$(GLIB2)-$(GLIB2_VERSION)/glib-2.0.pc: $(GLIB2)-$(GLIB2_VERSION)/Makefile
	cd $(GLIB2)-$(GLIB2_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/glib-2.0.pc: $(GLIB2)-$(GLIB2_VERSION)/glib-2.0.pc
	cd $(GLIB2)-$(GLIB2_VERSION)/ && make -j1 completiondir=$(PREFIX_DEST)/$(PREFIX_CONF)/share/bash-completion/completions DESTDIR=$(PREFIX_DEST) install
	for _i in "$(PREFIX_DEST)/$(PREFIX_CONF)/share/bash-completion/completions/"*; do \
		chmod -x "$$_i"; \
	done

$(GLIB2)-uninstall: $(GLIB2)-$(GLIB2_VERSION)/glib-2.0.pc
	cd $(GLIB2)-$(GLIB2_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GLIB2)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/glib-2.0.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GLIB2_SRC)
FL_UNINSTALL+=$(GLIB2)-uninstall

########################################
# Introspection system for GObject-based libraries
# https://live.gnome.org/GObjectIntrospection
GOBJINTROSPEC=gobject-introspection

GOBJINTROSPEC_VERSION=1.46.0
GOBJINTROSPEC_SRC=$(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION).tar.xz
GOBJINTROSPEC_URL=http://ftp.gnome.org/pub/gnome/sources/$(GOBJINTROSPEC)/1.46/$(GOBJINTROSPEC_SRC)

FL_DEP_GOBJINTROSPEC= \
	$(AUTOMAKE)-install \
	$(GLIB2)-install \
    $(NULL)

$(DN_SRC)/$(GOBJINTROSPEC_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GOBJINTROSPEC_URL)
	touch $@

$(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/configure.ac: $(DN_SRC)/$(GOBJINTROSPEC_SRC)
	tar -xf $(DN_SRC)/$(GOBJINTROSPEC_SRC)
	touch $@

$(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/configure: $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/configure.ac $(FL_DEP_GOBJINTROSPEC)
	cd $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/Makefile: $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/configure
	cd $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/ \
		&& $(ENV_COMPILE) PYTHON=python2 ./configure --prefix=$(PREFIX_CONF) --disable-static --disable-doctool
	touch $@

$(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/$(GOBJINTROSPEC)-1.0.pc: $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/Makefile
	cd $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/ && $(ENV_COMPILE) PYTHON=python2 make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(GOBJINTROSPEC)-1.0.pc: $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/$(GOBJINTROSPEC)-1.0.pc
	cd $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/ && PYTHON=python2 make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(GOBJINTROSPEC)-uninstall: $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/$(GOBJINTROSPEC)-1.0.pc
	cd $(GOBJINTROSPEC)-$(GOBJINTROSPEC_VERSION)/ && PYTHON=python2 make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GOBJINTROSPEC)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(GOBJINTROSPEC)-1.0.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GOBJINTROSPEC_SRC)
FL_UNINSTALL+=$(GOBJINTROSPEC)-uninstall

########################################
# libusb
LIBUSB=libusb

FL_DEP_LIBUSB= \
    $(AUTOMAKE)-install \
    $(NULL)

LIBUSB_VERSION=1.0.20
LIBUSB_SRC=$(LIBUSB)-$(LIBUSB_VERSION).tar.bz2
LIBUSB_URL=http://sourceforge.net/projects/libusb/files/libusb-1.0/libusb-$(LIBUSB_VERSION)/$(LIBUSB_SRC)

$(DN_SRC)/$(LIBUSB_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBUSB_URL)
	touch $@
$(LIBUSB)-$(LIBUSB_VERSION)/configure: $(DN_SRC)/$(LIBUSB_SRC)
	tar -xf $(DN_SRC)/$(LIBUSB_SRC)
	touch $@
$(LIBUSB)-$(LIBUSB_VERSION)/Makefile: $(LIBUSB)-$(LIBUSB_VERSION)/configure $(FL_DEP_LIBUSB)
	cd $(LIBUSB)-$(LIBUSB_VERSION)/ && make distclean; $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shared #--disable-shared
$(LIBUSB)-$(LIBUSB_VERSION)/libusb-1.0.pc: $(LIBUSB)-$(LIBUSB_VERSION)/Makefile
	cd $(LIBUSB)-$(LIBUSB_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libusb-1.0.pc: $(LIBUSB)-$(LIBUSB_VERSION)/libusb-1.0.pc
	cd $(LIBUSB)-$(LIBUSB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBUSB)-uninstall: $(LIBUSB)-$(LIBUSB_VERSION)/libusb-1.0.pc
	cd $(LIBUSB)-$(LIBUSB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBUSB)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libusb-1.0.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBUSB_SRC)
FL_UNINSTALL+=$(LIBUSB)-uninstall

########################################
# libudev
# https://www.kernel.org/pub/linux/utils/kernel/hotplug/udev-182.tar.gz
LIBUDEV0=udev
LIBUDEV0_VERSION=182
LIBUDEV0_SRC=$(LIBUDEV0)-$(LIBUDEV0_VERSION).tar.gz
LIBUDEV0_URL=https://www.kernel.org/pub/linux/utils/kernel/hotplug/$(LIBUDEV0_SRC)

FL_DEP_LIBUDEV0= \
    $(AUTOMAKE)-install \
    $(UTILLINUX)-install \
    $(GPERF)-install \
    $(LIBKMOD)-install \
    #$(USBUTILS)-install \
    $(NULL)

$(DN_SRC)/$(LIBUDEV0_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBUDEV0_URL)
	touch $@

$(LIBUDEV0)-$(LIBUDEV0_VERSION)/Makefile.am: $(DN_SRC)/$(LIBUDEV0_SRC)
	tar -xf $(DN_SRC)/$(LIBUDEV0_SRC)
	touch $@
$(LIBUDEV0)-$(LIBUDEV0_VERSION)/mypatched: $(DN_PATCH)/pbs-udev-182-librt.patch $(LIBUDEV0)-$(LIBUDEV0_VERSION)/Makefile.am
	if [ -d $(LIBUDEV0)-$(LIBUDEV0_VERSION)/.svn ]; then cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && svn revert -R . ; fi
	if [ -d $(LIBUDEV0)-$(LIBUDEV0_VERSION)/.hg ];  then cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && hg update -C . ; fi
	if [ -d $(LIBUDEV0)-$(LIBUDEV0_VERSION)/.git ]; then cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && git status | grep modified | awk '{print $$2}' | xargs git checkout ; fi
#	cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && patch -s -t -R -p1 < $(DN_PATCH)/pbs-udev-182-librt.patch && patch -p1 < $(DN_PATCH)/pbs-udev-182-librt.patch
	cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && patch -p1 < $(DN_PATCH)/pbs-udev-182-librt.patch
	#cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && sed -e 's|DESTDIR="$$(DESTDIR)"|DESTDIR="$$(DESTDIR)/@prefix@"|' -i Makefile.in
	touch $@

$(LIBUDEV0)-$(LIBUDEV0_VERSION)/configure: $(LIBUDEV0)-$(LIBUDEV0_VERSION)/mypatched $(FL_DEP_LIBUDEV0)
	cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(LIBUDEV0)-$(LIBUDEV0_VERSION)/Makefile: $(LIBUDEV0)-$(LIBUDEV0_VERSION)/configure
	cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shared --enable-gudev \
            --with-libdir=$(PREFIX_CONF)/lib \
            --with-systemdsystemunitdir=$(PREFIX_CONF)/lib/systemd/system/ \
            --libexecdir=$(PREFIX_CONF)/lib/ \
		$(NULL)
	touch $@

$(LIBUDEV0)-$(LIBUDEV0_VERSION)/src/udev.pc: $(LIBUDEV0)-$(LIBUDEV0_VERSION)/Makefile
	cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/udev.pc: $(LIBUDEV0)-$(LIBUDEV0_VERSION)/src/udev.pc
	cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBUDEV0)-uninstall: $(LIBUDEV0)-$(LIBUDEV0_VERSION)/src/udev.pc
	cd $(LIBUDEV0)-$(LIBUDEV0_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBUDEV0)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/udev.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBUDEV0_SRC)
FL_UNINSTALL+=$(LIBUDEV0)-uninstall

##########
# The userspace dev tools (udev) forked by Gentoo
LIBUDEV1=eudev
LIBUDEV1_VERSION=3.1.2
LIBUDEV1_SRC=$(LIBUDEV1)-$(LIBUDEV1_VERSION).tar.gz
LIBUDEV1_URL=https://github.com/gentoo/eudev/archive/v$(LIBUDEV1_VERSION).tar.gz

FL_DEP_LIBUDEV1= \
    $(AUTOMAKE)-install \
    $(UTILLINUX)-install \
    $(GPERF)-install \
    $(LIBKMOD)-install \
    $(KBD)-install \
    $(GOBJINTROSPEC)-install \
    $(HWIDS)-install \
    $(NULL)

$(DN_SRC)/$(LIBUDEV1_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBUDEV1_URL)
	touch $@

$(LIBUDEV1)-$(LIBUDEV1_VERSION)/Makefile.am: $(DN_SRC)/$(LIBUDEV1_SRC)
	tar -xf $(DN_SRC)/$(LIBUDEV1_SRC)
	touch $@
$(LIBUDEV1)-$(LIBUDEV1_VERSION)/mypatched: $(DN_PATCH)/pbs-udev-182-librt.patch $(LIBUDEV1)-$(LIBUDEV1_VERSION)/Makefile.am
	if [ -d $(LIBUDEV1)-$(LIBUDEV1_VERSION)/.svn ]; then cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && svn revert -R . ; fi
	if [ -d $(LIBUDEV1)-$(LIBUDEV1_VERSION)/.hg ];  then cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && hg update -C . ; fi
	if [ -d $(LIBUDEV1)-$(LIBUDEV1_VERSION)/.git ]; then cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && git status | grep modified | awk '{print $$2}' | xargs git checkout ; fi
#	cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && patch -s -t -R -p1 < $(DN_PATCH)/pbs-udev-182-librt.patch && patch -p1 < $(DN_PATCH)/pbs-udev-182-librt.patch
#	cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && patch -p1 < $(DN_PATCH)/pbs-udev-182-librt.patch
	#cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && sed -e 's|DESTDIR="$$(DESTDIR)"|DESTDIR="$$(DESTDIR)/@prefix@"|' -i Makefile.in
	touch $@

$(LIBUDEV1)-$(LIBUDEV1_VERSION)/configure: $(LIBUDEV1)-$(LIBUDEV1_VERSION)/mypatched $(FL_DEP_LIBUDEV1)
	cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && $(ENV_COMPILE) ./autogen.sh #&& $(ENV_COMPILE) autoreconf -if
	touch $@

$(LIBUDEV1)-$(LIBUDEV1_VERSION)/Makefile: $(LIBUDEV1)-$(LIBUDEV1_VERSION)/configure
	cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
			--with-rootprefix=$(PREFIX_CONF)/ \
			--sysconfdir=$(PREFIX_CONF)/etc \
			--libdir=$(PREFIX_CONF)/lib \
			--sbindir=$(PREFIX_CONF)/bin \
			--with-html-dir=$(PREFIX_CONF)/share/doc/${pkgname}-${pkgver}/html \
			--enable-gudev \
			--enable-introspection \
			--enable-kmod \
			--enable-manpages \
			--enable-split-usr \
			#--enable-static --enable-shared \
		$(NULL)
	touch $@

$(LIBUDEV1)-$(LIBUDEV1_VERSION)/src/libudev/libudev.la: $(LIBUDEV1)-$(LIBUDEV1_VERSION)/Makefile
	cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libudev.la: $(LIBUDEV1)-$(LIBUDEV1_VERSION)/src/libudev/libudev.la
	cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	for i in "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/udev/rules.d/"*.rules; do \
		sed -i -e 's#GROUP="dialout"#GROUP="uucp"#g; s#GROUP="tape"#GROUP="storage"#g; s#GROUP="cdrom"#GROUP="optical"#g' "$${i}" ; \
	done

$(LIBUDEV1)-uninstall: $(LIBUDEV1)-$(LIBUDEV1_VERSION)/src/libudev/libudev.la
	cd $(LIBUDEV1)-$(LIBUDEV1_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBUDEV1)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libudev.la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBUDEV1_SRC)
FL_UNINSTALL+=$(LIBUDEV1)-uninstall

##########
LIBUDEV=$(LIBUDEV1)

########################################
USBUTILS=usbutils

FL_DEP_USBUTILS= \
    $(AUTOMAKE)-install \
    $(ZLIB)-install \
    $(LIBUSB)-install \
    $(LIBUDEV)-install \
    $(NULL)

USBUTILS_VERSION=008
USBUTILS_SRC=$(USBUTILS)-$(USBUTILS_VERSION).tar.gz
USBUTILS_URL=http://www.kernel.org/pub/linux/utils/usb/usbutils/$(USBUTILS_SRC)

$(DN_SRC)/$(USBUTILS_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(USBUTILS_URL)
	touch $@

$(USBUTILS)-$(USBUTILS_VERSION)/configure.ac: $(DN_SRC)/$(USBUTILS_SRC)
	tar -xf $(DN_SRC)/$(USBUTILS_SRC)
	touch $@

$(USBUTILS)-$(USBUTILS_VERSION)/configure: $(USBUTILS)-$(USBUTILS_VERSION)/configure.ac $(FL_DEP_USBUTILS)
	cd $(USBUTILS)-$(USBUTILS_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(USBUTILS)-$(USBUTILS_VERSION)/Makefile: $(USBUTILS)-$(USBUTILS_VERSION)/configure
	cd $(USBUTILS)-$(USBUTILS_VERSION)/ \
		&& $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
        --datadir=$(PREFIX_CONF)/share/hwdata --disable-zlib \
		$(NULL)
	touch $@

$(USBUTILS)-$(USBUTILS_VERSION)/$(USBUTILS).pc: $(USBUTILS)-$(USBUTILS_VERSION)/Makefile
	cd $(USBUTILS)-$(USBUTILS_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(USBUTILS).pc: $(USBUTILS)-$(USBUTILS_VERSION)/$(USBUTILS).pc
	cd $(USBUTILS)-$(USBUTILS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(USBUTILS)-uninstall: $(USBUTILS)-$(USBUTILS_VERSION)/$(USBUTILS).pc
	cd $(USBUTILS)-$(USBUTILS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(USBUTILS)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(USBUTILS).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(USBUTILS_SRC)
FL_UNINSTALL+=$(USBUTILS)-uninstall

########################################
# libraw1394
LIBRAW1394=libraw1394
LIBRAW1394_VERSION=2.1.1
LIBRAW1394_SRC=$(LIBRAW1394)-$(LIBRAW1394_VERSION).tar.gz
LIBRAW1394_URL=ftp://ftp.kernel.org/pub/linux/libs/ieee1394/$(LIBRAW1394_SRC)

$(DN_SRC)/$(LIBRAW1394_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBRAW1394_URL)
	touch $@
$(LIBRAW1394)-$(LIBRAW1394_VERSION)/configure: $(DN_SRC)/$(LIBRAW1394_SRC)
	tar -xf $(DN_SRC)/$(LIBRAW1394_SRC)
	touch $@
$(LIBRAW1394)-$(LIBRAW1394_VERSION)/Makefile: $(LIBRAW1394)-$(LIBRAW1394_VERSION)/configure $(FL_DEP_LIBRAW1394)
	cd $(LIBRAW1394)-$(LIBRAW1394_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shared
$(LIBRAW1394)-$(LIBRAW1394_VERSION)/libraw1394.pc: $(LIBRAW1394)-$(LIBRAW1394_VERSION)/Makefile
	cd $(LIBRAW1394)-$(LIBRAW1394_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBRAW1394).pc: $(LIBRAW1394)-$(LIBRAW1394_VERSION)/$(LIBRAW1394).pc
	cd $(LIBRAW1394)-$(LIBRAW1394_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBRAW1394)-uninstall: $(LIBRAW1394)-$(LIBRAW1394_VERSION)/$(LIBRAW1394).pc
	cd $(LIBRAW1394)-$(LIBRAW1394_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBRAW1394)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBRAW1394).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBRAW1394_SRC)
FL_UNINSTALL+=$(LIBRAW1394)-uninstall

########################################
# libdc1394
LIBDC1394=libdc1394

FL_DEP_LIBDC1394= \
	$(LIBRAW1394)-install \
	#$(LIBUSB)-install \
	$(NULL)

LIBDC1394_VERSION=2.2.3
LIBDC1394_SRC=$(LIBDC1394)-$(LIBDC1394_VERSION).tar.gz
LIBDC1394_URL=http://sourceforge.net/projects/libdc1394/files/libdc1394-2/$(LIBDC1394_VERSION)/$(LIBDC1394_SRC)

$(DN_SRC)/sdl.m4: $(DN_SRC)/created
	$(WGET) -O $@ -c http://hg.libsdl.org/SDL/raw-file/06be4b33029d/sdl.m4
	touch $@
$(DN_SRC)/sdl2.m4: $(DN_SRC)/created
	$(WGET) -O $@ -c http://hg.libsdl.org/SDL/raw-file/e82bfd942409/sdl2.m4
	touch $@
FL_SOURCES+=$(DN_SRC)/sdl.m4
FL_SOURCES+=$(DN_SRC)/sdl2.m4

$(DN_SRC)/$(LIBDC1394_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBDC1394_URL)
	touch $@
$(LIBDC1394)-$(LIBDC1394_VERSION)/configure.ac: $(DN_SRC)/$(LIBDC1394_SRC)
	tar -xf $(DN_SRC)/$(LIBDC1394_SRC)
	touch $@
$(LIBDC1394)-$(LIBDC1394_VERSION)/mypatched: $(DN_SRC)/sdl.m4 $(LIBDC1394)-$(LIBDC1394_VERSION)/configure.ac
	if [ -d $(LIBDC1394)-$(LIBDC1394_VERSION)/.svn ]; then cd $(LIBDC1394)-$(LIBDC1394_VERSION)/ && svn revert -R . ; fi
	if [ -d $(LIBDC1394)-$(LIBDC1394_VERSION)/.hg ];  then cd $(LIBDC1394)-$(LIBDC1394_VERSION)/ && hg update -C . ; fi
	if [ -d $(LIBDC1394)-$(LIBDC1394_VERSION)/.git ]; then cd $(LIBDC1394)-$(LIBDC1394_VERSION)/ && git status | grep modified | awk '{print $$2}' | xargs git checkout ; fi
	#cd $(LIBDC1394)-$(LIBDC1394_VERSION) && sed -e 's|AC_C_RESTRICT|AC_C_RESTRICT\nPKG_CHECK_MODULES(LIBUDEV, [libudev],[AC_DEFINE(HAVE_LIBUDEV,[],[Defined if libudev is present])], [AC_MSG_WARN([libudev not found])])|' -i configure.ac
	cd $(LIBDC1394)-$(LIBDC1394_VERSION) && sed -e 's|inline |inline static |' -i examples/dc1394_vloopback.c
	cp $(DN_SRC)/sdl.m4 $(LIBDC1394)-$(LIBDC1394_VERSION)/m4/
	touch $@

$(LIBDC1394)-$(LIBDC1394_VERSION)/configure: $(LIBDC1394)-$(LIBDC1394_VERSION)/mypatched $(FL_DEP_LIBDC1394)
	cd $(LIBDC1394)-$(LIBDC1394_VERSION) && $(ENV_COMPILE) autoreconf -if
	touch $@

$(LIBDC1394)-$(LIBDC1394_VERSION)/Makefile: $(LIBDC1394)-$(LIBDC1394_VERSION)/configure
	cd $(LIBDC1394)-$(LIBDC1394_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --disable-static #--enable-static #--diable-shared
$(LIBDC1394)-$(LIBDC1394_VERSION)/libdc1394-2.pc: $(LIBDC1394)-$(LIBDC1394_VERSION)/Makefile
	cd $(LIBDC1394)-$(LIBDC1394_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libdc1394-2.pc: $(LIBDC1394)-$(LIBDC1394_VERSION)/libdc1394-2.pc
	cd $(LIBDC1394)-$(LIBDC1394_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBDC1394)-uninstall: $(LIBDC1394)-$(LIBDC1394_VERSION)/libdc1394-2.pc
	cd $(LIBDC1394)-$(LIBDC1394_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBDC1394)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libdc1394-2.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBDC1394_SRC)
FL_UNINSTALL+=$(LIBDC1394)-uninstall


########################################
LVPX=libvpx

FL_DEP_LVPX= \
	$(YASM)-install \
	$(NULL)

USE_GIT_LVPX=0

ifeq ($(USE_GIT_LVPX),1) # use git instead

LVPX_VERSION=git
LVPX_SRC=$(LVPX)-$(LVPX_VERSION)/configure
LVPX_URL=https://chromium.googlesource.com/webm/libvpx

$(DN_SRC)/$(LVPX)-$(LVPX_VERSION)/configure: $(DN_SRC)/created
	git clone $(LVPX_URL) $(DN_SRC)/$(LVPX)-$(LVPX_VERSION)
	touch $@
$(LVPX)-$(LVPX_VERSION)/configure: $(DN_SRC)/$(LVPX)-$(LVPX_VERSION)/configure
	cd $(DN_SRC)/$(LVPX)-$(LVPX_VERSION)/ && git pull
#	rm -rf $(DN_TOP)/$(LVPX)*
#	cp -r $(DN_SRC)/$(LVPX)-$(LVPX_VERSION) $(DN_TOP)/
	if [ -d "$(LVPX)-$(LVPX_VERSION)" ]; then cd $(LVPX)-$(LVPX_VERSION) && git pull; else git clone $(DN_SRC)/$(LVPX)-$(LVPX_VERSION)/ $(LVPX)-$(LVPX_VERSION); fi
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LVPX)-$(LVPX_VERSION)/configure
else
LVPX_VERSION=1.5.0
LVPX_SRC=$(LVPX)-$(LVPX_VERSION).tar.gz
LVPX_URL=https://github.com/webmproject/libvpx/archive/v$(LVPX_VERSION).tar.gz

$(DN_SRC)/$(LVPX_SRC): $(DN_SRC)/created
	#git archive --format=tar --remote=https://chromium.googlesource.com/webm/libvpx v$(LVPX_VERSION) | gzip -9 > $@
	$(WGET) -O $@ -c $(LVPX_URL)
	touch $@

$(LVPX)-$(LVPX_VERSION)/configure: $(DN_SRC)/$(LVPX_SRC)
	tar -xf $(DN_SRC)/$(LVPX_SRC)
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LVPX_SRC)
endif

$(LVPX)-$(LVPX_VERSION)/Makefile: $(LVPX)-$(LVPX_VERSION)/configure $(FL_DEP_LVPX)
#disable vp9:	cd $(LVPX)-* && $(ENV_COMPILE) ./configure --as=yasm --prefix=$(PREFIX_CONF) --enable-static --enable-shared --disable-examples --disable-docs --disable-unit-tests --enable-vp8 --enable-vp9
	cd $(LVPX)-* && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --as=yasm --enable-static --enable-shared --disable-examples --disable-docs --disable-unit-tests --enable-vp8 --enable-vp9
#use static:	cd $(LVPX)-* && $(ENV_COMPILE) ./configure --as=yasm --prefix=$(PREFIX_CONF) --enable-static --disable-shared --disable-examples --disable-docs --disable-unit-tests --enable-vp8 --disable-vp9

$(LVPX)-$(LVPX_VERSION)/libvpx.a: $(LVPX)-$(LVPX_VERSION)/Makefile
	cd $(LVPX)-* && $(ENV_COMPILE) make $(MAKE_ARG)

$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libvpx.a: $(LVPX)-$(LVPX_VERSION)/libvpx.a
	cd $(LVPX)-* && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LVPX)-uninstall: $(LVPX)-$(LVPX_VERSION)/libvpx.a
	cd $(LVPX)-* && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LVPX)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libvpx.a
	touch $@

FL_UNINSTALL+=$(LVPX)-uninstall


########################################
# Enables programs to use display computer terminals in a device-independent manner
TERMCAP=termcap

FL_DEP_TERMCAP= \
	$(NCURSES)-install \
	$(NULL)

TERMCAP_VERSION=1.3.1
#TERMCAP_SRC=$(TERMCAP)-$(TERMCAP_VERSION).tar.gz
#TERMCAP_URL="http://ftp.gnu.org/gnu/$(TERMCAP)/$(TERMCAP_SRC)"

#$(DN_SRC)/$(TERMCAP_SRC): $(DN_SRC)/created
#	$(WGET) -O $@ -c $(TERMCAP_URL)
#	touch $@
#$(TERMCAP)-$(TERMCAP_VERSION)/configure: $(DN_SRC)/$(TERMCAP_SRC)
#	tar -xf $(DN_SRC)/$(TERMCAP_SRC)
#	#mv $(TERMCAP)$(TERMCAP_VERSION) $(TERMCAP)-$(TERMCAP_VERSION)/
#	touch $@
#$(TERMCAP)-$(TERMCAP_VERSION)/Makefile: $(TERMCAP)-$(TERMCAP_VERSION)/configure $(FL_DEP_TERMCAP)
#	cd $(TERMCAP)-$(TERMCAP_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
#$(TERMCAP)-$(TERMCAP_VERSION)/libtermcap.a: $(TERMCAP)-$(TERMCAP_VERSION)/Makefile
#	cd $(TERMCAP)-$(TERMCAP_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
#	touch $@
#$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libtermcap.a: $(TERMCAP)-$(TERMCAP_VERSION)/libtermcap.a
#	cd $(TERMCAP)-$(TERMCAP_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
#$(TERMCAP)-uninstall: $(TERMCAP)-$(TERMCAP_VERSION)/Makefile
#	cd $(TERMCAP)-$(TERMCAP_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
#$(TERMCAP)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libtermcap.a
#	touch $@

#FL_SOURCES+=$(DN_SRC)/$(TERMCAP_SRC)
#FL_UNINSTALL+=$(TERMCAP)-uninstall

$(TERMCAP)-uninstall:
	rm -f $(PREFIX_DEST)/$(PREFIX_CONF)/libtermcap.a
	rm -f $(PREFIX_DEST)/$(PREFIX_CONF)/libtermcap.so
$(TERMCAP)-install: $(FL_DEP_TERMCAP)
	mkdir -p $(PREFIX_DEST)/$(PREFIX_CONF)/lib/termcap/
	ln -s libncursesw.a  $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libcurses.a
	ln -s libncursesw.so  $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libcurses.so
	ln -s ../libncursesw.a  $(PREFIX_DEST)/$(PREFIX_CONF)/lib/termcap/libtermcap.a
	ln -s libncursesw.so $(PREFIX_DEST)/$(PREFIX_CONF)/libtermcap.so
	touch $@

########################################
READLINE=readline

FL_DEP_READLINE= \
	$(TERMCAP)-install \
	$(GNUAWK)-install \
	$(NULL)

READLINE_VERSION=6.3
READLINE_SRC=$(READLINE)-$(READLINE_VERSION).tar.gz
READLINE_URL="http://ftp.gnu.org/gnu/$(READLINE)/$(READLINE_SRC)"

$(DN_SRC)/$(READLINE_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(READLINE_URL)
	touch $@
$(READLINE)-$(READLINE_VERSION)/configure.ac: $(DN_SRC)/$(READLINE_SRC)
	tar -xf $(DN_SRC)/$(READLINE_SRC)
	#mv $(READLINE)$(READLINE_VERSION) $(READLINE)-$(READLINE_VERSION)/
	touch $@

$(READLINE)-$(READLINE_VERSION)/mypatched: $(DN_PATCH)/pbs-readline-pkgconfig.patch $(READLINE)-$(READLINE_VERSION)/configure.ac
	# create readline.pc
	cd $(READLINE)-$(READLINE_VERSION)/ \
        && patch -Np1 < $(DN_PATCH)/pbs-readline-pkgconfig.patch \
        && sed -i 's/-L$${libdir} -lreadline.*$$/-L$${libdir} -lreadline -lncursesw/' $(READLINE).pc.in
	# ncurses
	cd $(READLINE)-$(READLINE_VERSION)/ && sed -e 's|SHLIB_LIBS=.*$$|SHLIB_LIBS=-lncursesw|'    -i support/shobj-conf
	cd $(READLINE)-$(READLINE_VERSION)/ && sed -e 's|TERMCAP_LIB =.*$$|TERMCAP_LIB=-lncursesw|' -i shlib/Makefile.in
	cd $(READLINE)-$(READLINE_VERSION)/ && sed -e 's|TERMCAP_LIB =.*$$|TERMCAP_LIB=-lncursesw @TERMCAP_LIB@|' -i Makefile.in
	touch $@

$(READLINE)-$(READLINE_VERSION)/configure: $(READLINE)-$(READLINE_VERSION)/mypatched $(FL_DEP_READLINE)
	#cd $(READLINE)-$(READLINE_VERSION) && $(ENV_COMPILE) autoreconf -if
	touch $@

$(READLINE)-$(READLINE_VERSION)/Makefile: $(READLINE)-$(READLINE_VERSION)/configure
	cd $(READLINE)-$(READLINE_VERSION)/ && $(ENV_COMPILE) TERMCAP_LIB="-lncursesw" ./configure --prefix=$(PREFIX_CONF) --with-curses

$(READLINE)-$(READLINE_VERSION)/$(READLINE).pc: $(READLINE)-$(READLINE_VERSION)/Makefile
	cd $(READLINE)-$(READLINE_VERSION)/ && make $(MAKE_ARG)
	readelf -a $(READLINE)-$(READLINE_VERSION)/shlib/libreadline.so.$(READLINE_VERSION) | grep NEEDED | grep curses; \
	    if [ ! "$$?" = "0" ]; then echo "Error in compile readline lib!!"; exit 1; fi
	touch $@
# other commands to view shared lib:
# readelf -a /usr/lib/libncurses.so | grep UP
# ldd -r /usr/lib/libreadline.so.5 | grep und

$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(READLINE).pc: $(READLINE)-$(READLINE_VERSION)/$(READLINE).pc
	cd $(READLINE)-$(READLINE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(READLINE)-uninstall: $(READLINE)-$(READLINE_VERSION)/Makefile
	cd $(READLINE)-$(READLINE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(READLINE)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(READLINE).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(READLINE_SRC)
FL_UNINSTALL+=$(READLINE)-uninstall

########################################
SQLITE=sqlite

FL_DEP_SQLITE= \
	$(READLINE)-install \
	$(NULL)

SQLITE_VERSION=3090200
SQLITE_SRC=$(SQLITE)-autoconf-$(SQLITE_VERSION).tar.gz
SQLITE_URL="http://www.sqlite.org/2015/$(SQLITE_SRC)"

$(DN_SRC)/$(SQLITE_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(SQLITE_URL)
	touch $@
$(SQLITE)-$(SQLITE_VERSION)/configure: $(DN_SRC)/$(SQLITE_SRC)
	tar -xf $(DN_SRC)/$(SQLITE_SRC)
	mv $(SQLITE)-autoconf-$(SQLITE_VERSION) $(SQLITE)-$(SQLITE_VERSION)/
	touch $@

$(SQLITE)-$(SQLITE_VERSION)/Makefile: $(SQLITE)-$(SQLITE_VERSION)/configure $(FL_DEP_SQLITE)
	cd $(SQLITE)-$(SQLITE_VERSION)/ \
	    && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --disable-static TCLLIBDIR=$(PREFIX_CONF)/lib/sqlite$(SQLITE_VERSION)
	touch $@

CFLAGS_SQLITE=-DSQLITE_ENABLE_FTS3=1 -DSQLITE_ENABLE_COLUMN_METADATA=1 -DSQLITE_ENABLE_UNLOCK_NOTIFY=1 -DSQLITE_ENABLE_DBSTAT_VTAB=1 -DSQLITE_ENABLE_RTREE=1 -DSQLITE_SECURE_DELETE=1
$(SQLITE)-$(SQLITE_VERSION)/sqlite3: $(SQLITE)-$(SQLITE_VERSION)/Makefile
	cd $(SQLITE)-$(SQLITE_VERSION)/ \
	    && $(ENV_COMPILE) make CFLAGS="$(CFLAGS_SQLITE)" \
	    #&& $(ENV_COMPILE) make CFLAGS="$(CFLAGS_SQLITE)" showdb showjournal showstat4 showwal sqldiff \
	    $(NULL)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/sqlite3: $(SQLITE)-$(SQLITE_VERSION)/sqlite3
	cd $(SQLITE)-$(SQLITE_VERSION)/ && make DESTDIR=$(PREFIX_DEST) install
	#install -m755 showdb showjournal showstat4 showwal sqldiff $(PREFIX_DEST)/$(PREFIX_CONF)/bin/

$(SQLITE)-uninstall: $(SQLITE)-$(SQLITE_VERSION)/sqlite3
	cd $(SQLITE)-$(SQLITE_VERSION)/ && make INSTALL_TOP=$(PREFIX_DEST)/$(PREFIX_CONF)/ uninstall
$(SQLITE)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/sqlite3
	touch $@

FL_SOURCES+=$(DN_SRC)/$(SQLITE_SRC)
FL_UNINSTALL+=$(SQLITE)-uninstall

########################################
LUA=lua

FL_DEP_LUA= \
	$(NCURSES)-install \
	$(READLINE)-install \
	#$(TERMCAP)-install \
	$(NULL)

LUA_VERSION=5.3.1
LUA_SRC=$(LUA)-$(LUA_VERSION).tar.gz
LUA_URL="http://www.lua.org/ftp/$(LUA_SRC)"

$(DN_SRC)/$(LUA_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LUA_URL)
	touch $@
$(LUA)-$(LUA_VERSION)/USAGE: $(DN_SRC)/$(LUA_SRC)
	tar -xf $(DN_SRC)/$(LUA_SRC)
	touch $@

$(LUA)-$(LUA_VERSION)/mypatched: $(LUA)-$(LUA_VERSION)/USAGE
	#cd $(LUA)-$(LUA_VERSION)/ && sed -e 's|SHLIB_LIBS=.*$$|SHLIB_LIBS=-lncurses|' -i support/shobj-conf
	touch $@

$(LUA)-$(LUA_VERSION)/Makefile: $(LUA)-$(LUA_VERSION)/mypatched $(FL_DEP_LUA)
	touch $@

$(LUA)-$(LUA_VERSION)/src/lua: $(LUA)-$(LUA_VERSION)/Makefile
	cd $(LUA)-$(LUA_VERSION)/ \
	    && $(ENV_COMPILE) make -C src MYLDFLAGS="-I$(PREFIX_DEST)/$(PREFIX_CONF)/include/ -L$(PREFIX_DEST)/$(PREFIX_CONF)/lib/ -fPIC -DLUA_USE_LINUX -DLUA_COMPAT_5_2 -DLUA_COMPAT_5_1" MYLIBS="-Wl,-E `$(ENV_COMPILE) pkg-config --libs readline ncursesw` -ldl" all
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/lua: $(LUA)-$(LUA_VERSION)/src/lua
	cd $(LUA)-$(LUA_VERSION)/ && make TO_LIB="liblua.a" INSTALL_DATA='cp -d' INSTALL_TOP=$(PREFIX_DEST)/$(PREFIX_CONF)/ INSTALL_MAN=$(PREFIX_DEST)/$(PREFIX_CONF)/share/man/man1 install

$(LUA)-uninstall: $(LUA)-$(LUA_VERSION)/src/lua
	cd $(LUA)-$(LUA_VERSION)/ && make INSTALL_TOP=$(PREFIX_DEST)/$(PREFIX_CONF)/ uninstall
$(LUA)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/lua
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LUA_SRC)
FL_UNINSTALL+=$(LUA)-uninstall

########################################
# A computer display server protocol
WAYLAND=wayland

FL_DEP_WAYLAND= \
	$(LIBFFI)-install \
	$(EXPAT)-install \
	$(NULL)

WAYLAND_VERSION=1.9.0
WAYLAND_SRC=$(WAYLAND)-$(WAYLAND_VERSION).tar.xz
WAYLAND_URL="http://wayland.freedesktop.org/releases/$(WAYLAND_SRC)"

$(DN_SRC)/$(WAYLAND_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(WAYLAND_URL)
	touch $@
$(WAYLAND)-$(WAYLAND_VERSION)/configure: $(DN_SRC)/$(WAYLAND_SRC)
	tar -xf $(DN_SRC)/$(WAYLAND_SRC)
	#mv $(WAYLAND)$(WAYLAND_VERSION) $(WAYLAND)-$(WAYLAND_VERSION)/
	touch $@
$(WAYLAND)-$(WAYLAND_VERSION)/Makefile: $(WAYLAND)-$(WAYLAND_VERSION)/configure $(FL_DEP_WAYLAND)
	cd $(WAYLAND)-$(WAYLAND_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --disable-static
$(WAYLAND)-$(WAYLAND_VERSION)/libwayland-client.la: $(WAYLAND)-$(WAYLAND_VERSION)/Makefile
	cd $(WAYLAND)-$(WAYLAND_VERSION)/ && make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libwayland-client.la: $(WAYLAND)-$(WAYLAND_VERSION)/libwayland-client.la
	cd $(WAYLAND)-$(WAYLAND_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	#touch $@

$(WAYLAND)-uninstall: $(WAYLAND)-$(WAYLAND_VERSION)/libwayland-client.la
	cd $(WAYLAND)-$(WAYLAND_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(WAYLAND)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libwayland-client.la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(WAYLAND_SRC)
FL_UNINSTALL+=$(WAYLAND)-uninstall

########################################
# X.Org Autotools macros
XUTILMACRO=util-macros

XUTILMACRO_VERSION=1.19.0
XUTILMACRO_SRC=$(XUTILMACRO)-$(XUTILMACRO_VERSION).tar.gz
XUTILMACRO_URL="http://www.x.org/releases/individual/util/$(XUTILMACRO_SRC)"

$(DN_SRC)/$(XUTILMACRO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(XUTILMACRO_URL)
	touch $@
$(XUTILMACRO)-$(XUTILMACRO_VERSION)/configure: $(DN_SRC)/$(XUTILMACRO_SRC)
	tar -xf $(DN_SRC)/$(XUTILMACRO_SRC)
	#mv $(XUTILMACRO)$(XUTILMACRO_VERSION) $(XUTILMACRO)-$(XUTILMACRO_VERSION)/
	touch $@
$(XUTILMACRO)-$(XUTILMACRO_VERSION)/Makefile: $(XUTILMACRO)-$(XUTILMACRO_VERSION)/configure $(FL_DEP_XUTILMACRO)
	cd $(XUTILMACRO)-$(XUTILMACRO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --datadir=$(PREFIX_CONF)/lib/
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/xorg-macros.pc: $(XUTILMACRO)-$(XUTILMACRO_VERSION)/Makefile
	cd $(XUTILMACRO)-$(XUTILMACRO_VERSION)/ && $(ENV_COMPILE) make -j1 DESTDIR=$(PREFIX_DEST) install

$(XUTILMACRO)-uninstall: $(XUTILMACRO)-$(XUTILMACRO_VERSION)/Makefile
	cd $(XUTILMACRO)-$(XUTILMACRO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(XUTILMACRO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/xorg-macros.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(XUTILMACRO_SRC)
FL_UNINSTALL+=$(XUTILMACRO)-uninstall

########################################
LIBPCIACCESS=libpciaccess

FL_DEP_LIBPCIACCESS= \
	$(XUTILMACRO)-install \
	$(NULL)

LIBPCIACCESS_VERSION=0.13.4
LIBPCIACCESS_SRC=$(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION).tar.gz
LIBPCIACCESS_URL="http://www.x.org/releases/individual/lib/$(LIBPCIACCESS_SRC)"

$(DN_SRC)/$(LIBPCIACCESS_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBPCIACCESS_URL)
	touch $@
$(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/configure: $(DN_SRC)/$(LIBPCIACCESS_SRC)
	tar -xf $(DN_SRC)/$(LIBPCIACCESS_SRC)
	#mv $(LIBPCIACCESS)$(LIBPCIACCESS_VERSION) $(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/
	touch $@
$(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/Makefile: $(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/configure $(FL_DEP_LIBPCIACCESS)
	cd $(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/pciaccess.pc: $(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/Makefile
	cd $(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	#touch $@

$(LIBPCIACCESS)-uninstall: $(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/Makefile
	cd $(LIBPCIACCESS)-$(LIBPCIACCESS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBPCIACCESS)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/pciaccess.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBPCIACCESS_SRC)
FL_UNINSTALL+=$(LIBPCIACCESS)-uninstall

########################################
# Userspace interface to kernel DRM services
LIBDRM=libdrm

FL_DEP_LIBDRM= \
	$(XUTILMACRO)-install \
	$(LIBPCIACCESS)-install \
	$(NULL)

LIBDRM_VERSION=2.4.65
LIBDRM_SRC=$(LIBDRM)-$(LIBDRM_VERSION).tar.gz
LIBDRM_URL="http://dri.freedesktop.org/libdrm/$(LIBDRM_SRC)"

$(DN_SRC)/$(LIBDRM_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBDRM_URL)
	touch $@
$(LIBDRM)-$(LIBDRM_VERSION)/configure: $(DN_SRC)/$(LIBDRM_SRC) $(FL_DEP_LIBDRM)
	tar -xf $(DN_SRC)/$(LIBDRM_SRC)
	#mv $(LIBDRM)$(LIBDRM_VERSION) $(LIBDRM)-$(LIBDRM_VERSION)/
	touch $@
#$(LIBDRM)-$(LIBDRM_VERSION)/mypatched: $(LIBDRM)-$(LIBDRM_VERSION)/configure.ac $(FL_DEP_LIBDRM)
#	cd $(LIBDRM)-$(LIBDRM_VERSION)/ && sed -i "/pthread-stubs/d" configure.ac
#	touch $@
#$(LIBDRM)-$(LIBDRM_VERSION)/configure: $(LIBDRM)-$(LIBDRM_VERSION)/mypatched
#	cd $(LIBDRM)-$(LIBDRM_VERSION)/ && $(ENV_COMPILE) autoreconf --force --install
#	touch $@
$(LIBDRM)-$(LIBDRM_VERSION)/Makefile: $(LIBDRM)-$(LIBDRM_VERSION)/configure
	cd $(LIBDRM)-$(LIBDRM_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-udev
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBDRM).pc: $(LIBDRM)-$(LIBDRM_VERSION)/Makefile
	cd $(LIBDRM)-$(LIBDRM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(LIBDRM)-uninstall: $(LIBDRM)-$(LIBDRM_VERSION)/Makefile
	cd $(LIBDRM)-$(LIBDRM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBDRM)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBDRM).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBDRM_SRC)
FL_UNINSTALL+=$(LIBDRM)-uninstall

########################################
# X11 OpenGL extension wire protocol
GLPROTO=glproto

FL_DEP_GLPROTO= \
	$(XUTILMACRO)-install \
	$(NULL)

GLPROTO_VERSION=1.4.17
GLPROTO_SRC=$(GLPROTO)-$(GLPROTO_VERSION).tar.gz
GLPROTO_URL="http://www.x.org/releases/individual/proto/$(GLPROTO_SRC)"

$(DN_SRC)/$(GLPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GLPROTO_URL)
	touch $@
$(GLPROTO)-$(GLPROTO_VERSION)/configure: $(DN_SRC)/$(GLPROTO_SRC)
	tar -xf $(DN_SRC)/$(GLPROTO_SRC)
	#mv $(GLPROTO)$(GLPROTO_VERSION) $(GLPROTO)-$(GLPROTO_VERSION)/
	touch $@
$(GLPROTO)-$(GLPROTO_VERSION)/Makefile: $(GLPROTO)-$(GLPROTO_VERSION)/configure $(FL_DEP_GLPROTO)
	cd $(GLPROTO)-$(GLPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(GLPROTO).pc: $(GLPROTO)-$(GLPROTO_VERSION)/Makefile
	cd $(GLPROTO)-$(GLPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(GLPROTO)-uninstall: $(GLPROTO)-$(GLPROTO_VERSION)/Makefile
	cd $(GLPROTO)-$(GLPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GLPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(GLPROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GLPROTO_SRC)
FL_UNINSTALL+=$(GLPROTO)-uninstall

########################################
# X11 DRI protocol
DRI2PROTO=dri2proto

FL_DEP_DRI2PROTO= \
	$(XUTILMACRO)-install \
	$(NULL)

DRI2PROTO_VERSION=2.8
DRI2PROTO_SRC=$(DRI2PROTO)-$(DRI2PROTO_VERSION).tar.gz
DRI2PROTO_URL="http://www.x.org/releases/individual/proto/$(DRI2PROTO_SRC)"

$(DN_SRC)/$(DRI2PROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(DRI2PROTO_URL)
	touch $@
$(DRI2PROTO)-$(DRI2PROTO_VERSION)/configure: $(DN_SRC)/$(DRI2PROTO_SRC)
	tar -xf $(DN_SRC)/$(DRI2PROTO_SRC)
	#mv $(DRI2PROTO)$(DRI2PROTO_VERSION) $(DRI2PROTO)-$(DRI2PROTO_VERSION)/
	touch $@
$(DRI2PROTO)-$(DRI2PROTO_VERSION)/Makefile: $(DRI2PROTO)-$(DRI2PROTO_VERSION)/configure $(FL_DEP_DRI2PROTO)
	cd $(DRI2PROTO)-$(DRI2PROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(DRI2PROTO).pc: $(DRI2PROTO)-$(DRI2PROTO_VERSION)/Makefile
	cd $(DRI2PROTO)-$(DRI2PROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(DRI2PROTO)-uninstall: $(DRI2PROTO)-$(DRI2PROTO_VERSION)/Makefile
	cd $(DRI2PROTO)-$(DRI2PROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(DRI2PROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(DRI2PROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(DRI2PROTO_SRC)
FL_UNINSTALL+=$(DRI2PROTO)-uninstall

########################################
# X11 DRI3 protocol
DRI3PROTO=dri3proto

FL_DEP_DRI3PROTO= \
	$(XUTILMACRO)-install \
	$(NULL)

DRI3PROTO_VERSION=1.0
DRI3PROTO_SRC=$(DRI3PROTO)-$(DRI3PROTO_VERSION).tar.gz
DRI3PROTO_URL="http://www.x.org/releases/individual/proto/$(DRI3PROTO_SRC)"

$(DN_SRC)/$(DRI3PROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(DRI3PROTO_URL)
	touch $@
$(DRI3PROTO)-$(DRI3PROTO_VERSION)/configure: $(DN_SRC)/$(DRI3PROTO_SRC)
	tar -xf $(DN_SRC)/$(DRI3PROTO_SRC)
	#mv $(DRI3PROTO)$(DRI3PROTO_VERSION) $(DRI3PROTO)-$(DRI3PROTO_VERSION)/
	touch $@
$(DRI3PROTO)-$(DRI3PROTO_VERSION)/Makefile: $(DRI3PROTO)-$(DRI3PROTO_VERSION)/configure $(FL_DEP_DRI3PROTO)
	cd $(DRI3PROTO)-$(DRI3PROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(DRI3PROTO).pc: $(DRI3PROTO)-$(DRI3PROTO_VERSION)/Makefile
	cd $(DRI3PROTO)-$(DRI3PROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(DRI3PROTO)-uninstall: $(DRI3PROTO)-$(DRI3PROTO_VERSION)/Makefile
	cd $(DRI3PROTO)-$(DRI3PROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(DRI3PROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(DRI3PROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(DRI3PROTO_SRC)
FL_UNINSTALL+=$(DRI3PROTO)-uninstall

########################################
# X11 Present protocol specification
PRESENTPROTO=presentproto

FL_DEP_PRESENTPROTO= \
	$(XUTILMACRO)-install \
	$(NULL)

PRESENTPROTO_VERSION=1.0
PRESENTPROTO_SRC=$(PRESENTPROTO)-$(PRESENTPROTO_VERSION).tar.gz
PRESENTPROTO_URL="http://www.x.org/releases/individual/proto/$(PRESENTPROTO_SRC)"

$(DN_SRC)/$(PRESENTPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(PRESENTPROTO_URL)
	touch $@
$(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/configure: $(DN_SRC)/$(PRESENTPROTO_SRC)
	tar -xf $(DN_SRC)/$(PRESENTPROTO_SRC)
	#mv $(PRESENTPROTO)$(PRESENTPROTO_VERSION) $(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/
	touch $@
$(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/Makefile: $(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/configure $(FL_DEP_PRESENTPROTO)
	cd $(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(PRESENTPROTO).pc: $(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/Makefile
	cd $(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(PRESENTPROTO)-uninstall: $(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/Makefile
	cd $(PRESENTPROTO)-$(PRESENTPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(PRESENTPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(PRESENTPROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(PRESENTPROTO_SRC)
FL_UNINSTALL+=$(PRESENTPROTO)-uninstall

########################################
XPROTO=xproto

FL_DEP_XPROTO= \
	$(XUTILMACRO)-install \
	$(NULL)

XPROTO_VERSION=7.0.28
XPROTO_SRC=$(XPROTO)-$(XPROTO_VERSION).tar.gz
XPROTO_URL="http://www.x.org/releases/individual/proto/$(XPROTO_SRC)"

$(DN_SRC)/$(XPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(XPROTO_URL)
	touch $@
$(XPROTO)-$(XPROTO_VERSION)/configure: $(DN_SRC)/$(XPROTO_SRC)
	tar -xf $(DN_SRC)/$(XPROTO_SRC)
	#mv $(XPROTO)$(XPROTO_VERSION) $(XPROTO)-$(XPROTO_VERSION)/
	touch $@
$(XPROTO)-$(XPROTO_VERSION)/Makefile: $(XPROTO)-$(XPROTO_VERSION)/configure $(FL_DEP_XPROTO)
	cd $(XPROTO)-$(XPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(XPROTO).pc: $(XPROTO)-$(XPROTO_VERSION)/Makefile
	cd $(XPROTO)-$(XPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(XPROTO)-uninstall: $(XPROTO)-$(XPROTO_VERSION)/Makefile
	cd $(XPROTO)-$(XPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(XPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(XPROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(XPROTO_SRC)
FL_UNINSTALL+=$(XPROTO)-uninstall

########################################
# X11 various extension wire protocol
XEXTPROTO=xextproto
XEXTPROTO_VERSION=7.3.0
XEXTPROTO_SRC=$(XEXTPROTO)-$(XEXTPROTO_VERSION).tar.gz
XEXTPROTO_URL="http://www.x.org/releases/individual/proto/$(XEXTPROTO_SRC)"

$(DN_SRC)/$(XEXTPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(XEXTPROTO_URL)
	touch $@
$(XEXTPROTO)-$(XEXTPROTO_VERSION)/configure: $(DN_SRC)/$(XEXTPROTO_SRC)
	tar -xf $(DN_SRC)/$(XEXTPROTO_SRC)
	#mv $(XEXTPROTO)$(XEXTPROTO_VERSION) $(XEXTPROTO)-$(XEXTPROTO_VERSION)/
	touch $@
$(XEXTPROTO)-$(XEXTPROTO_VERSION)/Makefile: $(XEXTPROTO)-$(XEXTPROTO_VERSION)/configure $(FL_DEP_XEXTPROTO)
	cd $(XEXTPROTO)-$(XEXTPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/xextproto.pc: $(XEXTPROTO)-$(XEXTPROTO_VERSION)/Makefile
	cd $(XEXTPROTO)-$(XEXTPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(XEXTPROTO)-uninstall: $(XEXTPROTO)-$(XEXTPROTO_VERSION)/Makefile
	cd $(XEXTPROTO)-$(XEXTPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(XEXTPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/xextproto.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(XEXTPROTO_SRC)
FL_UNINSTALL+=$(XEXTPROTO)-uninstall

########################################
# X11 Fixes extension wire protocol
FIXESPROTO=fixesproto

FL_DEP_FIXESPROTO= \
	$(XUTILMACRO)-install \
	$(XEXTPROTO)-install \
	$(XPROTO)-install \
	$(NULL)

FIXESPROTO_VERSION=5.0
FIXESPROTO_SRC=$(FIXESPROTO)-$(FIXESPROTO_VERSION).tar.gz
FIXESPROTO_URL="http://www.x.org/releases/individual/proto/$(FIXESPROTO_SRC)"

$(DN_SRC)/$(FIXESPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(FIXESPROTO_URL)
	touch $@
$(FIXESPROTO)-$(FIXESPROTO_VERSION)/configure: $(DN_SRC)/$(FIXESPROTO_SRC)
	tar -xf $(DN_SRC)/$(FIXESPROTO_SRC)
	#mv $(FIXESPROTO)$(FIXESPROTO_VERSION) $(FIXESPROTO)-$(FIXESPROTO_VERSION)/
	touch $@
$(FIXESPROTO)-$(FIXESPROTO_VERSION)/Makefile: $(FIXESPROTO)-$(FIXESPROTO_VERSION)/configure $(FL_DEP_FIXESPROTO)
	cd $(FIXESPROTO)-$(FIXESPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(FIXESPROTO).pc: $(FIXESPROTO)-$(FIXESPROTO_VERSION)/Makefile
	cd $(FIXESPROTO)-$(FIXESPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(FIXESPROTO)-uninstall: $(FIXESPROTO)-$(FIXESPROTO_VERSION)/Makefile
	cd $(FIXESPROTO)-$(FIXESPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(FIXESPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(FIXESPROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(FIXESPROTO_SRC)
FL_UNINSTALL+=$(FIXESPROTO)-uninstall

########################################
# X11 various extension wire protocol
INPUTPROTO=inputproto
INPUTPROTO_VERSION=2.3
INPUTPROTO_SRC=$(INPUTPROTO)-$(INPUTPROTO_VERSION).tar.gz
INPUTPROTO_URL="http://www.x.org/releases/individual/proto/$(INPUTPROTO_SRC)"

$(DN_SRC)/$(INPUTPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(INPUTPROTO_URL)
	touch $@
$(INPUTPROTO)-$(INPUTPROTO_VERSION)/configure: $(DN_SRC)/$(INPUTPROTO_SRC)
	tar -xf $(DN_SRC)/$(INPUTPROTO_SRC)
	#mv $(INPUTPROTO)$(INPUTPROTO_VERSION) $(INPUTPROTO)-$(INPUTPROTO_VERSION)/
	touch $@
$(INPUTPROTO)-$(INPUTPROTO_VERSION)/Makefile: $(INPUTPROTO)-$(INPUTPROTO_VERSION)/configure $(FL_DEP_INPUTPROTO)
	cd $(INPUTPROTO)-$(INPUTPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/include/X11/extensions/XIproto.h: $(INPUTPROTO)-$(INPUTPROTO_VERSION)/Makefile
	cd $(INPUTPROTO)-$(INPUTPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(INPUTPROTO)-uninstall: $(INPUTPROTO)-$(INPUTPROTO_VERSION)/Makefile
	cd $(INPUTPROTO)-$(INPUTPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(INPUTPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/include/X11/extensions/XIproto.h
	touch $@

FL_SOURCES+=$(DN_SRC)/$(INPUTPROTO_SRC)
FL_UNINSTALL+=$(INPUTPROTO)-uninstall

########################################
# X11 Video extension wire protocol
VIDEOPROTO=videoproto

VIDEOPROTO_VERSION=2.3.2
VIDEOPROTO_SRC=$(VIDEOPROTO)-$(VIDEOPROTO_VERSION).tar.gz
VIDEOPROTO_URL="http://www.x.org/releases/individual/proto/$(VIDEOPROTO_SRC)"

$(DN_SRC)/$(VIDEOPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(VIDEOPROTO_URL)
	touch $@
$(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/configure: $(DN_SRC)/$(VIDEOPROTO_SRC)
	tar -xf $(DN_SRC)/$(VIDEOPROTO_SRC)
	#mv $(VIDEOPROTO)$(VIDEOPROTO_VERSION) $(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/
	touch $@
$(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/Makefile: $(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/configure $(FL_DEP_VIDEOPROTO)
	cd $(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/include/X11/extensions/XvMCproto.h: $(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/Makefile
	cd $(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(VIDEOPROTO)-uninstall: $(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/Makefile
	cd $(VIDEOPROTO)-$(VIDEOPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(VIDEOPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/include/X11/extensions/XvMCproto.h
	touch $@

FL_SOURCES+=$(DN_SRC)/$(VIDEOPROTO_SRC)
FL_UNINSTALL+=$(VIDEOPROTO)-uninstall


########################################
RENDERPROTO=renderproto

RENDERPROTO_VERSION=0.11
RENDERPROTO_SRC=$(RENDERPROTO)-$(RENDERPROTO_VERSION).tar.gz
RENDERPROTO_URL="http://www.x.org/releases/individual/proto/$(RENDERPROTO_SRC)"

$(DN_SRC)/$(RENDERPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(RENDERPROTO_URL)
	touch $@
$(RENDERPROTO)-$(RENDERPROTO_VERSION)/configure: $(DN_SRC)/$(RENDERPROTO_SRC)
	tar -xf $(DN_SRC)/$(RENDERPROTO_SRC)
	#mv $(RENDERPROTO)$(RENDERPROTO_VERSION) $(RENDERPROTO)-$(RENDERPROTO_VERSION)/
	touch $@
$(RENDERPROTO)-$(RENDERPROTO_VERSION)/Makefile: $(RENDERPROTO)-$(RENDERPROTO_VERSION)/configure $(FL_DEP_RENDERPROTO)
	cd $(RENDERPROTO)-$(RENDERPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/renderproto.pc: $(RENDERPROTO)-$(RENDERPROTO_VERSION)/Makefile
	cd $(RENDERPROTO)-$(RENDERPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(RENDERPROTO)-uninstall: $(RENDERPROTO)-$(RENDERPROTO_VERSION)/Makefile
	cd $(RENDERPROTO)-$(RENDERPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(RENDERPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/renderproto.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(RENDERPROTO_SRC)
FL_UNINSTALL+=$(RENDERPROTO)-uninstall

########################################
SCRNSAVERPROTO=scrnsaverproto

SCRNSAVERPROTO_VERSION=1.2.2
SCRNSAVERPROTO_SRC=$(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION).tar.gz
SCRNSAVERPROTO_URL="http://www.x.org/releases/individual/proto/$(SCRNSAVERPROTO_SRC)"

$(DN_SRC)/$(SCRNSAVERPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(SCRNSAVERPROTO_URL)
	touch $@
$(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/configure: $(DN_SRC)/$(SCRNSAVERPROTO_SRC)
	tar -xf $(DN_SRC)/$(SCRNSAVERPROTO_SRC)
	#mv $(SCRNSAVERPROTO)$(SCRNSAVERPROTO_VERSION) $(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/
	touch $@
$(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/Makefile: $(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/configure $(FL_DEP_SCRNSAVERPROTO)
	cd $(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/scrnsaverproto.pc: $(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/Makefile
	cd $(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(SCRNSAVERPROTO)-uninstall: $(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/Makefile
	cd $(SCRNSAVERPROTO)-$(SCRNSAVERPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(SCRNSAVERPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/scrnsaverproto.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(SCRNSAVERPROTO_SRC)
FL_UNINSTALL+=$(SCRNSAVERPROTO)-uninstall


########################################
# X11 XKB extension wire protocol
KBPROTO=kbproto

KBPROTO_VERSION=1.0.7
KBPROTO_SRC=$(KBPROTO)-$(KBPROTO_VERSION).tar.gz
KBPROTO_URL="http://www.x.org/releases/individual/proto/$(KBPROTO_SRC)"

$(DN_SRC)/$(KBPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(KBPROTO_URL)
	touch $@
$(KBPROTO)-$(KBPROTO_VERSION)/configure: $(DN_SRC)/$(KBPROTO_SRC)
	tar -xf $(DN_SRC)/$(KBPROTO_SRC)
	#mv $(KBPROTO)$(KBPROTO_VERSION) $(KBPROTO)-$(KBPROTO_VERSION)/
	touch $@
$(KBPROTO)-$(KBPROTO_VERSION)/Makefile: $(KBPROTO)-$(KBPROTO_VERSION)/configure $(FL_DEP_KBPROTO)
	cd $(KBPROTO)-$(KBPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/kbproto.pc: $(KBPROTO)-$(KBPROTO_VERSION)/Makefile
	cd $(KBPROTO)-$(KBPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(KBPROTO)-uninstall: $(KBPROTO)-$(KBPROTO_VERSION)/Makefile
	cd $(KBPROTO)-$(KBPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(KBPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/kbproto.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(KBPROTO_SRC)
FL_UNINSTALL+=$(KBPROTO)-uninstall

########################################
# XML-XCB protocol descriptions
XCBPROTO=xcb-proto

FL_DEP_XCBPROTO= \
	$(LIBXML2)-install \
	$(NULL)

XCBPROTO_VERSION=1.11
XCBPROTO_SRC=$(XCBPROTO)-$(XCBPROTO_VERSION).tar.gz
XCBPROTO_URL="http://xcb.freedesktop.org/dist/$(XCBPROTO_SRC)"

$(DN_SRC)/$(XCBPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(XCBPROTO_URL)
	touch $@
$(XCBPROTO)-$(XCBPROTO_VERSION)/configure: $(DN_SRC)/$(XCBPROTO_SRC)
	tar -xf $(DN_SRC)/$(XCBPROTO_SRC)
	touch $@
$(XCBPROTO)-$(XCBPROTO_VERSION)/Makefile: $(XCBPROTO)-$(XCBPROTO_VERSION)/configure $(FL_DEP_XCBPROTO)
	cd $(XCBPROTO)-$(XCBPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@
$(XCBPROTO)-$(XCBPROTO_VERSION)/$(XCBPROTO).pc: $(XCBPROTO)-$(XCBPROTO_VERSION)/Makefile
	cd $(XCBPROTO)-$(XCBPROTO_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@

$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(XCBPROTO).pc: $(XCBPROTO)-$(XCBPROTO_VERSION)/$(XCBPROTO).pc
	cd $(XCBPROTO)-$(XCBPROTO_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(XCBPROTO)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(XCBPROTO)"

$(XCBPROTO)-uninstall: $(XCBPROTO)-$(XCBPROTO_VERSION)/$(XCBPROTO).pc
	cd $(XCBPROTO)-$(XCBPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(XCBPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(XCBPROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(XCBPROTO_SRC)
FL_UNINSTALL+=$(XCBPROTO)-uninstall

########################################
# X11 Video Mode extension wire protocol
XF86VIDMODEPROTO=xf86vidmodeproto

FL_DEP_XF86VIDMODEPROTO= \
	$(XUTILMACRO)-install \
	$(NULL)

XF86VIDMODEPROTO_VERSION=2.3.1
XF86VIDMODEPROTO_SRC=$(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION).tar.gz
XF86VIDMODEPROTO_URL="http://www.x.org/releases/individual/proto/$(XF86VIDMODEPROTO_SRC)"

$(DN_SRC)/$(XF86VIDMODEPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(XF86VIDMODEPROTO_URL)
	touch $@
$(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/configure: $(DN_SRC)/$(XF86VIDMODEPROTO_SRC)
	tar -xf $(DN_SRC)/$(XF86VIDMODEPROTO_SRC)
	#mv $(XF86VIDMODEPROTO)$(XF86VIDMODEPROTO_VERSION) $(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/
	touch $@
$(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/Makefile: $(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/configure $(FL_DEP_XF86VIDMODEPROTO)
	cd $(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(XF86VIDMODEPROTO).pc: $(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/Makefile
	cd $(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(XF86VIDMODEPROTO)-uninstall: $(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/Makefile
	cd $(XF86VIDMODEPROTO)-$(XF86VIDMODEPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(XF86VIDMODEPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(XF86VIDMODEPROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(XF86VIDMODEPROTO_SRC)
FL_UNINSTALL+=$(XF86VIDMODEPROTO)-uninstall

########################################
# X11 Damage extension wire protocol
DAMAGEPROTO=damageproto

FL_DEP_DAMAGEPROTO= \
	$(XUTILMACRO)-install \
	$(FIXESPROTO)-install \
	$(XPROTO)-install \
	$(NULL)

DAMAGEPROTO_VERSION=1.2.1
DAMAGEPROTO_SRC=$(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION).tar.gz
DAMAGEPROTO_URL="http://www.x.org/releases/individual/proto/$(DAMAGEPROTO_SRC)"

$(DN_SRC)/$(DAMAGEPROTO_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(DAMAGEPROTO_URL)
	touch $@
$(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/configure: $(DN_SRC)/$(DAMAGEPROTO_SRC)
	tar -xf $(DN_SRC)/$(DAMAGEPROTO_SRC)
	#mv $(DAMAGEPROTO)$(DAMAGEPROTO_VERSION) $(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/
	touch $@
$(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/Makefile: $(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/configure $(FL_DEP_DAMAGEPROTO)
	cd $(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(DAMAGEPROTO).pc: $(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/Makefile
	cd $(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	touch $@

$(DAMAGEPROTO)-uninstall: $(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/Makefile
	cd $(DAMAGEPROTO)-$(DAMAGEPROTO_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(DAMAGEPROTO)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(DAMAGEPROTO).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(DAMAGEPROTO_SRC)
FL_UNINSTALL+=$(DAMAGEPROTO)-uninstall

########################################
LIBXRENDER=libXrender

FL_DEP_LIBXRENDER= \
	$(RENDERPROTO)-install \
	$(NULL)

LIBXRENDER_VERSION=0.9.9
LIBXRENDER_SRC=$(LIBXRENDER)-$(LIBXRENDER_VERSION).tar.gz
LIBXRENDER_URL="http://www.x.org/releases/individual/lib/$(LIBXRENDER_SRC)"

$(DN_SRC)/$(LIBXRENDER_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXRENDER_URL)
	touch $@
$(LIBXRENDER)-$(LIBXRENDER_VERSION)/configure: $(DN_SRC)/$(LIBXRENDER_SRC)
	tar -xf $(DN_SRC)/$(LIBXRENDER_SRC)
	#mv $(LIBXRENDER)$(LIBXRENDER_VERSION) $(LIBXRENDER)-$(LIBXRENDER_VERSION)/
	touch $@
$(LIBXRENDER)-$(LIBXRENDER_VERSION)/Makefile: $(LIBXRENDER)-$(LIBXRENDER_VERSION)/configure $(FL_DEP_LIBXRENDER)
	cd $(LIBXRENDER)-$(LIBXRENDER_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --disable-shared
$(LIBXRENDER)-$(LIBXRENDER_VERSION)/src/$(LIBXRENDER).la: $(LIBXRENDER)-$(LIBXRENDER_VERSION)/Makefile
	cd $(LIBXRENDER)-$(LIBXRENDER_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXRENDER).la: $(LIBXRENDER)-$(LIBXRENDER_VERSION)/src/$(LIBXRENDER).la
	cd $(LIBXRENDER)-$(LIBXRENDER_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXRENDER)-uninstall: $(LIBXRENDER)-$(LIBXRENDER_VERSION)/src/$(LIBXRENDER).la
	cd $(LIBXRENDER)-$(LIBXRENDER_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXRENDER)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXRENDER).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXRENDER_SRC)
FL_UNINSTALL+=$(LIBXRENDER)-uninstall

########################################
LIBXFT=libXft
LIBXFT_VERSION=2.3.2
LIBXFT_SRC=$(LIBXFT)-$(LIBXFT_VERSION).tar.gz
LIBXFT_URL="http://www.x.org/releases/individual/lib/$(LIBXFT_SRC)"

FL_DEP_LIBXFT= \
	$(FONTCONF)-install \
	$(LIBXRENDER)-install \
	$(NULL)

$(DN_SRC)/$(LIBXFT_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXFT_URL)
	touch $@
$(LIBXFT)-$(LIBXFT_VERSION)/configure: $(DN_SRC)/$(LIBXFT_SRC)
	tar -xf $(DN_SRC)/$(LIBXFT_SRC)
	#mv $(LIBXFT)$(LIBXFT_VERSION) $(LIBXFT)-$(LIBXFT_VERSION)/
	touch $@
$(LIBXFT)-$(LIBXFT_VERSION)/Makefile: $(LIBXFT)-$(LIBXFT_VERSION)/configure $(FL_DEP_LIBXFT)
	cd $(LIBXFT)-$(LIBXFT_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --disable-shared
$(LIBXFT)-$(LIBXFT_VERSION)/src/$(LIBXFT).la: $(LIBXFT)-$(LIBXFT_VERSION)/Makefile
	cd $(LIBXFT)-$(LIBXFT_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXFT).la: $(LIBXFT)-$(LIBXFT_VERSION)/src/$(LIBXFT).la
	cd $(LIBXFT)-$(LIBXFT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXFT)-uninstall: $(LIBXFT)-$(LIBXFT_VERSION)/src/$(LIBXFT).la
	cd $(LIBXFT)-$(LIBXFT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXFT)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXFT).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXFT_SRC)
FL_UNINSTALL+=$(LIBXFT)-uninstall

########################################
# X11 Inter-Client Exchange library
LIBICE=libICE

FL_DEP_LIBICE= \
	$(XPROTO)-install \
	$(NULL)

LIBICE_VERSION=1.0.9
LIBICE_SRC=$(LIBICE)-$(LIBICE_VERSION).tar.gz
LIBICE_URL="http://xorg.freedesktop.org/releases/individual/lib/$(LIBICE_SRC)"

$(DN_SRC)/$(LIBICE_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBICE_URL)
	touch $@
$(LIBICE)-$(LIBICE_VERSION)/configure: $(DN_SRC)/$(LIBICE_SRC)
	tar -xf $(DN_SRC)/$(LIBICE_SRC)
	touch $@
$(LIBICE)-$(LIBICE_VERSION)/Makefile: $(LIBICE)-$(LIBICE_VERSION)/configure $(FL_DEP_LIBICE)
	cd $(LIBICE)-$(LIBICE_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBICE)-$(LIBICE_VERSION)/src/$(LIBICE).la: $(LIBICE)-$(LIBICE_VERSION)/Makefile
	cd $(LIBICE)-$(LIBICE_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBICE).la: $(LIBICE)-$(LIBICE_VERSION)/src/$(LIBICE).la
	cd $(LIBICE)-$(LIBICE_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBICE)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBICE)"

$(LIBICE)-uninstall: $(LIBICE)-$(LIBICE_VERSION)/src/$(LIBICE).la
	cd $(LIBICE)-$(LIBICE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBICE)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBICE).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBICE_SRC)
FL_UNINSTALL+=$(LIBICE)-uninstall

########################################
# X11 Session Management library
LIBSM=libSM

FL_DEP_LIBSM= \
	$(LIBICE)-install \
	$(NULL)

LIBSM_VERSION=1.2.2
LIBSM_SRC=$(LIBSM)-$(LIBSM_VERSION).tar.gz
LIBSM_URL="http://xorg.freedesktop.org/releases/individual/lib/$(LIBSM_SRC)"

$(DN_SRC)/$(LIBSM_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBSM_URL)
	touch $@
$(LIBSM)-$(LIBSM_VERSION)/configure: $(DN_SRC)/$(LIBSM_SRC)
	tar -xf $(DN_SRC)/$(LIBSM_SRC)
	touch $@
$(LIBSM)-$(LIBSM_VERSION)/Makefile: $(LIBSM)-$(LIBSM_VERSION)/configure $(FL_DEP_LIBSM)
	cd $(LIBSM)-$(LIBSM_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBSM)-$(LIBSM_VERSION)/src/$(LIBSM).la: $(LIBSM)-$(LIBSM_VERSION)/Makefile
	cd $(LIBSM)-$(LIBSM_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBSM).la: $(LIBSM)-$(LIBSM_VERSION)/src/$(LIBSM).la
	cd $(LIBSM)-$(LIBSM_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBSM)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBSM)"

$(LIBSM)-uninstall: $(LIBSM)-$(LIBSM_VERSION)/src/$(LIBSM).la
	cd $(LIBSM)-$(LIBSM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBSM)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBSM).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBSM_SRC)
FL_UNINSTALL+=$(LIBSM)-uninstall

########################################
XTRANS=xtrans

FL_DEP_XTRANS= \
	#$(aaaa)-install \
	$(NULL)

XTRANS_VERSION=1.3.5
XTRANS_SRC=$(XTRANS)-$(XTRANS_VERSION).tar.gz
XTRANS_URL="http://xorg.freedesktop.org/releases/individual/lib/$(XTRANS_SRC)"

$(DN_SRC)/$(XTRANS_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(XTRANS_URL)
	touch $@
$(XTRANS)-$(XTRANS_VERSION)/configure: $(DN_SRC)/$(XTRANS_SRC)
	tar -xf $(DN_SRC)/$(XTRANS_SRC)
	touch $@
$(XTRANS)-$(XTRANS_VERSION)/Makefile: $(XTRANS)-$(XTRANS_VERSION)/configure $(FL_DEP_XTRANS)
	cd $(XTRANS)-$(XTRANS_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --datadir=$(PREFIX_CONF)/lib/
	touch $@
$(XTRANS)-$(XTRANS_VERSION)/xtrans.pc: $(XTRANS)-$(XTRANS_VERSION)/Makefile
	cd $(XTRANS)-$(XTRANS_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/include/X11/Xtrans/Xtrans.h: $(XTRANS)-$(XTRANS_VERSION)/xtrans.pc
	cd $(XTRANS)-$(XTRANS_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(XTRANS)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(XTRANS)"

$(XTRANS)-uninstall: $(XTRANS)-$(XTRANS_VERSION)/xtrans.pc
	cd $(XTRANS)-$(XTRANS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(XTRANS)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/include/X11/Xtrans/Xtrans.h
	touch $@

FL_SOURCES+=$(DN_SRC)/$(XTRANS_SRC)
FL_UNINSTALL+=$(XTRANS)-uninstall


########################################
LIBPTHREADSTUBS=libpthread-stubs

FL_DEP_LIBPTHREADSTUBS= \
	#$(aaaaa)-install \
	$(NULL)

LIBPTHREADSTUBS_VERSION=0.3
LIBPTHREADSTUBS_SRC=$(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION).tar.gz
LIBPTHREADSTUBS_URL="http://xcb.freedesktop.org/dist/$(LIBPTHREADSTUBS_SRC)"

$(DN_SRC)/$(LIBPTHREADSTUBS_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBPTHREADSTUBS_URL)
	touch $@
$(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/configure: $(DN_SRC)/$(LIBPTHREADSTUBS_SRC)
	tar -xf $(DN_SRC)/$(LIBPTHREADSTUBS_SRC)
	touch $@
$(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/Makefile: $(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/configure $(FL_DEP_LIBPTHREADSTUBS)
	cd $(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@
$(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/pthread-stubs.pc: $(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/Makefile
	cd $(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@

$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/pthread-stubs.pc: $(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/pthread-stubs.pc
	cd $(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBPTHREADSTUBS)-uninstall: $(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/pthread-stubs.pc
	cd $(LIBPTHREADSTUBS)-$(LIBPTHREADSTUBS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBPTHREADSTUBS)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/pthread-stubs.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBPTHREADSTUBS_SRC)
FL_UNINSTALL+=$(LIBPTHREADSTUBS)-uninstall


########################################
# X11 authorisation library
LIBXAU=libXau

FL_DEP_LIBXAU= \
	$(XPROTO)-install \
	$(LIBPTHREADSTUBS)-install \
	$(NULL)

LIBXAU_VERSION=1.0.8
LIBXAU_SRC=$(LIBXAU)-$(LIBXAU_VERSION).tar.gz
LIBXAU_URL="http://xorg.freedesktop.org/releases/individual/lib/$(LIBXAU_SRC)"

$(DN_SRC)/$(LIBXAU_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXAU_URL)
	touch $@
$(LIBXAU)-$(LIBXAU_VERSION)/configure: $(DN_SRC)/$(LIBXAU_SRC)
	tar -xf $(DN_SRC)/$(LIBXAU_SRC)
	touch $@
$(LIBXAU)-$(LIBXAU_VERSION)/Makefile: $(LIBXAU)-$(LIBXAU_VERSION)/configure $(FL_DEP_LIBXAU)
	cd $(LIBXAU)-$(LIBXAU_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static --without-doxygen
	touch $@
$(LIBXAU)-$(LIBXAU_VERSION)/$(LIBXAU).la: $(LIBXAU)-$(LIBXAU_VERSION)/Makefile
	cd $(LIBXAU)-$(LIBXAU_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@

$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXAU).la: $(LIBXAU)-$(LIBXAU_VERSION)/$(LIBXAU).la
	cd $(LIBXAU)-$(LIBXAU_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXAU)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXAU)"

$(LIBXAU)-uninstall: $(LIBXAU)-$(LIBXAU_VERSION)/$(LIBXAU).la
	cd $(LIBXAU)-$(LIBXAU_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXAU)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXAU).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXAU_SRC)
FL_UNINSTALL+=$(LIBXAU)-uninstall


########################################
# X11 Display Manager Control Protocol library
LIBXDMCP=libXdmcp

FL_DEP_LIBXDMCP= \
	$(XPROTO)-install \
	$(NULL)

LIBXDMCP_VERSION=1.1.2
LIBXDMCP_SRC=$(LIBXDMCP)-$(LIBXDMCP_VERSION).tar.gz
LIBXDMCP_URL="http://xorg.freedesktop.org/releases/individual/lib/$(LIBXDMCP_SRC)"

$(DN_SRC)/$(LIBXDMCP_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXDMCP_URL)
	touch $@
$(LIBXDMCP)-$(LIBXDMCP_VERSION)/configure: $(DN_SRC)/$(LIBXDMCP_SRC)
	tar -xf $(DN_SRC)/$(LIBXDMCP_SRC)
	touch $@
$(LIBXDMCP)-$(LIBXDMCP_VERSION)/Makefile: $(LIBXDMCP)-$(LIBXDMCP_VERSION)/configure $(FL_DEP_LIBXDMCP)
	cd $(LIBXDMCP)-$(LIBXDMCP_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBXDMCP)-$(LIBXDMCP_VERSION)/$(LIBXDMCP).la: $(LIBXDMCP)-$(LIBXDMCP_VERSION)/Makefile
	cd $(LIBXDMCP)-$(LIBXDMCP_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXDMCP).la: $(LIBXDMCP)-$(LIBXDMCP_VERSION)/$(LIBXDMCP).la
	cd $(LIBXDMCP)-$(LIBXDMCP_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXDMCP)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXDMCP)"

$(LIBXDMCP)-uninstall: $(LIBXDMCP)-$(LIBXDMCP_VERSION)/$(LIBXDMCP).la
	cd $(LIBXDMCP)-$(LIBXDMCP_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXDMCP)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXDMCP).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXDMCP_SRC)
FL_UNINSTALL+=$(LIBXDMCP)-uninstall

########################################
# X11 client-side library
LIBXCB=libxcb

FL_DEP_LIBXCB= \
	$(XUTILMACRO)-install \
	$(XCBPROTO)-install \
	$(LIBXSLT)-install \
	$(LIBXAU)-install \
	$(LIBXDMCP)-install \
	$(NULL)

LIBXCB_VERSION=1.11.1
LIBXCB_SRC=$(LIBXCB)-$(LIBXCB_VERSION).tar.gz
LIBXCB_URL="http://xcb.freedesktop.org/dist/$(LIBXCB_SRC)"

$(DN_SRC)/$(LIBXCB_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXCB_URL)
	touch $@
$(LIBXCB)-$(LIBXCB_VERSION)/configure: $(DN_SRC)/$(LIBXCB_SRC)
	tar -xf $(DN_SRC)/$(LIBXCB_SRC)
	touch $@
$(LIBXCB)-$(LIBXCB_VERSION)/Makefile: $(LIBXCB)-$(LIBXCB_VERSION)/configure $(FL_DEP_LIBXCB)
	cd $(LIBXCB)-$(LIBXCB_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-xinput --enable-xkb --disable-static
	touch $@
$(LIBXCB)-$(LIBXCB_VERSION)/xcb.pc: $(LIBXCB)-$(LIBXCB_VERSION)/Makefile
	cd $(LIBXCB)-$(LIBXCB_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/xcb.pc: $(LIBXCB)-$(LIBXCB_VERSION)/xcb.pc
	cd $(LIBXCB)-$(LIBXCB_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXCB)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXCB)"

$(LIBXCB)-uninstall: $(LIBXCB)-$(LIBXCB_VERSION)/xcb.pc
	cd $(LIBXCB)-$(LIBXCB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXCB)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/xcb.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXCB_SRC)
FL_UNINSTALL+=$(LIBXCB)-uninstall

########################################
LIBX11=libX11

FL_DEP_LIBX11= \
	$(XPROTO)-install \
	$(KBPROTO)-install \
	$(XTRANS)-install \
	$(XEXTPROTO)-install \
	$(INPUTPROTO)-install \
	$(XUTILMACRO)-install \
	$(LIBXCB)-install \
	$(NULL)

LIBX11_VERSION=1.6.3
LIBX11_SRC=$(LIBX11)-$(LIBX11_VERSION).tar.gz
LIBX11_URL="http://xorg.freedesktop.org/releases/individual/lib/$(LIBX11_SRC)"

$(DN_SRC)/$(LIBX11_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBX11_URL)
	touch $@
$(LIBX11)-$(LIBX11_VERSION)/configure: $(DN_SRC)/$(LIBX11_SRC)
	tar -xf $(DN_SRC)/$(LIBX11_SRC)
	touch $@
$(LIBX11)-$(LIBX11_VERSION)/Makefile: $(LIBX11)-$(LIBX11_VERSION)/configure $(FL_DEP_LIBX11)
	cd $(LIBX11)-$(LIBX11_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --disable-static --disable-xf86bigfont --with-keysymdefdir=$(PREFIX_CONF)/include/X11/
	touch $@
$(LIBX11)-$(LIBX11_VERSION)/x11.pc: $(LIBX11)-$(LIBX11_VERSION)/Makefile
	cd $(LIBX11)-$(LIBX11_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/x11.pc: $(LIBX11)-$(LIBX11_VERSION)/x11.pc
	cd $(LIBX11)-$(LIBX11_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBX11)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBX11)"

$(LIBX11)-uninstall: $(LIBX11)-$(LIBX11_VERSION)/x11.pc
	cd $(LIBX11)-$(LIBX11_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBX11)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/x11.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBX11_SRC)
FL_UNINSTALL+=$(LIBX11)-uninstall

########################################
LIBXPM=libXpm

FL_DEP_LIBXPM= \
	$(XUTILMACRO)-install \
	$(LIBX11)-install \
	$(XPROTO)-install \
	$(NULL)

LIBXPM_VERSION=3.5.11
LIBXPM_SRC=$(LIBXPM)-$(LIBXPM_VERSION).tar.gz
LIBXPM_URL="http://xorg.freedesktop.org/releases/individual/lib/$(LIBXPM_SRC)"

$(DN_SRC)/$(LIBXPM_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXPM_URL)
	touch $@
$(LIBXPM)-$(LIBXPM_VERSION)/configure: $(DN_SRC)/$(LIBXPM_SRC)
	tar -xf $(DN_SRC)/$(LIBXPM_SRC)
	#mv $(LIBXPM)-$(LIBXPM_VERSION) $(LIBXPM)-$(LIBXPM_VERSION)/
	touch $@
$(LIBXPM)-$(LIBXPM_VERSION)/Makefile: $(LIBXPM)-$(LIBXPM_VERSION)/configure $(FL_DEP_LIBXPM)
	cd $(LIBXPM)-$(LIBXPM_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --disable-shared
$(LIBXPM)-$(LIBXPM_VERSION)/src/libXpm.la: $(LIBXPM)-$(LIBXPM_VERSION)/Makefile
	cd $(LIBXPM)-$(LIBXPM_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libXpm.la: $(LIBXPM)-$(LIBXPM_VERSION)/src/libXpm.la
	cd $(LIBXPM)-$(LIBXPM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXPM)-uninstall: $(LIBXPM)-$(LIBXPM_VERSION)/src/libXpm.la
	cd $(LIBXPM)-$(LIBXPM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXPM)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libXpm.la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXPM_SRC)
FL_UNINSTALL+=$(LIBXPM)-uninstall

########################################
LIBXT=libXt

# sm ice x11 xproto kbproto)
FL_DEP_LIBXT= \
	$(XUTILMACRO)-install \
	$(LIBX11)-install \
	$(LIBSM)-install \
	$(XPROTO)-install \
	$(KBPROTO)-install \
	$(NULL)

LIBXT_VERSION=1.1.5
LIBXT_SRC=$(LIBXT)-$(LIBXT_VERSION).tar.gz
LIBXT_URL="http://xorg.freedesktop.org/releases/individual/lib/$(LIBXT_SRC)"

$(DN_SRC)/$(LIBXT_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXT_URL)
	touch $@
$(LIBXT)-$(LIBXT_VERSION)/configure: $(DN_SRC)/$(LIBXT_SRC)
	tar -xf $(DN_SRC)/$(LIBXT_SRC)
	touch $@
$(LIBXT)-$(LIBXT_VERSION)/Makefile: $(LIBXT)-$(LIBXT_VERSION)/configure $(FL_DEP_LIBXT)
	cd $(LIBXT)-$(LIBXT_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBXT)-$(LIBXT_VERSION)/src/$(LIBXT).la: $(LIBXT)-$(LIBXT_VERSION)/Makefile
	cd $(LIBXT)-$(LIBXT_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXT).la: $(LIBXT)-$(LIBXT_VERSION)/src/$(LIBXT).la
	cd $(LIBXT)-$(LIBXT_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXT)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXT)"

$(LIBXT)-uninstall: $(LIBXT)-$(LIBXT_VERSION)/src/$(LIBXT).la
	cd $(LIBXT)-$(LIBXT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXT)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXT).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXT_SRC)
FL_UNINSTALL+=$(LIBXT)-uninstall

########################################
# libXext, X11 miscellaneous micro-utility library
# http://xorg.freedesktop.org/
LIBXEXT=libXext

FL_DEP_LIBXEXT= \
	$(XEXTPROTO)-install \
	$(LIBXT)-install \
	$(NULL)

LIBXEXT_VERSION=1.3.3
LIBXEXT_SRC=$(LIBXEXT)-$(LIBXEXT_VERSION).tar.gz
LIBXEXT_URL=http://xorg.freedesktop.org/releases/individual/lib/$(LIBXEXT_SRC)

$(DN_SRC)/$(LIBXEXT_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXEXT_URL)
	touch $@
$(LIBXEXT)-$(LIBXEXT_VERSION)/configure: $(DN_SRC)/$(LIBXEXT_SRC)
	tar -xf $(DN_SRC)/$(LIBXEXT_SRC)
	touch $@
$(LIBXEXT)-$(LIBXEXT_VERSION)/Makefile: $(LIBXEXT)-$(LIBXEXT_VERSION)/configure $(FL_DEP_LIBXEXT)
	cd $(LIBXEXT)-$(LIBXEXT_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBXEXT)-$(LIBXEXT_VERSION)/src/$(LIBXEXT).la: $(LIBXEXT)-$(LIBXEXT_VERSION)/Makefile
	cd $(LIBXEXT)-$(LIBXEXT_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXEXT).la: $(LIBXEXT)-$(LIBXEXT_VERSION)/src/$(LIBXEXT).la
	cd $(LIBXEXT)-$(LIBXEXT_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXEXT)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXEXT)"

$(LIBXEXT)-uninstall: $(LIBXEXT)-$(LIBXEXT_VERSION)/src/$(LIBXEXT).la
	cd $(LIBXEXT)-$(LIBXEXT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXEXT)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXEXT).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXEXT_SRC)
FL_UNINSTALL+=$(LIBXEXT)-uninstall

########################################
LIBXXF86VM=libXxf86vm

FL_DEP_LIBXXF86VM= \
	$(XF86VIDMODEPROTO)-install \
	$(LIBXEXT)-install \
	$(NULL)

LIBXXF86VM_VERSION=1.1.4
LIBXXF86VM_SRC=$(LIBXXF86VM)-$(LIBXXF86VM_VERSION).tar.gz
LIBXXF86VM_URL="http://www.x.org/releases/individual/lib/$(LIBXXF86VM_SRC)"

$(DN_SRC)/$(LIBXXF86VM_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXXF86VM_URL)
	touch $@
$(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/configure: $(DN_SRC)/$(LIBXXF86VM_SRC)
	tar -xf $(DN_SRC)/$(LIBXXF86VM_SRC)
	#mv $(LIBXXF86VM)$(LIBXXF86VM_VERSION) $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/
	touch $@
$(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/Makefile: $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/configure $(FL_DEP_LIBXXF86VM)
	cd $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --disable-shared
$(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/src/$(LIBXXF86VM).la: $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/Makefile
	cd $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXXF86VM).la: $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/src/$(LIBXXF86VM).la
	cd $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXXF86VM)-uninstall: $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/src/$(LIBXXF86VM).la
	cd $(LIBXXF86VM)-$(LIBXXF86VM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXXF86VM)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXXF86VM).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXXF86VM_SRC)
FL_UNINSTALL+=$(LIBXXF86VM)-uninstall

########################################
# X11 miscellaneous 'fixes' extension library
# http://xorg.freedesktop.org/
LIBXFIXES=libXfixes

FL_DEP_LIBXFIXES= \
	$(XUTILMACRO)-install \
	$(FIXESPROTO)-install \
	$(LIBX11)-install \
	$(NULL)

LIBXFIXES_VERSION=5.0.1
LIBXFIXES_SRC=$(LIBXFIXES)-$(LIBXFIXES_VERSION).tar.gz
LIBXFIXES_URL=http://xorg.freedesktop.org/releases/individual/lib/$(LIBXFIXES_SRC)

$(DN_SRC)/$(LIBXFIXES_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXFIXES_URL)
	touch $@
$(LIBXFIXES)-$(LIBXFIXES_VERSION)/configure: $(DN_SRC)/$(LIBXFIXES_SRC)
	tar -xf $(DN_SRC)/$(LIBXFIXES_SRC)
	touch $@
$(LIBXFIXES)-$(LIBXFIXES_VERSION)/Makefile: $(LIBXFIXES)-$(LIBXFIXES_VERSION)/configure $(FL_DEP_LIBXFIXES)
	cd $(LIBXFIXES)-$(LIBXFIXES_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBXFIXES)-$(LIBXFIXES_VERSION)/src/$(LIBXFIXES).la: $(LIBXFIXES)-$(LIBXFIXES_VERSION)/Makefile
	cd $(LIBXFIXES)-$(LIBXFIXES_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXFIXES).la: $(LIBXFIXES)-$(LIBXFIXES_VERSION)/src/$(LIBXFIXES).la
	cd $(LIBXFIXES)-$(LIBXFIXES_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXFIXES)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXFIXES)"

$(LIBXFIXES)-uninstall: $(LIBXFIXES)-$(LIBXFIXES_VERSION)/src/$(LIBXFIXES).la
	cd $(LIBXFIXES)-$(LIBXFIXES_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXFIXES)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXFIXES).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXFIXES_SRC)
FL_UNINSTALL+=$(LIBXFIXES)-uninstall

########################################
LIBXSS=libXScrnSaver
LIBXSSLIB=libXss

#x11 xext xextproto scrnsaverproto
FL_DEP_LIBXSS= \
	$(LIBXEXT)-install \
	$(SCRNSAVERPROTO)-install \
	$(NULL)

LIBXSS_VERSION=1.2.2
LIBXSS_SRC=$(LIBXSS)-$(LIBXSS_VERSION).tar.gz
LIBXSS_URL="http://www.x.org/releases/individual/lib/$(LIBXSS_SRC)"

$(DN_SRC)/$(LIBXSS_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXSS_URL)
	touch $@
$(LIBXSS)-$(LIBXSS_VERSION)/configure: $(DN_SRC)/$(LIBXSS_SRC)
	tar -xf $(DN_SRC)/$(LIBXSS_SRC)
	touch $@
$(LIBXSS)-$(LIBXSS_VERSION)/Makefile: $(LIBXSS)-$(LIBXSS_VERSION)/configure $(FL_DEP_LIBXSS)
	cd $(LIBXSS)-$(LIBXSS_VERSION)/ \
	    && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)/ --sysconfdir=/etc
	touch $@
$(LIBXSS)-$(LIBXSS_VERSION)/src/$(LIBXSSLIB).la: $(LIBXSS)-$(LIBXSS_VERSION)/Makefile
	cd $(LIBXSS)-$(LIBXSS_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXSSLIB).a: $(LIBXSS)-$(LIBXSS_VERSION)/src/$(LIBXSSLIB).la
	cd $(LIBXSS)-$(LIBXSS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXSS)-uninstall: $(LIBXSS)-$(LIBXSS_VERSION)/src/$(LIBXSSLIB).la
	cd $(LIBXSS)-$(LIBXSS_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXSS)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXSSLIB).a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXSS_SRC)
FL_UNINSTALL+=$(LIBXSS)-uninstall

########################################
# LIBXMU, X11 miscellaneous micro-utility library
# http://xorg.freedesktop.org/
LIBXMU=libXmu
LIBXMU_VERSION=1.1.2
LIBXMU_SRC=$(LIBXMU)-$(LIBXMU_VERSION).tar.gz
LIBXMU_URL=http://xorg.freedesktop.org/releases/individual/lib/$(LIBXMU_SRC)

FL_DEP_LIBXMU= \
	$(LIBXEXT)-install \
	$(LIBXT)-install \
	$(NULL)

$(DN_SRC)/$(LIBXMU_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXMU_URL)
	touch $@
$(LIBXMU)-$(LIBXMU_VERSION)/configure: $(DN_SRC)/$(LIBXMU_SRC)
	tar -xf $(DN_SRC)/$(LIBXMU_SRC)
	touch $@
$(LIBXMU)-$(LIBXMU_VERSION)/Makefile: $(LIBXMU)-$(LIBXMU_VERSION)/configure $(FL_DEP_LIBXMU)
	cd $(LIBXMU)-$(LIBXMU_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBXMU)-$(LIBXMU_VERSION)/src/$(LIBXMU).la: $(LIBXMU)-$(LIBXMU_VERSION)/Makefile
	cd $(LIBXMU)-$(LIBXMU_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXMU).la: $(LIBXMU)-$(LIBXMU_VERSION)/src/$(LIBXMU).la
	cd $(LIBXMU)-$(LIBXMU_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXMU)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXMU)"

$(LIBXMU)-uninstall: $(LIBXMU)-$(LIBXMU_VERSION)/src/$(LIBXMU).la
	cd $(LIBXMU)-$(LIBXMU_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXMU)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXMU).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXMU_SRC)
FL_UNINSTALL+=$(LIBXMU)-uninstall

########################################
# libxi, X11 Input extension library
# http://xorg.freedesktop.org/
LIBXI=libXi
LIBXI_VERSION=1.7.5
LIBXI_SRC=$(LIBXI)-$(LIBXI_VERSION).tar.gz
LIBXI_URL=http://xorg.freedesktop.org/releases/individual/lib/$(LIBXI_SRC)

FL_DEP_LIBXI= \
	$(INPUTPROTO)-install \
	$(LIBXEXT)-install \
	$(LIBXFIXES)-install \
	$(NULL)

$(DN_SRC)/$(LIBXI_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXI_URL)
	touch $@
$(LIBXI)-$(LIBXI_VERSION)/configure: $(DN_SRC)/$(LIBXI_SRC)
	tar -xf $(DN_SRC)/$(LIBXI_SRC)
	touch $@
$(LIBXI)-$(LIBXI_VERSION)/Makefile: $(LIBXI)-$(LIBXI_VERSION)/configure $(FL_DEP_LIBXI)
	cd $(LIBXI)-$(LIBXI_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBXI)-$(LIBXI_VERSION)/src/$(LIBXI).la: $(LIBXI)-$(LIBXI_VERSION)/Makefile
	cd $(LIBXI)-$(LIBXI_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXI).la: $(LIBXI)-$(LIBXI_VERSION)/src/$(LIBXI).la
	cd $(LIBXI)-$(LIBXI_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXI)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXI)"

$(LIBXI)-uninstall: $(LIBXI)-$(LIBXI_VERSION)/src/$(LIBXI).la
	cd $(LIBXI)-$(LIBXI_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXI)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXI).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXI_SRC)
FL_UNINSTALL+=$(LIBXI)-uninstall

########################################
# X11 Video extension library
LIBXV=libXv

FL_DEP_LIBXV= \
	$(LIBXEXT)-install \
	$(LIBXFIXES)-install \
	$(VIDEOPROTO)-install \
	$(NULL)

LIBXV_VERSION=1.0.10
LIBXV_SRC=$(LIBXV)-$(LIBXV_VERSION).tar.gz
LIBXV_URL=http://xorg.freedesktop.org/releases/individual/lib/$(LIBXV_SRC)

$(DN_SRC)/$(LIBXV_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXV_URL)
	touch $@
$(LIBXV)-$(LIBXV_VERSION)/configure: $(DN_SRC)/$(LIBXV_SRC)
	tar -xf $(DN_SRC)/$(LIBXV_SRC)
	touch $@
$(LIBXV)-$(LIBXV_VERSION)/Makefile: $(LIBXV)-$(LIBXV_VERSION)/configure $(FL_DEP_LIBXV)
	cd $(LIBXV)-$(LIBXV_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBXV)-$(LIBXV_VERSION)/src/$(LIBXV).la: $(LIBXV)-$(LIBXV_VERSION)/Makefile
	cd $(LIBXV)-$(LIBXV_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXV).la: $(LIBXV)-$(LIBXV_VERSION)/src/$(LIBXV).la
	cd $(LIBXV)-$(LIBXV_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXV)-uninstall: $(LIBXV)-$(LIBXV_VERSION)/src/$(LIBXV).la
	cd $(LIBXV)-$(LIBXV_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXV)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXV).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXV_SRC)
FL_UNINSTALL+=$(LIBXV)-uninstall

########################################
LIBXSHMFENCE=libxshmfence

FL_DEP_LIBXSHMFENCE= \
	$(XUTILMACRO)-install \
	$(XPROTO)-install \
	$(NULL)

LIBXSHMFENCE_VERSION=1.2
LIBXSHMFENCE_SRC=$(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION).tar.gz
LIBXSHMFENCE_URL="http://xorg.freedesktop.org/releases/individual/lib/$(LIBXSHMFENCE_SRC)"

$(DN_SRC)/$(LIBXSHMFENCE_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXSHMFENCE_URL)
	touch $@
$(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/configure: $(DN_SRC)/$(LIBXSHMFENCE_SRC)
	tar -xf $(DN_SRC)/$(LIBXSHMFENCE_SRC)
	#mv $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION) $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/
	touch $@
$(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/Makefile: $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/configure $(FL_DEP_LIBXSHMFENCE)
	cd $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
$(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/src/$(LIBXSHMFENCE).la: $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/Makefile
	cd $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXSHMFENCE).la: $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/src/$(LIBXSHMFENCE).la
	cd $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBXSHMFENCE)-uninstall: $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/src/$(LIBXSHMFENCE).la
	cd $(LIBXSHMFENCE)-$(LIBXSHMFENCE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXSHMFENCE)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXSHMFENCE).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXSHMFENCE_SRC)
FL_UNINSTALL+=$(LIBXSHMFENCE)-uninstall

########################################
LIBXDAMAGE=libXdamage

FL_DEP_LIBXDAMAGE= \
	$(XUTILMACRO)-install \
	$(DAMAGEPROTO)-install \
	$(LIBXFIXES)-install \
	$(NULL)

LIBXDAMAGE_VERSION=1.1.4
LIBXDAMAGE_SRC=$(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION).tar.gz
LIBXDAMAGE_URL=http://xorg.freedesktop.org/releases/individual/lib/$(LIBXDAMAGE_SRC)

$(DN_SRC)/$(LIBXDAMAGE_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBXDAMAGE_URL)
	touch $@
$(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/configure: $(DN_SRC)/$(LIBXDAMAGE_SRC)
	tar -xf $(DN_SRC)/$(LIBXDAMAGE_SRC)
	touch $@
$(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/Makefile: $(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/configure $(FL_DEP_LIBXDAMAGE)
	cd $(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ --disable-static
	touch $@
$(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/src/$(LIBXDAMAGE).la: $(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/Makefile
	cd $(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXDAMAGE).la: $(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/src/$(LIBXDAMAGE).la
	cd $(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install \
	    && install -m755 -d "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXDAMAGE)" \
	    && install -m644 COPYING "$(PREFIX_DEST)/$(PREFIX_CONF)/share/licenses/$(LIBXDAMAGE)"

$(LIBXDAMAGE)-uninstall: $(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/src/$(LIBXDAMAGE).la
	cd $(LIBXDAMAGE)-$(LIBXDAMAGE_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBXDAMAGE)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBXDAMAGE).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBXDAMAGE_SRC)
FL_UNINSTALL+=$(LIBXDAMAGE)-uninstall

########################################
TCL=tcl
TCL_VERSION=8.6.4
#TCL_SRC=$(TCL)-core$(TCL_VERSION)-src.tar.gz
#TCL_URL="http://downloads.sourceforge.net/sourceforge/tcl/$(TCL_SRC)"
TCL_SRC=$(TCL)$(TCL_VERSION)-src.tar.gz
TCL_URL="http://sourceforge.net/projects/tcl/files/Tcl/$(TCL_VERSION)/$(TCL_SRC)"

FL_DEP_TCL= \
	$(AUTOMAKE)-install \
	$(ZLIB)-install \
	$(NULL)

$(DN_SRC)/$(TCL_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(TCL_URL)
	touch $@
$(TCL)-$(TCL_VERSION)/README: $(DN_SRC)/$(TCL_SRC)
	tar -xf $(DN_SRC)/$(TCL_SRC)
	mv $(TCL)$(TCL_VERSION) $(TCL)-$(TCL_VERSION)/
	touch $@
#$(TCL)-$(TCL_VERSION)/mypatched: $(DN_PATCH)/pbs-libTCL-libvpx.patch $(TCL)-$(TCL_VERSION)/README
	#cd $(TCL)-$(TCL_VERSION)/ && patch -p1 < $(DN_PATCH)/pbs-libTCL-libvpx.patch
	#touch $@
$(TCL)-$(TCL_VERSION)/unix/configure: $(TCL)-$(TCL_VERSION)/README $(FL_DEP_TCL) #$(TCL)-$(TCL_VERSION)/mypatched
	#cd $(TCL)-$(TCL_VERSION)/unix && $(ENV_COMPILE) ./bootstrap.sh
	cd $(TCL)-$(TCL_VERSION)/unix && $(ENV_COMPILE) autoreconf -if
	touch $@

$(TCL)-$(TCL_VERSION)/unix/Makefile: $(TCL)-$(TCL_VERSION)/unix/configure
	cd $(TCL)-$(TCL_VERSION)/unix/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --without-x --enable-gcc --disable-shared
$(TCL)-$(TCL_VERSION)/unix/tclsh: $(TCL)-$(TCL_VERSION)/unix/Makefile
	cd $(TCL)-$(TCL_VERSION)/unix/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/tclsh: $(TCL)-$(TCL_VERSION)/unix/tclsh
	cd $(TCL)-$(TCL_VERSION)/unix/ && make -j1 DESTDIR=$(PREFIX_DEST) install install-private-headers
	install -m 755 $(TCL)-$(TCL_VERSION)/unix/tclsh $(PREFIX_DEST)/$(PREFIX_CONF)/bin/

$(TCL)-uninstall: $(TCL)-$(TCL_VERSION)/unix/tclsh
	cd $(TCL)-$(TCL_VERSION)/unix/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(TCL)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/tclsh
	touch $@

FL_SOURCES+=$(DN_SRC)/$(TCL_SRC)
FL_UNINSTALL+=$(TCL)-uninstall

########################################
TK=tk
TK_VERSION=8.6.4
TK_SRC=$(TK)$(TK_VERSION)-src.tar.gz
TK_URL="http://sourceforge.net/projects/tcl/files/Tcl/$(TK_VERSION)/$(TK_SRC)"

FL_DEP_TK= \
	$(AUTOMAKE)-install \
	$(TCL)-install \
	$(LIBXSS)-install \
	$(LIBXFT)-install \
	$(NULL)

$(DN_SRC)/$(TK_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(TK_URL)
	touch $@
$(TK)-$(TK_VERSION)/README: $(DN_SRC)/$(TK_SRC)
	tar -xf $(DN_SRC)/$(TK_SRC)
	mv $(TK)$(TK_VERSION) $(TK)-$(TK_VERSION)/
	touch $@

$(TK)-$(TK_VERSION)/unix/configure: $(TK)-$(TK_VERSION)/README $(FL_DEP_TK)
	#cd $(TK)-$(TK_VERSION)/unix && $(ENV_COMPILE) ./bootstrap.sh
	cd $(TK)-$(TK_VERSION)/unix && $(ENV_COMPILE) autoreconf -if
	touch $@

$(TK)-$(TK_VERSION)/unix/Makefile: $(TK)-$(TK_VERSION)/unix/configure
	cd $(TK)-$(TK_VERSION)/unix && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-gcc --disable-shared --disable-rpath --enable-threads #--without-x
$(TK)-$(TK_VERSION)/unix/wish: $(TK)-$(TK_VERSION)/unix/Makefile
	cd $(TK)-$(TK_VERSION)/unix/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/wish: $(TK)-$(TK_VERSION)/unix/wish
	cd $(TK)-$(TK_VERSION)/unix/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	install -m 755 $(TK)-$(TK_VERSION)/unix/wish $(PREFIX_DEST)/$(PREFIX_CONF)/bin/

$(TK)-uninstall: $(TK)-$(TK_VERSION)/unix/wish
	cd $(TK)-$(TK_VERSION)/unix/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(TK)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/wish
	touch $@

FL_SOURCES+=$(DN_SRC)/$(TK_SRC)
FL_UNINSTALL+=$(TK)-uninstall

########################################
# MIT Object Tcl, is an extension to Tcl/Tk for object-oriented programming.
OTCL=otcl
OTCL_VERSION=1.14
OTCL_SRC=$(OTCL)-src-$(OTCL_VERSION).tar.gz
OTCL_URL="http://sourceforge.net/projects/otcl-tclcl/files/OTcl/$(OTCL_VERSION)/$(OTCL_SRC)"

FL_DEP_OTCL= \
	$(AUTOMAKE)-install \
	$(TK)-install \
	$(LIBXT)-install \
	$(NULL)

$(DN_SRC)/otcl-1.14-tcl86-compat.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://aur.archlinux.org/cgit/aur.git/plain/otcl-1.14-tcl86-compat.patch?h=otcl
	touch $@

$(DN_SRC)/$(OTCL_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(OTCL_URL)
	touch $@
$(OTCL)-$(OTCL_VERSION)/otcl.c: $(DN_SRC)/$(OTCL_SRC)
	tar -xf $(DN_SRC)/$(OTCL_SRC)
	touch $@

$(OTCL)-$(OTCL_VERSION)/mypatched: $(DN_SRC)/otcl-1.14-tcl86-compat.patch $(OTCL)-$(OTCL_VERSION)/otcl.c
	cd $(OTCL)-$(OTCL_VERSION)/ \
        && patch -uNp1 < $(DN_SRC)/otcl-1.14-tcl86-compat.patch \
        && sed -e 's|@prefix@/|$$(DESTDIR)/@prefix@/|' -e 's|@INST_OLIBSH@|$$(DESTDIR)/@INST_OLIBSH@|' -i Makefile.in
	touch $@

$(OTCL)-$(OTCL_VERSION)/configure: $(OTCL)-$(OTCL_VERSION)/mypatched $(FL_DEP_OTCL)
	cd $(OTCL)-$(OTCL_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(OTCL)-$(OTCL_VERSION)/Makefile: $(OTCL)-$(OTCL_VERSION)/configure
	#cd $(OTCL)-$(OTCL_VERSION)/ && LIBS="-L$(PREFIX_DEST)/$(PREFIX_CONF)/lib -lXft -lz -lpthread" $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --disable-static --enable-shlib --enable-release --with-tcl=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-tcl-ver=$(TCL_VERSION) --with-tk=no --without-tk --x-libraries= --x-includes=
	cd $(OTCL)-$(OTCL_VERSION)/ && LIB+="$(LDFLAGS) `$(ENV_COMPILE) pkg-config --libs tk tcl xft xscrnsaver fontconfig` -lXt -lXrender -lX11 -lz -lm -ldl -pthread" $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-static --enable-shlib --enable-release --with-tcl=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-tcl-ver=$(TCL_VERSION) --with-tk=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-tk-ver=$(TK_VERSION) --x-libraries=$(PREFIX_DEST)/$(PREFIX_CONF)/lib --x-includes=$(PREFIX_DEST)/$(PREFIX_CONF)/include/X11/
$(OTCL)-$(OTCL_VERSION)/otclsh: $(OTCL)-$(OTCL_VERSION)/Makefile
	cd $(OTCL)-$(OTCL_VERSION)/ && $(ENV_COMPILE) make LIB+="$(LDFLAGS) `$(ENV_COMPILE) pkg-config --libs tk tcl xft xscrnsaver fontconfig` -lXt -lXrender -lX11 -lz -lm -ldl -pthread" CFLAGS="-fPIC" $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/otclsh: $(OTCL)-$(OTCL_VERSION)/otclsh
	cd $(OTCL)-$(OTCL_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	chmod 644 $(PREFIX_DEST)/$(PREFIX_CONF)/lib/*.a

$(OTCL)-uninstall: $(OTCL)-$(OTCL_VERSION)/otclsh
	cd $(OTCL)-$(OTCL_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(OTCL)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/otclsh
	touch $@

FL_SOURCES+=$(DN_SRC)/$(OTCL_SRC)
FL_UNINSTALL+=$(OTCL)-uninstall

########################################
# TclCL (Tcl with classes) is a Tcl/C++ interface provides a layer of C++ glue over OTcl.
TCLCL=tclcl
TCLCL_VERSION=1.20
TCLCL_SRC=$(TCLCL)-src-$(TCLCL_VERSION).tar.gz
TCLCL_URL=http://sourceforge.net/projects/otcl-tclcl/files/TclCL/$(TCLCL_VERSION)/$(TCLCL_SRC)

FL_DEP_TCLCL= \
	$(OTCL)-install \
	$(NULL)

$(DN_SRC)/tclcl-1.20-tcl86-compat.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://aur.archlinux.org/cgit/aur.git/plain/tclcl-1.20-tcl86-compat.patch?h=tclcl
	touch $@

$(DN_SRC)/$(TCLCL_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(TCLCL_URL)
	touch $@

$(TCLCL)-$(TCLCL_VERSION)/configure: $(DN_SRC)/$(TCLCL_SRC)
	tar -xf $(DN_SRC)/$(TCLCL_SRC)
	touch $@

$(TCLCL)-$(TCLCL_VERSION)/mypatched: $(DN_SRC)/tclcl-1.20-tcl86-compat.patch $(TCLCL)-$(TCLCL_VERSION)/configure
	cd $(TCLCL)-$(TCLCL_VERSION)/ && patch -uNp1 < $(DN_SRC)/tclcl-1.20-tcl86-compat.patch \
        && sed -e 's|@prefix@/|$$(DESTDIR)/@prefix@/|' -i Makefile.in
	touch $@

$(TCLCL)-$(TCLCL_VERSION)/Makefile: $(TCLCL)-$(TCLCL_VERSION)/mypatched $(TCLCL)-$(TCLCL_VERSION)/configure $(FL_DEP_TCLCL)
	#cd $(TCLCL)-$(TCLCL_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)/lib/tclcl --with-tcl=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-tcl-ver=$(TCL_VERSION) --with-zlib=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-otcl=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-tk=no --without-tk --x-libraries= --x-includes=
	cd $(TCLCL)-$(TCLCL_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)/lib/tclcl --with-zlib=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-otcl=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-tcl=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-tcl-ver=$(TCL_VERSION) --with-tk=$(PREFIX_DEST)/$(PREFIX_CONF)/ --with-tk-ver=$(TK_VERSION) --x-libraries=$(PREFIX_DEST)/$(PREFIX_CONF)/lib --x-includes=$(PREFIX_DEST)/$(PREFIX_CONF)/include/X11/
$(TCLCL)-$(TCLCL_VERSION)/libtclcl.a: $(TCLCL)-$(TCLCL_VERSION)/Makefile
	cd $(TCLCL)-$(TCLCL_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/tclcl/lib/libtclcl.a: $(TCLCL)-$(TCLCL_VERSION)/libtclcl.a
	cd $(TCLCL)-$(TCLCL_VERSION)/ \
        && install -d $(PREFIX_DEST)/$(PREFIX_CONF)/lib/tclcl/bin \
        && install -d $(PREFIX_DEST)/$(PREFIX_CONF)/lib/tclcl/include \
        && install -d $(PREFIX_DEST)/$(PREFIX_CONF)/lib/tclcl/lib
	cd $(TCLCL)-$(TCLCL_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	chmod 644 $(PREFIX_DEST)/$(PREFIX_CONF)/lib/tclcl/lib/*.a
	rm -f $(PREFIX_DEST)/$(PREFIX_CONF)/lib/tclcl/tcl2c++
	ln -s bin/tcl2c++ $(PREFIX_DEST)/$(PREFIX_CONF)/lib/tclcl/tcl2c++

$(TCLCL)-uninstall: $(TCLCL)-$(TCLCL_VERSION)/libtclcl.a
	cd $(TCLCL)-$(TCLCL_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(TCLCL)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/tclcl/lib/libtclcl.a
	touch $@

FL_SOURCES+=$(DN_SRC)/$(TCLCL_SRC)
FL_UNINSTALL+=$(TCLCL)-uninstall

########################################
# CUDA: NVIDIA's GPU proprietary programming toolkit
# ref: https://wiki.archlinux.org/index.php/GPGPU
# OpenCV 2.3.1 supports only CUDA 4.0.
# OpenCV 2.4 supports CUDA 4.1 and 4.2.

# https://aur.archlinux.org/packages/cu/cuda3.1-sdk/PKGBUILD
CUDASDK31=cuda3
CUDASDK31_VERSION=3.1
CUDASDK31_VERSION_CONN=3_1
CUDASDK31_SRC=gpucomputingsdk_$(CUDASDK31_VERSION)_linux.run
CUDASDK31_URL=http://developer.download.nvidia.com/compute/cuda/$(CUDASDK31_VERSION_CONN)/sdk/$(CUDASDK31_SRC)
$(DN_SRC)/$(CUDASDK31_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(CUDASDK31_URL)
	touch $@
$(CUDASDK31)-$(CUDASDK31_VERSION)/pkg: $(DN_SRC)/$(CUDASDK31_SRC)
	@echo "Extracting CUDA SDK ..."
	mkdir -p $(CUDASDK31)-$(CUDASDK31_VERSION) \
		&& cd $(CUDASDK31)-$(CUDASDK31_VERSION) \
		&& sh $(DN_SRC)/$(CUDASDK31_SRC) --noexec --keep \
        && cd pkg/sdk/C/common \
        && sed -i "s|/usr/local/cuda|$(PREFIX)/opt/$(CUDASDK31)|g" common.mk \
        && make
	touch $@
$(CUDASDK31)-uninstall: $(CUDASDK31)-$(CUDASDK31_VERSION)/pkg
	rm -rf  "$(PREFIX)/opt/$(CUDASDK31)/"
$(CUDASDK31)-install: $(CUDASDK31)-$(CUDASDK31_VERSION)/pkg $(FL_DEP_CUDASDK31)
	cd $(CUDASDK31)-$(CUDASDK31_VERSION)/ \
		&& mkdir -p $(PREFIX)/opt/$(CUDASDK31)/ \
		&& for i in pkg/sdk/* ; do \
              cp "$i" "$(PREFIX)/opt/$(CUDASDK31)/" \
           done

ifeq ($(ARCHBITS),64) # 64 bit CPU
# https://projects.archlinux.org/svntogit/community.git/tree/trunk/PKGBUILD?h=packages/cuda
# http://developer.download.nvidia.com/compute/cuda/7_0/Prod/local_installers/cuda_7.0.28_linux.run
CUDASDK=cuda7

CUDASDK_VERSION=7.0.28
CUDASDK_VERSION_CONN=7_0
# http://developer.download.nvidia.com/compute/cuda/7.5/Prod/local_installers/cuda_7.5.18_linux.run
CUDASDK_VERSION=7.5.18
CUDASDK_VERSION_CONN=7.5

CUDASDK_SRC=cuda_$(CUDASDK_VERSION)_linux.run
CUDASDK_LIBSUFFIX=64
CUDASDK_URL=http://developer.download.nvidia.com/compute/cuda/$(CUDASDK_VERSION_CONN)/Prod/local_installers/$(CUDASDK_SRC)
# extracted SRC: cuda_7.0.28_linux.run --extract=extracted/
#   NVIDIA-Linux-x86_64-346.46.run -- NVIDIA Accelerated Graphics Driver for Linux-x86_64
#   cuda-linux64-rel-7.0.28-19326674.run -noprompt -prefix=$(pwd)/target
#   cuda-samples-linux-7.0.28-19326674.run

else # 32 bit?
# Since NVIDIA (>6.0.37) only provides cufft, nvblas, nppc, nppi, npps libs for x64, it's naturally impossible for CMAKE to find these libs for configuring a 32bit OpenCV library.
CUDASDK=cuda6
CUDASDK_VERSION=6.0.37
CUDASDK_VERSION_CONN=6_0
CUDASDK_SRC=cuda_$(CUDASDK_VERSION)_linux_32.run
CUDASDK_LIBSUFFIX=
CUDASDK_URL=http://developer.download.nvidia.com/compute/cuda/$(CUDASDK_VERSION_CONN)/rel/installers/$(CUDASDK_SRC)
# http://developer.download.nvidia.com/compute/cuda/6_5/rel/installers/cuda_6.5.14_linux_32.run
# http://developer.download.nvidia.com/compute/cuda/6_0/rel/installers/cuda_6.0.37_linux_32.run
endif

$(DN_SRC)/$(CUDASDK_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(CUDASDK_URL)
	touch $@
$(CUDASDK)-$(CUDASDK_VERSION)/pkg: $(DN_SRC)/$(CUDASDK_SRC)
	@echo "Extracting CUDA SDK ..."
	mkdir -p $(CUDASDK)-$(CUDASDK_VERSION)/extracted/ \
		&& sh $(DN_SRC)/$(CUDASDK_SRC) --extract=$(shell pwd)/$(CUDASDK)-$(CUDASDK_VERSION)/extracted/  \
		&& cd $(CUDASDK)-$(CUDASDK_VERSION)/ \
		&& sh extracted/cuda-linux*.run --noexec --keep \
		&& sh extracted/cuda-samples-linux-*.run --noexec --keep \
		&& sh extracted/NVIDIA-Linux-*.run --keep -x -a \
		&& rm -rf nvdrv && ls | grep NVIDIA-Linux | while read A; do echo move $$A ...; mv $$A nvdrv ; done \
        && sed  -e "s|/usr/share|$(PREFIX_DEST)/$(PREFIX_CONF)/share|g" \
                -e 's|can_add_for_all_users;|1;|g' \
                -e 's|=\\"$$prefix\\\"|=/opt/$(CUDASDK)|g' -e 's|Terminal=No|Terminal=false|g' -e 's|ParallelComputing|ParallelComputing;|g' \
                -i pkg/install-linux.pl \
		&& sed 's|\$$cudaprefix\\|\\/opt\\/$(CUDASDK)\\|g' -i pkg/install-sdk-linux.pl \
        && find pkg -name '*.py' | xargs sed -i -e 's|env python|env python2|g' -e 's|bin/python|bin/python2|g'
	touch $@

$(CUDASDK)-uninstall: $(CUDASDK)-$(CUDASDK_VERSION)/pkg
	rm -rf  "$(PREFIX)/opt/$(CUDASDK)/"
$(CUDASDK)-install: $(CUDASDK)-$(CUDASDK_VERSION)/pkg $(FL_DEP_CUDASDK)
	cd $(CUDASDK)-$(CUDASDK_VERSION)/pkg \
		&& perl install-linux.pl -prefix="$(PREFIX)/opt/$(CUDASDK)" -noprompt \
		&& perl install-sdk-linux.pl -cudaprefix="$(PREFIX)/opt/$(CUDASDK)" -prefix="$(PREFIX)/opt/$(CUDASDK)/samples" -noprompt \
		&& sed -i "/unsupported GNU/d" $(PREFIX)/opt/$(CUDASDK)/include/host_config.h \
		&& cd .. \
		&& cd nvdrv && cp lib* $(PREFIX)/opt/$(CUDASDK)/lib$(CUDASDK_LIBSUFFIX)/ \
		&& ls | grep "lib.*\.so" | awk '{split($$0,b,".");print $$0 "\t" b[1] "." b[2];}'  | while read A B; do ( \
		        echo "ln -sf $$A $${B}"; \
		        cd $(PREFIX)/opt/$(CUDASDK)/lib$(CUDASDK_LIBSUFFIX)/; \
		        if [ ! -e "$${B}" ];   then ln -sf $$A $${B};   fi; \
		        if [ ! -e "$${B}.1" ]; then ln -sf $$A $${B}.1; fi; \
		        cd $(PREFIX_DEST)/$(PREFIX_CONF)/lib/; \
		        REL=`perl -e 'use File::Spec; print File::Spec->abs2rel(@ARGV) . "\n"' $(PREFIX) $(PREFIX_DEST)/$(PREFIX_CONF)/lib/`; \
		        if [ ! -e "$${B}" ];   then ln -sf $${REL}/opt/$(CUDASDK)/lib$(CUDASDK_LIBSUFFIX)/$$A $${B};   fi; \
		        if [ ! -e "$${B}.1" ]; then ln -sf $${REL}/opt/$(CUDASDK)/lib$(CUDASDK_LIBSUFFIX)/$$A $${B}.1; fi; \
		    ) ; done
	touch $@

FL_SOURCES+=$(DN_SRC)/$(CUDASDK_SRC)
FL_UNINSTALL+=$(CUDASDK)-uninstall

ifeq ($(USE_GPU),1)
# CUDA_GENERATION: Auto, Kepler, Fermi
CUDA_LDLIB_PATH=$(PREFIX)/opt/$(CUDASDK)/lib64:$(PREFIX)/opt/$(CUDASDK)/lib:$(PREFIX)/opt/$(CUDASDK)/extras/CUPTI/lib/
CUDA_LIBS=-Wl,-rpath=$(PREFIX)/opt/$(CUDASDK)/lib64,--enable-new-dtags -L$(PREFIX)/opt/$(CUDASDK)/lib64 -L$(PREFIX)/opt/$(CUDASDK)/lib -L$(PREFIX)/opt/$(CUDASDK)/extras/CUPTI/lib/ -lGL -lnvidia-tls -lnvidia-glcore -lX11 -lXext -lc -ldl
CUDA_CFLAGS=-I$(PREFIX)/opt/$(CUDASDK)/include/ -I$(PREFIX)/opt/$(CUDASDK)/extras/CUPTI/include/
endif

########################################
LIBOMXILB=libomxil-bellagio

FL_DEP_LIBOMXILB= \
	$(NULL)

USE_GIT_LIBOMXILB=1

ifeq ($(USE_GIT_LIBOMXILB),1) # use git instead

LIBOMXILB_VERSION=git
LIBOMXILB_SRC=$(LIBOMXILB)-$(LIBOMXILB_VERSION)/configure.py
LIBOMXILB_URL=http://git.code.sf.net/p/omxil/omxil

$(DN_SRC)/$(LIBOMXILB_SRC): $(DN_SRC)/created
	if [ ! -d "$(DN_SRC)/$(LIBOMXILB_SRC)" ]; then \
        git clone $(LIBOMXILB_URL) $(DN_SRC)/$(LIBOMXILB)-$(LIBOMXILB_VERSION); \
    fi
	cd $(DN_SRC)/$(LIBOMXILB)-$(LIBOMXILB_VERSION) && git pull #&& git submodule update --init --recursive
	touch $@

$(LIBOMXILB)-$(LIBOMXILB_VERSION)/configure.ac: $(DN_SRC)/$(LIBOMXILB_SRC)
	cd $(DN_SRC)/$(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && git pull
	if [ ! -d "$(LIBOMXILB)-$(LIBOMXILB_VERSION)" ]; then \
        cp -r $(DN_SRC)/$(LIBOMXILB)-$(LIBOMXILB_VERSION)/ $(LIBOMXILB)-$(LIBOMXILB_VERSION); \
    fi
	cd $(LIBOMXILB)-$(LIBOMXILB_VERSION) && git pull #&& git submodule update --init --recursive
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBOMXILB_SRC)
else

LIBOMXILB_VERSION=0.9.3
LIBOMXILB_SRC=$(LIBOMXILB)-$(LIBOMXILB_VERSION).tar.gz
LIBOMXILB_URL="http://downloads.sourceforge.net/project/omxil/omxil/Bellagio%200.9.3/$(LIBOMXILB_SRC)"

$(DN_SRC)/$(LIBOMXILB_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBOMXILB_URL)
	touch $@
$(LIBOMXILB)-$(LIBOMXILB_VERSION)/configure.ac: $(DN_SRC)/$(LIBOMXILB_SRC)
	tar -xf $(DN_SRC)/$(LIBOMXILB_SRC)
	#mv $(LIBOMXILB)-$(LIBOMXILB_VERSION) $(LIBOMXILB)-$(LIBOMXILB_VERSION)/
	touch $@
endif

$(LIBOMXILB)-$(LIBOMXILB_VERSION)/mypatched: $(LIBOMXILB)-$(LIBOMXILB_VERSION)/configure.ac $(DN_PATCH)/pbs-libomxil-bellagio-emnu.patch $(FL_DEP_LIBOMXILB)
	if [ -d $(LIBOMXILB)-$(LIBOMXILB_VERSION)/.svn ]; then cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && svn revert -R . ; fi
	if [ -d $(LIBOMXILB)-$(LIBOMXILB_VERSION)/.hg ];  then cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && hg update -C . ; fi
	if [ -d $(LIBOMXILB)-$(LIBOMXILB_VERSION)/.git ]; then cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && git status | grep modified | awk '{print $$2}' | xargs git checkout ; fi
	cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ \
		&& sed -e 's|^CFLAGS=.*$$|CFLAGS="$${CFLAGS} -Wall"|' -i configure.ac \
		&& patch -p1 -i $(DN_PATCH)/pbs-libomxil-bellagio-emnu.patch
	touch $@
$(LIBOMXILB)-$(LIBOMXILB_VERSION)/configure: $(LIBOMXILB)-$(LIBOMXILB_VERSION)/mypatched
	cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@
$(LIBOMXILB)-$(LIBOMXILB_VERSION)/Makefile: $(LIBOMXILB)-$(LIBOMXILB_VERSION)/configure
	cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --docdir=$(PREFIX_CONF)/share/doc/$(LIBOMXILB) --disable-static
$(LIBOMXILB)-$(LIBOMXILB_VERSION)/libomxil-bellagio.pc: $(LIBOMXILB)-$(LIBOMXILB_VERSION)/Makefile
	cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libomxil-bellagio.pc: $(LIBOMXILB)-$(LIBOMXILB_VERSION)/libomxil-bellagio.pc
	cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBOMXILB)-uninstall: $(LIBOMXILB)-$(LIBOMXILB_VERSION)/libomxil-bellagio.pc
	cd $(LIBOMXILB)-$(LIBOMXILB_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBOMXILB)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/libomxil-bellagio.pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBOMXILB_SRC)
FL_UNINSTALL+=$(LIBOMXILB)-uninstall

########################################
# A functional language with OO extensions
OCAML=ocaml

FL_DEP_OCAML= \
	$(TK)-install \
	$(NCURSES)-install \
	$(LIBX11)-install \
	$(NULL)

OCAML_VERSION=4.02.3
OCAML_SRC=$(OCAML)-$(OCAML_VERSION).tar.gz
OCAML_URL=http://caml.inria.fr/distrib/ocaml-4.02/$(OCAML_SRC)

$(DN_SRC)/$(OCAML_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(OCAML_URL)
	touch $@
$(OCAML)-$(OCAML_VERSION)/configure: $(DN_SRC)/$(OCAML_SRC)
	tar -xf $(DN_SRC)/$(OCAML_SRC)
	touch $@
#$(OCAML)-$(OCAML_VERSION)/mypatched: $(OCAML)-$(OCAML_VERSION)/configure.ac $(FL_DEP_OCAML)
#	cd $(OCAML)-$(OCAML_VERSION)/ && sed -e 's|^AX_ENABLE_BUILDDIR|\#AX_ENABLE_BUILDDIR|' -i configure.ac
#	touch $@
#$(OCAML)-$(OCAML_VERSION)/configure: $(OCAML)-$(OCAML_VERSION)/mypatched
#	cd $(OCAML)-$(OCAML_VERSION)/ && $(ENV_COMPILE) autoreconf -if
#	touch $@
$(OCAML)-$(OCAML_VERSION)/Makefile: $(OCAML)-$(OCAML_VERSION)/configure
	cd $(OCAML)-$(OCAML_VERSION)/ && $(ENV_COMPILE) ./configure -prefix $(PREFIX_CONF) -x11include $(PREFIX_CONF)/include
	touch $@
$(OCAML)-$(OCAML_VERSION)/$(OCAML): $(OCAML)-$(OCAML_VERSION)/Makefile
	cd $(OCAML)-$(OCAML_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG) world.opt
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/$(OCAML): $(OCAML)-$(OCAML_VERSION)/$(OCAML)
	cd $(OCAML)-$(OCAML_VERSION)/ \
	    && make -j1 PREFIX=$(PREFIX_DEST)/$(PREFIX_CONF)/ MANDIR=$(PREFIX_DEST)/$(PREFIX_CONF)/share/man install
	cd $(OCAML)-$(OCAML_VERSION)/ \
	    && mkdir -p $(PREFIX_DEST)/$(PREFIX_CONF)/lib/ocaml/compiler-libs/{parsing,typing,utils} \
	    && cp parsing/*.{cmi,cmo,cmx,ml,mli,mll,o} $(PREFIX_DEST)/$(PREFIX_CONF)/lib/ocaml/compiler-libs/parsing \
	    && cp typing/*.{cmi,cmo,cmx,ml,mli,o}      $(PREFIX_DEST)/$(PREFIX_CONF)/lib/ocaml/compiler-libs/typing \
	    && cp utils/*.{cmi,cmo,cmx,ml,mli,o}       $(PREFIX_DEST)/$(PREFIX_CONF)/lib/ocaml/compiler-libs/utils \
	    && rm -f $(PREFIX_DEST)/$(PREFIX_CONF)/lib/ocaml/compiler-libs/typing/outcometree.{cmi,mli}

$(OCAML)-uninstall: $(OCAML)-$(OCAML_VERSION)/$(OCAML)
	cd $(OCAML)-$(OCAML_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(OCAML)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/$(OCAML)
	touch $@

FL_SOURCES+=$(DN_SRC)/$(OCAML_SRC)
FL_UNINSTALL+=$(OCAML)-uninstall

########################################
# Command line editor library providing generic line editing, history, and tokenization functions
LIBEDIT=libedit

FL_DEP_LIBEDIT= \
	$(NCURSES)-install \
	$(NULL)

LIBEDIT_VERSION=20150325-3.1
LIBEDIT_SRC=$(LIBEDIT)-$(LIBEDIT_VERSION).tar.gz
LIBEDIT_URL=http://www.thrysoee.dk/editline/$(LIBEDIT_SRC)

$(DN_SRC)/$(LIBEDIT_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBEDIT_URL)
	touch $@
$(LIBEDIT)-$(LIBEDIT_VERSION)/configure: $(DN_SRC)/$(LIBEDIT_SRC) $(FL_DEP_LIBEDIT)
	tar -xf $(DN_SRC)/$(LIBEDIT_SRC)
	touch $@
#$(LIBEDIT)-$(LIBEDIT_VERSION)/mypatched: $(LIBEDIT)-$(LIBEDIT_VERSION)/configure.ac $(FL_DEP_LIBEDIT)
#	cd $(LIBEDIT)-$(LIBEDIT_VERSION)/ && sed -e 's|^AX_ENABLE_BUILDDIR|\#AX_ENABLE_BUILDDIR|' -i configure.ac
#	touch $@
#$(LIBEDIT)-$(LIBEDIT_VERSION)/configure: $(LIBEDIT)-$(LIBEDIT_VERSION)/mypatched
#	cd $(LIBEDIT)-$(LIBEDIT_VERSION)/ && $(ENV_COMPILE) autoreconf -if
#	touch $@
$(LIBEDIT)-$(LIBEDIT_VERSION)/Makefile: $(LIBEDIT)-$(LIBEDIT_VERSION)/configure
	cd $(LIBEDIT)-$(LIBEDIT_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --enable-widec
	touch $@
$(LIBEDIT)-$(LIBEDIT_VERSION)/src/$(LIBEDIT).la: $(LIBEDIT)-$(LIBEDIT_VERSION)/Makefile
	cd $(LIBEDIT)-$(LIBEDIT_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBEDIT).la: $(LIBEDIT)-$(LIBEDIT_VERSION)/src/$(LIBEDIT).la
	cd $(LIBEDIT)-$(LIBEDIT_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBEDIT)-uninstall: $(LIBEDIT)-$(LIBEDIT_VERSION)/src/$(LIBEDIT).la
	cd $(LIBEDIT)-$(LIBEDIT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBEDIT)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBEDIT).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBEDIT_SRC)
FL_UNINSTALL+=$(LIBEDIT)-uninstall

########################################
LLVM=llvm

FL_DEP_LLVM= \
	$(CMAKE)-install \
	$(ZLIB)-install \
	$(OCAML)-install \
	$(LIBFFI)-install \
	$(LIBEDIT)-install \
	$(NULL)

LLVM_VERSION=3.7.0
LLVM_SRC=$(LLVM)-$(LLVM_VERSION).src.tar.xz
LLVM_URL="http://llvm.org/releases/$(LLVM_VERSION)/$(LLVM_SRC)"

$(DN_SRC)/$(LLVM_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LLVM_URL)
	touch $@

$(DN_SRC)/cfe-$(LLVM_VERSION).src.tar.xz: $(DN_SRC)/created
	$(WGET) -O $@ -c http://llvm.org/releases/$(LLVM_VERSION)/cfe-$(LLVM_VERSION).src.tar.xz
	touch $@
FL_SOURCES+=$(DN_SRC)/cfe-$(LLVM_VERSION).src.tar.xz
$(DN_SRC)/clang-tools-extra-$(LLVM_VERSION).src.tar.xz: $(DN_SRC)/created
	$(WGET) -O $@ -c http://llvm.org/releases/$(LLVM_VERSION)/clang-tools-extra-$(LLVM_VERSION).src.tar.xz
	touch $@
FL_SOURCES+=$(DN_SRC)/clang-tools-extra-$(LLVM_VERSION).src.tar.xz
$(DN_SRC)/compiler-rt-$(LLVM_VERSION).src.tar.xz: $(DN_SRC)/created
	$(WGET) -O $@ -c http://llvm.org/releases/$(LLVM_VERSION)/compiler-rt-$(LLVM_VERSION).src.tar.xz
	touch $@
FL_SOURCES+=$(DN_SRC)/compiler-rt-$(LLVM_VERSION).src.tar.xz
$(DN_SRC)/lldb-$(LLVM_VERSION).src.tar.xz: $(DN_SRC)/created
	$(WGET) -O $@ -c http://llvm.org/releases/$(LLVM_VERSION)/lldb-$(LLVM_VERSION).src.tar.xz
	touch $@
FL_SOURCES+=$(DN_SRC)/lldb-$(LLVM_VERSION).src.tar.xz


$(DN_SRC)/llvm-compiler-rt-new-msan.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://projects.archlinux.org/svntogit/packages.git/plain/trunk/0001-New-MSan-mapping-layout-compiler-rt-part.patch?h=packages/llvm
	touch $@
FL_SOURCES+=$(DN_SRC)/llvm-compiler-rt-new-msan.patch
$(DN_SRC)/llvm-llvm-new-msan.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://projects.archlinux.org/svntogit/packages.git/plain/trunk/0001-New-MSan-mapping-layout-llvm-part.patch?h=packages/llvm
	touch $@
FL_SOURCES+=$(DN_SRC)/llvm-llvm-new-msan.patch
$(DN_SRC)/llvm-clang-add-gcc-abi-tag.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://projects.archlinux.org/svntogit/packages.git/plain/trunk/clang-3.7.0-add-gcc-abi-tag-support.patch?h=packages/llvm
	touch $@
FL_SOURCES+=$(DN_SRC)/llvm-clang-add-gcc-abi-tag.patch
$(DN_SRC)/llvm-clang-install-query.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://projects.archlinux.org/svntogit/packages.git/plain/trunk/clang-tools-extra-3.7.0-install-clang-query.patch?h=packages/llvm
	touch $@
FL_SOURCES+=$(DN_SRC)/llvm-clang-install-query.patch

$(DN_SRC)/llvm-lldb-no-libllvm.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://projects.archlinux.org/svntogit/packages.git/plain/trunk/lldb-3.7.0-avoid-linking-to-libLLVM.patch?h=packages/llvm
	touch $@
FL_SOURCES+=$(DN_SRC)/llvm-lldb-no-libllvm.patch

$(DN_SRC)/llvm-more-symbols.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://projects.archlinux.org/svntogit/packages.git/plain/trunk/llvm-3.7.0-export-more-symbols.patch?h=packages/llvm
	touch $@
FL_SOURCES+=$(DN_SRC)/llvm-more-symbols.patch

$(DN_SRC)/llvm-against-libllvm.patch: $(DN_SRC)/created
	$(WGET) -O $@ -c https://projects.archlinux.org/svntogit/packages.git/plain/trunk/llvm-3.7.0-link-tools-against-libLLVM.patch?h=packages/llvm
	touch $@
FL_SOURCES+=$(DN_SRC)/llvm-against-libllvm.patch

$(DN_SRC)/llvm-config.h: $(DN_SRC)/created
	$(WGET) -O $@ -c https://projects.archlinux.org/svntogit/packages.git/plain/trunk/llvm-Config-llvm-config.h?h=packages/llvm
	touch $@
FL_SOURCES+=$(DN_SRC)/llvm-config.h


$(LLVM)-$(LLVM_VERSION)/CMakeLists.txt: $(DN_SRC)/$(LLVM_SRC)
	tar -xf $(DN_SRC)/$(LLVM_SRC)
	mv $(LLVM)-$(LLVM_VERSION).src $(LLVM)-$(LLVM_VERSION)
	cd $(LLVM)-$(LLVM_VERSION)/ && tar -xf $(DN_SRC)/cfe-$(LLVM_VERSION).src.tar.xz
	cd $(LLVM)-$(LLVM_VERSION)/ && tar -xf $(DN_SRC)/clang-tools-extra-$(LLVM_VERSION).src.tar.xz
	cd $(LLVM)-$(LLVM_VERSION)/ && tar -xf $(DN_SRC)/compiler-rt-$(LLVM_VERSION).src.tar.xz
	cd $(LLVM)-$(LLVM_VERSION)/ && tar -xf $(DN_SRC)/lldb-$(LLVM_VERSION).src.tar.xz
	mv $(LLVM)-$(LLVM_VERSION)/cfe-$(LLVM_VERSION).src               $(LLVM)-$(LLVM_VERSION)/tools/clang
	mv $(LLVM)-$(LLVM_VERSION)/clang-tools-extra-$(LLVM_VERSION).src $(LLVM)-$(LLVM_VERSION)/tools/clang/tools/extra
	mv $(LLVM)-$(LLVM_VERSION)/compiler-rt-$(LLVM_VERSION).src       $(LLVM)-$(LLVM_VERSION)/projects/compiler-rt
	mv $(LLVM)-$(LLVM_VERSION)/lldb-$(LLVM_VERSION).src              $(LLVM)-$(LLVM_VERSION)/tools/lldb
	touch $@

$(LLVM)-$(LLVM_VERSION)/mypatched: $(LLVM)-$(LLVM_VERSION)/CMakeLists.txt $(FL_DEP_LLVM)
	cd $(LLVM)-$(LLVM_VERSION)/ \
        && patch -Np1 -i $(DN_SRC)/llvm-against-libllvm.patch \
        && patch -Np2 -i $(DN_SRC)/llvm-more-symbols.patch \
		&& patch -d tools/clang -Np0 -i $(DN_SRC)/llvm-clang-add-gcc-abi-tag.patch \
        && patch -d tools/clang/tools/extra -Np1 -i $(DN_SRC)/llvm-clang-install-query.patch \
        && patch -d tools/lldb -Np1 -i $(DN_SRC)/llvm-lldb-no-libllvm.patch \
		&& patch -Np1 -i $(DN_SRC)/llvm-llvm-new-msan.patch \
		&& patch -d projects/compiler-rt -Np1 -i $(DN_SRC)/llvm-compiler-rt-new-msan.patch \
        $(NULL)
	find $(LLVM)-$(LLVM_VERSION)/tools/lldb -name Makefile -exec sed -i 's/python-config/python2-config/' {} +
	sed -i 's|/usr/bin/env python|&2|' \
		"$(LLVM)-$(LLVM_VERSION)/tools/lldb/scripts/Python/build-swig-Python.sh" \
		"$(LLVM)-$(LLVM_VERSION)/tools/lldb/scripts/Python/finish-swig-Python-LLDB.sh"
	touch $@

$(LLVM)-$(LLVM_VERSION)/build/Makefile: $(LLVM)-$(LLVM_VERSION)/mypatched
	cd $(LLVM)-$(LLVM_VERSION)/ && mkdir -p build && cd build \
		&& $(ENV_COMPILE) cmake \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_INSTALL_PREFIX=$(PREFIX_DEST)/$(PREFIX_CONF)/ \
            -DLLVM_BUILD_LLVM_DYLIB=ON \
			-DLLVM_DYLIB_EXPORT_ALL=ON \
			-DLLVM_LINK_LLVM_DYLIB=ON \
			-DLLVM_ENABLE_RTTI=ON \
			-DLLVM_ENABLE_FFI=ON \
			-DLLVM_BUILD_DOCS=ON \
			-DLLVM_ENABLE_SPHINX=ON \
			-DLLVM_ENABLE_DOXYGEN=OFF \
			-DSPHINX_WARNINGS_AS_ERRORS=OFF \
			-DFFI_INCLUDE_DIR=`pkg-config --variable=includedir libffi` \
			-DLLVM_BINUTILS_INCDIR=/usr/include \
            ..
$(LLVM)-$(LLVM_VERSION)/build/lib/LLVMgold.so: $(LLVM)-$(LLVM_VERSION)/build/Makefile
	cd $(LLVM)-$(LLVM_VERSION)/build/ && $(ENV_COMPILE) make $(MAKE_ARG)
	#cd $(LLVM)-$(LLVM_VERSION)/build/ && $(ENV_COMPILE) make $(MAKE_ARG) ocaml_doc

$(PREFIX_DEST)/$(PREFIX_CONF)/lib/LLVMgold.so: $(LLVM)-$(LLVM_VERSION)/build/lib/LLVMgold.so
	cd $(LLVM)-$(LLVM_VERSION)/build/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	install -d "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/bfd-plugins" \
		&&  if [ ! -e "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/bfd-plugins/LLVMgold.so" ]; then \
				ln -s ../LLVMgold.so "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/bfd-plugins/LLVMgold.so"; \
			fi
	# lldb:
	cd $(LLVM)-$(LLVM_VERSION)/ \
		&& make -C build/tools/lldb DESTDIR=$(PREFIX_DEST) install \
		&& python2 -m compileall "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/python2.7/site-packages/lldb" \
		&& python2 -O -m compileall "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/python2.7/site-packages/lldb"
	# clang:
	cd $(LLVM)-$(LLVM_VERSION)/ \
		&& make -C build/tools/clang install
	cd $(LLVM)-$(LLVM_VERSION)/ \
		&& make -C build/projects/compiler-rt install
	touch $@

$(LLVM)-$(LLVM_VERSION)/build/bin/clang: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/LLVMgold.so
	touch $@

$(PREFIX_DEST)/$(PREFIX_CONF)/bin/clang: $(LLVM)-$(LLVM_VERSION)/build/bin/clang
	# clang: Install Python bindings
	install -d "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/python2.7/site-packages"
	cp -ar $(LLVM)-$(LLVM_VERSION)/tools/clang/bindings/python/clang/ "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/python2.7/site-packages/"
	python2 -m compileall "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/python2.7/site-packages/clang"
	python2 -O -m compileall "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/python2.7/site-packages/clang"
	# Use Python 2
	sed -i 's|/usr/bin/env python|&2|' \
        "$(PREFIX_DEST)/$(PREFIX_CONF)/bin/git-clang-format" \
        "$(PREFIX_DEST)/$(PREFIX_CONF)/share/clang/clang-format-diff.py"
    # clang-analyzer:
	cd $(LLVM)-$(LLVM_VERSION)/tools/clang \
		&& install -d $(PREFIX_DEST)/$(PREFIX_CONF)/{bin,lib/clang-analyzer} \
		&& for _tool in scan-{build,view} ; do \
				cp -a tools/$$_tool $(PREFIX_DEST)/$(PREFIX_CONF)/lib/clang-analyzer/ ; \
				rm -f "$(PREFIX_DEST)/$(PREFIX_CONF)/bin/$$_tool" ; \
				ln -s ../lib/clang-analyzer/$$_tool/$$_tool $(PREFIX_DEST)/$(PREFIX_CONF)/bin/$$_tool ; \
			done
	rm -f $(PREFIX_DEST)/$(PREFIX_CONF)/lib/clang-analyzer/scan-build/clang \
	   && ln -s ../../../bin/clang "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/clang-analyzer/scan-build/clang"
	sed -i \
               -e 's|env python$$|&2|' \
               -e 's|/usr/bin/python$$|&2|' \
               "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/clang-analyzer/scan-view/scan-view" \
               "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/clang-analyzer/scan-build/set-xcode-analyzer"
	python2 -m compileall "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/clang-analyzer"
	python2 -O -m compileall "$(PREFIX_DEST)/$(PREFIX_CONF)/lib/clang-analyzer"
	# clang-tools-extra
	cd $(LLVM)-$(LLVM_VERSION)/ \
		make -C build/tools/clang/tools/extra DESTDIR="$(PREFIX_DEST)/$(PREFIX_CONF)" install
	touch $@

$(LLVM)-uninstall: $(LLVM)-$(LLVM_VERSION)/build/bin/clang
	cd $(LLVM)-$(LLVM_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LLVM)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/clang
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LLVM_SRC)
FL_UNINSTALL+=$(LLVM)-uninstall

########################################
# Library requirements of the OpenCL C programming language
LIBCLC=libclc

FL_DEP_LIBCLC= \
	$(LLVM)-install \
	$(NULL)

USE_GIT_LIBCLC=1

ifeq ($(USE_GIT_LIBCLC),1) # use git instead

LIBCLC_VERSION=git
LIBCLC_SRC=$(LIBCLC)-$(LIBCLC_VERSION)/configure.py
LIBCLC_URL=http://llvm.org/git/libclc

$(DN_SRC)/$(LIBCLC_SRC): $(DN_SRC)/created
	if [ ! -d "$(DN_SRC)/$(LIBCLC_SRC)" ]; then \
        git clone $(LIBCLC_URL) $(DN_SRC)/$(LIBCLC)-$(LIBCLC_VERSION); \
    fi
	cd $(DN_SRC)/$(LIBCLC)-$(LIBCLC_VERSION) && git pull #&& git submodule update --init --recursive
	touch $@

$(LIBCLC)-$(LIBCLC_VERSION)/configure.py: $(DN_SRC)/$(LIBCLC_SRC)
	cd $(DN_SRC)/$(LIBCLC)-$(LIBCLC_VERSION)/ && git pull
	if [ ! -d "$(LIBCLC)-$(LIBCLC_VERSION)" ]; then \
        cp -r $(DN_SRC)/$(LIBCLC)-$(LIBCLC_VERSION)/ $(LIBCLC)-$(LIBCLC_VERSION); \
    fi
	cd $(LIBCLC)-$(LIBCLC_VERSION) && git pull #&& git submodule update --init --recursive
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBCLC_SRC)
else

LIBCLC_VERSION=0.1.5
LIBCLC_SRC=$(LIBCLC)-$(LIBCLC_VERSION).tar.gz
LIBCLC_URL="http://sourceforge.net/projects/libclc/files/libclc/Improved%20clc_string/$(LIBCLC_SRC)"

$(DN_SRC)/$(LIBCLC_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBCLC_URL)
	touch $@
$(LIBCLC)-$(LIBCLC_VERSION)/configure.py: $(DN_SRC)/$(LIBCLC_SRC)
	tar -xf $(DN_SRC)/$(LIBCLC_SRC)
	touch $@
endif

$(LIBCLC)-$(LIBCLC_VERSION)/mypatched: $(LIBCLC)-$(LIBCLC_VERSION)/configure.py $(FL_DEP_LIBCLC)
	cd $(LIBCLC)-$(LIBCLC_VERSION)/ && sed -i 's/"python < $in >/sys.executable + " < $in >/g' configure.py
	touch $@
$(LIBCLC)-$(LIBCLC_VERSION)/Makefile: $(LIBCLC)-$(LIBCLC_VERSION)/mypatched
	cd $(LIBCLC)-$(LIBCLC_VERSION)/ && $(ENV_COMPILE) python2 ./configure.py --prefix=$(PREFIX_CONF)
$(LIBCLC)-$(LIBCLC_VERSION)/$(LIBCLC).pc: $(LIBCLC)-$(LIBCLC_VERSION)/Makefile
	cd $(LIBCLC)-$(LIBCLC_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
	touch $@
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBCLC).pc: $(LIBCLC)-$(LIBCLC_VERSION)/$(LIBCLC).pc
	cd $(LIBCLC)-$(LIBCLC_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install
	cp $(LIBCLC)-$(LIBCLC_VERSION)/$(LIBCLC).pc $@
	touch $@

$(LIBCLC)-uninstall: $(LIBCLC)-$(LIBCLC_VERSION)/$(LIBCLC).pc
	cd $(LIBCLC)-$(LIBCLC_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBCLC)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(LIBCLC).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBCLC_SRC)
FL_UNINSTALL+=$(LIBCLC)-uninstall

########################################
# Nvidia VDPAU library
LIBVDPAU=libvdpau

FL_DEP_LIBVDPAU= \
	$(LIBXEXT)-install \
	$(NULL)

LIBVDPAU_VERSION=1.1.1
LIBVDPAU_SRC=$(LIBVDPAU)-$(LIBVDPAU_VERSION).tar.bz2
LIBVDPAU_URL=http://people.freedesktop.org/~aplattner/vdpau/$(LIBVDPAU_SRC)

$(DN_SRC)/$(LIBVDPAU_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBVDPAU_URL)
	touch $@
$(LIBVDPAU)-$(LIBVDPAU_VERSION)/configure: $(DN_SRC)/$(LIBVDPAU_SRC) $(FL_DEP_LIBVDPAU)
	tar -xf $(DN_SRC)/$(LIBVDPAU_SRC)
	touch $@
#$(LIBVDPAU)-$(LIBVDPAU_VERSION)/mypatched: $(LIBVDPAU)-$(LIBVDPAU_VERSION)/configure.ac $(FL_DEP_LIBVDPAU)
#	cd $(LIBVDPAU)-$(LIBVDPAU_VERSION)/ && sed -e 's|^AX_ENABLE_BUILDDIR|\#AX_ENABLE_BUILDDIR|' -i configure.ac
#	touch $@
#$(LIBVDPAU)-$(LIBVDPAU_VERSION)/configure: $(LIBVDPAU)-$(LIBVDPAU_VERSION)/mypatched
#	cd $(LIBVDPAU)-$(LIBVDPAU_VERSION)/ && $(ENV_COMPILE) autoreconf -if
#	touch $@
$(LIBVDPAU)-$(LIBVDPAU_VERSION)/Makefile: $(LIBVDPAU)-$(LIBVDPAU_VERSION)/configure
	cd $(LIBVDPAU)-$(LIBVDPAU_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc
	touch $@
$(LIBVDPAU)-$(LIBVDPAU_VERSION)/src/$(LIBVDPAU).la: $(LIBVDPAU)-$(LIBVDPAU_VERSION)/Makefile
	cd $(LIBVDPAU)-$(LIBVDPAU_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBVDPAU).la: $(LIBVDPAU)-$(LIBVDPAU_VERSION)/src/$(LIBVDPAU).la
	cd $(LIBVDPAU)-$(LIBVDPAU_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBVDPAU)-uninstall: $(LIBVDPAU)-$(LIBVDPAU_VERSION)/src/$(LIBVDPAU).la
	cd $(LIBVDPAU)-$(LIBVDPAU_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBVDPAU)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBVDPAU).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBVDPAU_SRC)
FL_UNINSTALL+=$(LIBVDPAU)-uninstall


########################################
# Video Acceleration (VA) API for Linux
LIBVA=libva

FL_DEP_LIBVA= \
	$(LIBDRM)-install \
	$(LIBXFIXES)-install \
	#$(LIBGL)-install \
	$(NULL)

LIBVA_VERSION=1.6.1
LIBVA_SRC=$(LIBVA)-$(LIBVA_VERSION).tar.bz2
LIBVA_URL=http://freedesktop.org/software/vaapi/releases/$(LIBVA)/$(LIBVA_SRC)

$(DN_SRC)/$(LIBVA_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(LIBVA_URL)
	touch $@
$(LIBVA)-$(LIBVA_VERSION)/configure: $(DN_SRC)/$(LIBVA_SRC) $(FL_DEP_LIBVA)
	tar -xf $(DN_SRC)/$(LIBVA_SRC)
	touch $@
#$(LIBVA)-$(LIBVA_VERSION)/mypatched: $(LIBVA)-$(LIBVA_VERSION)/configure.ac
#	cd $(LIBVA)-$(LIBVA_VERSION)/ && sed -e 's|^AX_ENABLE_BUILDDIR|\#AX_ENABLE_BUILDDIR|' -i configure.ac
#	touch $@
#$(LIBVA)-$(LIBVA_VERSION)/configure: $(LIBVA)-$(LIBVA_VERSION)/configure.ac
#	cd $(LIBVA)-$(LIBVA_VERSION)/ && $(ENV_COMPILE) autoreconf -if
#	touch $@
$(LIBVA)-$(LIBVA_VERSION)/Makefile: $(LIBVA)-$(LIBVA_VERSION)/configure
	cd $(LIBVA)-$(LIBVA_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF)
	touch $@
$(LIBVA)-$(LIBVA_VERSION)/src/$(LIBVA).la: $(LIBVA)-$(LIBVA_VERSION)/Makefile
	cd $(LIBVA)-$(LIBVA_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBVA).la: $(LIBVA)-$(LIBVA_VERSION)/src/$(LIBVA).la
	cd $(LIBVA)-$(LIBVA_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install

$(LIBVA)-uninstall: $(LIBVA)-$(LIBVA_VERSION)/src/$(LIBVA).la
	cd $(LIBVA)-$(LIBVA_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(LIBVA)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(LIBVA).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(LIBVA_SRC)
FL_UNINSTALL+=$(LIBVA)-uninstall

########################################
#freeglut-devel
MESA=mesa

FL_DEP_MESA= \
	$(LIBXML2)-install \
	$(GLPROTO)-install \
	$(DRI2PROTO)-install \
	$(DRI3PROTO)-install \
	$(PRESENTPROTO)-install \
	$(LIBX11)-install \
	$(LIBDRM)-install \
	$(LIBXSHMFENCE)-install \
	$(LIBXXF86VM)-install \
	$(LIBXDAMAGE)-install \
	$(ELFUTILS)-install \
	$(LIBOMXILB)-install \
	$(LIBCLC)-install \
	$(LLVM)-install \
	$(LIBUDEV)-install \
	$(LIBVDPAU)-install \
	$(LIBVA)-install \
	$(WAYLAND)-install \
	#$(systemd)-install \
	$(NULL)

MESA_VERSION=11.0.7
MESA_SRC=$(MESA)-$(MESA_VERSION).tar.xz
MESA_URL=ftp://ftp.freedesktop.org/pub/mesa/$(MESA_VERSION)/$(MESA_SRC)

$(DN_SRC)/$(MESA_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(MESA_URL)
	touch $@
$(MESA)-$(MESA_VERSION)/configure.ac: $(DN_SRC)/$(MESA_SRC)
	tar -xf $(DN_SRC)/$(MESA_SRC)
	touch $@

$(MESA)-$(MESA_VERSION)/mypatched: $(MESA)-$(MESA_VERSION)/configure.ac $(FL_DEP_MESA)
	cd $(MESA)-$(MESA_VERSION)/ && sed -i 's/LLVM_SO_NAME=.*/LLVM_SO_NAME=LLVM/' configure.ac
	touch $@

$(MESA)-$(MESA_VERSION)/configure: $(MESA)-$(MESA_VERSION)/mypatched
	cd $(MESA)-$(MESA_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(MESA)-$(MESA_VERSION)/Makefile: $(MESA)-$(MESA_VERSION)/configure
	cd $(MESA)-$(MESA_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --sysconfdir=$(PREFIX_CONF)/etc/ \
        --with-dri-driverdir=/usr/lib/xorg/modules/dri \
            --with-gallium-drivers=r300,r600,radeonsi,nouveau,svga,swrast \
            --with-dri-drivers=i915,i965,r200,radeon,nouveau,swrast \
            --with-egl-platforms=x11,drm,wayland \
            --enable-llvm-shared-libs \
            --enable-egl \
            --enable-gbm \
            --enable-gallium-llvm \
            --enable-shared-glapi \
            --enable-glx \
            --enable-glx-tls \
            --enable-dri \
            --enable-osmesa \
            --enable-gles1 \
            --enable-gles2 \
            --enable-texture-float \
            --enable-xa \
            --enable-vdpau \
            --enable-omx \
            --enable-nine \
            --enable-opencl --enable-opencl-icd \
            --with-clang-libdir=/usr/lib
	touch $@
$(MESA)-$(MESA_VERSION)/src/$(MESA).la: $(MESA)-$(MESA_VERSION)/Makefile
	cd $(MESA)-$(MESA_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(MESA).la: $(MESA)-$(MESA_VERSION)/src/$(MESA).la
	cd $(MESA)-$(MESA_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install

$(MESA)-uninstall: $(MESA)-$(MESA_VERSION)/src/$(MESA).la
	cd $(MESA)-$(MESA_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(MESA)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/$(MESA).la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(MESA_SRC)
FL_UNINSTALL+=$(MESA)-uninstall

########################################
# GLU, Mesa OpenGL Utility library
# http://cgit.freedesktop.org/mesa/glu/
GLU=glu

FL_DEP_GLU= \
	$(DEPENDS_GL) \
	#$(GLIB2)-install \
	#$(MESA)-install \
	$(NULL)

GLU_VERSION=9.0.0
GLU_SRC=$(GLU)-$(GLU_VERSION).tar.gz
GLU_URL=ftp://ftp.freedesktop.org/pub/mesa/glu/$(GLU_SRC)

$(DN_SRC)/$(GLU_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GLU_URL)
	touch $@
$(GLU)-$(GLU_VERSION)/configure.ac: $(DN_SRC)/$(GLU_SRC)
	tar -xf $(DN_SRC)/$(GLU_SRC)
	touch $@
$(GLU)-$(GLU_VERSION)/configure: $(GLU)-$(GLU_VERSION)/configure.ac $(FL_DEP_GLU)
	cd $(GLU)-$(GLU_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@
$(GLU)-$(GLU_VERSION)/Makefile: $(GLU)-$(GLU_VERSION)/configure
	cd $(GLU)-$(GLU_VERSION)/ && $(ENV_COMPILE) CFLAGS="$(CFLAGS) $(CUDA_CFLAGS)" LDFLAGS="$(LDFLAGS) $(CUDA_LIBS)" ./configure --prefix=$(PREFIX_CONF) --disable-static
	touch $@
$(GLU)-$(GLU_VERSION)/libGLU.la: $(GLU)-$(GLU_VERSION)/Makefile
	cd $(GLU)-$(GLU_VERSION)/ \
	    && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/libGLU.la: $(GLU)-$(GLU_VERSION)/libGLU.la
	cd $(GLU)-$(GLU_VERSION)/ \
	    && make -j1 DESTDIR=$(PREFIX_DEST) install

$(GLU)-uninstall: $(GLU)-$(GLU_VERSION)/libGLU.la
	cd $(GLU)-$(GLU_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GLU)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/libGLU.la
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GLU_SRC)
FL_UNINSTALL+=$(GLU)-uninstall

########################################
# glew, The OpenGL Extension Wrangler Library
# http://glew.sourceforge.net
GLEW=glew

GLEW_VERSION=1.13.0
GLEW_SRC=$(GLEW)-$(GLEW_VERSION).tgz
GLEW_URL=http://sourceforge.net/projects/glew/files/glew/$(GLEW_VERSION)/$(GLEW_SRC)

FL_DEP_GLEW= \
	$(LIBXMU)-install \
	$(LIBXI)-install \
	$(GLU)-install \
	$(NULL)

$(DN_SRC)/$(GLEW_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GLEW_URL)
	touch $@
$(GLEW)-$(GLEW_VERSION)/Makefile: $(DN_SRC)/$(GLEW_SRC) $(FL_DEP_GLEW)
	tar -xf $(DN_SRC)/$(GLEW_SRC)
	cd $(GLEW)-$(GLEW_VERSION)/ && sed -i 's|lib64|lib|' config/Makefile.linux
	cd $(GLEW)-$(GLEW_VERSION)/ && sed -i '/^.PHONY: .*\.pc$$/d' Makefile
	touch $@
$(GLEW)-$(GLEW_VERSION)/$(GLEW).pc: $(GLEW)-$(GLEW_VERSION)/Makefile
	cd $(GLEW)-$(GLEW_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(GLEW).pc: $(GLEW)-$(GLEW_VERSION)/$(GLEW).pc
	cd $(GLEW)-$(GLEW_VERSION)/ && make -j1 GLEW_DEST=$(PREFIX_DEST)/$(PREFIX_CONF)/ install

$(GLEW)-uninstall: $(GLEW)-$(GLEW_VERSION)/$(GLEW).pc
	cd $(GLEW)-$(GLEW_VERSION)/ && make -j1 GLEW_DEST=$(PREFIX_DEST)/$(PREFIX_CONF)/ uninstall
$(GLEW)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/lib/pkgconfig/$(GLEW).pc
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GLEW_SRC)
FL_UNINSTALL+=$(GLEW)-uninstall

########################################
GD=gd
GD_VERSION=2.1.1
GD_SRC=$(GD)-$(GD_VERSION).tar.gz
GD_URL="https://github.com/libgd/libgd/archive/$(GD_SRC)"

LIBGD=libgd
LIBGD_VERSION=2.1.1
LIBGD_SRC=$(LIBGD)-$(LIBGD_VERSION).tar.gz
LIBGD_URL="https://github.com/libgd/libgd/releases/download/gd-$(LIBGD_VERSION)/$(GD_SRC)"

# GETTEXT: for AM_ICONV in config
# AUTOMAKE: for autoreconf (bootstrap.sh)
FL_DEP_GD= \
	$(AUTOMAKE)-install \
	$(GETTEXT)-install \
	$(LUA)-install \
	$(LIBXPM)-install \
	$(LIBPNG)-install \
	$(LIBTIFF)-install \
	$(LVPX)-install \
	$(NULL)

$(DN_SRC)/$(GD_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GD_URL)
	touch $@
$(GD)-$(GD_VERSION)/configure.ac: $(DN_SRC)/$(GD_SRC)
	tar -xf $(DN_SRC)/$(GD_SRC)
	rm -rf $(GD)-install $(GD)-$(GD_VERSION)/
	mv libgd-gd* $(GD)-$(GD_VERSION)/
	touch $@
$(GD)-$(GD_VERSION)/mypatched: $(DN_PATCH)/pbs-libgd-libvpx.patch $(GD)-$(GD_VERSION)/configure.ac
	cd $(GD)-$(GD_VERSION)/ && patch -p1 < $(DN_PATCH)/pbs-libgd-libvpx.patch
	touch $@
$(GD)-$(GD_VERSION)/configure: $(GD)-$(GD_VERSION)/mypatched $(FL_DEP_GD)
	cd $(GD)-$(GD_VERSION)/ && $(ENV_COMPILE) ./bootstrap.sh
	touch $@
$(GD)-$(GD_VERSION)/Makefile: $(GD)-$(GD_VERSION)/configure $(GD)-$(GD_VERSION)/configure
	cd $(GD)-$(GD_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) --with-vpx=$(PREFIX_DEST)/$(PREFIX_CONF)/  --enable-static --disable-shared --disable-rpath --without-tiff #--with-tiff=$(PREFIX_DEST)/$(PREFIX_CONF)/
$(GD)-$(GD_VERSION)/src/gdtopng: $(GD)-$(GD_VERSION)/Makefile
	cd $(GD)-$(GD_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/gdtopng: $(GD)-$(GD_VERSION)/src/gdtopng
	cd $(GD)-$(GD_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(GD)-uninstall: $(GD)-$(GD_VERSION)/src/gdtopng
	cd $(GD)-$(GD_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GD)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/gdtopng
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GD_SRC)
FL_UNINSTALL+=$(GD)-uninstall

########################################
GNUPLOT=gnuplot
GNUPLOT_VERSION=5.0.1
GNUPLOT_SRC=$(GNUPLOT)-$(GNUPLOT_VERSION).tar.gz
GNUPLOT_URL=http://sourceforge.net/projects/gnuplot/files/gnuplot/$(GNUPLOT_VERSION)/$(GNUPLOT_SRC)

FL_DEP_GNUPLOT= \
	$(LVPX)-install \
	$(LIBTIFF)-install \
	$(GD)-install \
	$(NULL)

$(DN_SRC)/$(GNUPLOT_SRC): $(DN_SRC)/created
	$(WGET) -O $@ -c $(GNUPLOT_URL)
	touch $@
$(GNUPLOT)-$(GNUPLOT_VERSION)/configure.in: $(DN_SRC)/$(GNUPLOT_SRC)
	tar -xf $(DN_SRC)/$(GNUPLOT_SRC)
	touch $@

$(GNUPLOT)-$(GNUPLOT_VERSION)/mypatched: $(DN_PATCH)/pbs-gnuplot-lua.patch $(GNUPLOT)-$(GNUPLOT_VERSION)/configure.in
	cd $(GNUPLOT)-$(GNUPLOT_VERSION)/ && patch -p1 < $(DN_PATCH)/pbs-gnuplot-lua.patch
	touch $@

$(GNUPLOT)-$(GNUPLOT_VERSION)/configure: $(GNUPLOT)-$(GNUPLOT_VERSION)/mypatched $(FL_DEP_GNUPLOT)
	cd $(GNUPLOT)-$(GNUPLOT_VERSION)/ && $(ENV_COMPILE) autoreconf -if
	touch $@

$(GNUPLOT)-$(GNUPLOT_VERSION)/Makefile: $(GNUPLOT)-$(GNUPLOT_VERSION)/configure
	cd $(GNUPLOT)-$(GNUPLOT_VERSION)/ && $(ENV_COMPILE) ./configure --prefix=$(PREFIX_CONF) \
	        --with-gd=$(PREFIX_DEST)/$(PREFIX_CONF)/ \
	        --with-tiff=$(PREFIX_DEST)/$(PREFIX_CONF)/ \
	        --with-vpx=$(PREFIX_DEST)/$(PREFIX_CONF)/ \
	        --disable-rpath --disable-qt
$(GNUPLOT)-$(GNUPLOT_VERSION)/src/gnuplot: $(GNUPLOT)-$(GNUPLOT_VERSION)/Makefile
	cd $(GNUPLOT)-$(GNUPLOT_VERSION)/ && $(ENV_COMPILE) make $(MAKE_ARG)
$(PREFIX_DEST)/$(PREFIX_CONF)/bin/gnuplot: $(GNUPLOT)-$(GNUPLOT_VERSION)/src/gnuplot
	cd $(GNUPLOT)-$(GNUPLOT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) install

$(GNUPLOT)-uninstall: $(GNUPLOT)-$(GNUPLOT_VERSION)/src/gnuplot
	cd $(GNUPLOT)-$(GNUPLOT_VERSION)/ && make -j1 DESTDIR=$(PREFIX_DEST) uninstall
$(GNUPLOT)-install: $(PREFIX_DEST)/$(PREFIX_CONF)/bin/gnuplot
	touch $@

FL_SOURCES+=$(DN_SRC)/$(GNUPLOT_SRC)
FL_UNINSTALL+=$(GNUPLOT)-uninstall
